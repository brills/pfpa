cscope 15 $HOME/workspace/12fall/adv_compiler/llvm-3.0/projects/poolalloc/lib/PoolAllocate -q 0000001026 0000174124
	@AccessTrace.cpp

14 
	#DEBUG_TYPE
 "poš‹rcom´ess"

	)

16 
	~"d§/D©aSŒuùu».h
"

17 
	~"d§/DSG¿ph.h
"

18 
	~"poŞ®loc/PoŞAÎoÿ‹.h
"

19 
	~"Îvm/In¡ruùiÚs.h
"

20 
	~"Îvm/ModuË.h
"

21 
usšg
 
Çme¥aû
 
	gÎvm
;

23 
	gÇme¥aû
 {

28 şas 
	cPoŞAcûssT¿û
 : 
public
 
ModuËPass
 {

29 
PoŞAÎoÿ‹
 *
PoŞAÎoc
;

30 
D©aSŒuùu»s
 *
	gG
;

31 
CÚ¡ªt
 *
	gAcûssT¿ûIn™Fn
, *
	gPoŞAcûssT¿ûFn
;

32 
Poš‹rTy³
 *
	gVoidPŒTy
;

33 
	gpublic
:

35 
PoŞAcûssT¿û
(è: 
ModuËPass
(
ID
) {}

37 
boŞ
 
runOnModuË
(
ModuË
 &
M
);

39 
g‘AÇlysisU§ge
(
AÇlysisU§ge
 &
AU
) const;

41 cÚ¡ 
DSG¿ph
* 
g‘G¿phFÜFunc
(
PA
::
FuncInfo
 *
FI
) const {

42  
G
->
g‘DSG¿ph
(
FI
->
F
);

44 
	gID
;

46 
	g´iv©e
:

47 
In™ŸlizeLib¿ryFunùiÚs
(
ModuË
 &
M
);

48 
In¡rum’tAcûss
(
In¡ruùiÚ
 *
I
, 
V®ue
 *
PŒ
,

49 
PA
::
FuncInfo
 *
FI
, 
DSG¿ph
* 
DSG
);

52 
	gPoŞAcûssT¿û
::
ID
 = 0;

53 
	gRegi¡”Pass
<
	gPoŞAcûssT¿û
>

54 
X
("poolaccesstrace", "Instrument…rogramo…rintrace of‡ccesses");

57 
	gPoŞAcûssT¿û
::
	$g‘AÇlysisU§ge
(
AÇlysisU§ge
 &
AU
) const {

59 
AU
.
addRequœed
<
PoŞAÎoÿ‹PassAÎPoŞs
>();

62 
AU
.
addRequœed
<
Com¶‘eBUD©aSŒuùu»s
>();

63 
	}
}

65 
	gPoŞAcûssT¿û
::
	$In™ŸlizeLib¿ryFunùiÚs
(
ModuË
 &
M
) {

66 
IÁeg”Ty³
 * 
IT
 = IÁeg”Ty³::
	`g‘IÁ8Ty
(
M
.
	`g‘CÚ‹xt
());

67 
Ty³
 * 
VoidTy³
 = Ty³::
	`g‘VoidTy
(
M
.
	`g‘CÚ‹xt
());

68 
VoidPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
IT
);

70 
AcûssT¿ûIn™Fn
 = 
M
.
	`g‘OrIn£¹FunùiÚ
("poolaccesstraceinit",

71 
VoidTy³
, 
NULL
);

72 
PoŞAcûssT¿ûFn
 = 
M
.
	`g‘OrIn£¹FunùiÚ
("poŞacûs¡¿û", 
VoidTy³
,

73 
VoidPŒTy
, VoidPŒTy, 
NULL
);

74 
	}
}

76 
	gPoŞAcûssT¿û
::
In¡rum’tAcûss
(
In¡ruùiÚ
 *
I
, 
V®ue
 *
PŒ
,

77 
PA
::
FuncInfo
 *
FI
, 
DSG¿ph
* 
DSG
) {

79 ià(
	gi§
<
	gCÚ¡ªt
>(
	gPŒ
è|| i§<
	gAÎoÿIn¡
>(Ptr)) ;

81 
V®ue
 *
	gM­³dPŒ
 = 
PŒ
;

82 ià(!
	gFI
->
	gNewToOldV®ueM­
.
em±y
())

83 ià((
	gM­³dPŒ
 = 
FI
->
M­V®ueToOrigš®
(
M­³dPŒ
)) == 0) {

87 
DSNode
 *
	gNode
 = 
DSG
->
g‘NodeFÜV®ue
(
M­³dPŒ
).
g‘Node
();

88 ià(
	gNode
 == 0) ;

90 
V®ue
 *
	gPD
 = 
FI
->
PoŞDesütÜs
[
Node
];

91 
	gPŒ
 = 
Ca¡In¡
::
C»©ePoš‹rCa¡
 (
PŒ
, 
VoidPŒTy
, PŒ->
g‘Name
(), 
I
);

93 ià(
	gPD
)

94 
	gPD
 = 
Ca¡In¡
::
C»©ePoš‹rCa¡
 (
PD
, 
VoidPŒTy
, PD->
g‘Name
(), 
I
);

96 
	gPD
 = 
CÚ¡ªtPoš‹rNuÎ
::
g‘
(
VoidPŒTy
);

99 
V®ue
 *
	gO±s
[2] = {
PŒ
, 
PD
};

100 
	gC®lIn¡
::
C»©e
 (
PoŞAcûssT¿ûFn
, 
O±s
, "", 
I
);

103 
boŞ
 
	gPoŞAcûssT¿û
::
	$runOnModuË
(
ModuË
 &
M
) {

104 
PoŞAÎoc
 = &
g‘AÇlysis
<
PoŞAÎoÿ‹PassAÎPoŞs
>();

105 
G
 = &
g‘AÇlysis
<
Com¶‘eBUD©aSŒuùu»s
>();

108 
	`In™ŸlizeLib¿ryFunùiÚs
(
M
);

110 
FunùiÚ
 *
MašFunc
 = 
M
.
	`g‘FunùiÚ
("main");

111 ià(
MašFunc
 && !MašFunc->
	`isDeş¬©iÚ
())

113 
C®lIn¡
::
	`C»©e
 (
AcûssT¿ûIn™Fn
, "", 
MašFunc
->
	`begš
()->begin());

116 
ModuË
::
™”©Ü
 
F
 = 
M
.
	`begš
(), 
E
 = M.
	`’d
(); F != E; ++F) {

117 ià(
F
->
	`isDeş¬©iÚ
()) ;

119 
PA
::
FuncInfo
 *
FI
 = 
PoŞAÎoc
->
	`g‘FuncInfoOrClÚe
(*
F
);

120 
	`as£¹
(
FI
 && "DIDN'T FIND POOL INFO!");

125 ià(
FI
->
ClÚe
 && &FI->
F
 == F)

129 
DSG¿ph
* 
DSG
 = 
G
->
	`g‘DSG¿ph
(
FI
->
F
);

131 
FunùiÚ
::
™”©Ü
 
BB
 = 
F
->
	`begš
(), 
E
 = F->
	`’d
(); BB != E; ++BB)

132 
BasicBlock
::
™”©Ü
 
I
 = 
BB
->
	`begš
(), 
E
 = BB->
	`’d
(); I != E; ++I)

133 ià(
LßdIn¡
 *
LI
 = 
dyn_ÿ¡
<LßdIn¡>(
I
))

134 
	`In¡rum’tAcûss
(
LI
, LI->
	`g‘O³¿nd
(0), 
FI
, 
DSG
);

136  
Œue
;

137 
	}
}

	@AllHeapNodesHeuristic.cpp

20 
	~"d§/DSG¿phT¿™s.h
"

21 
	~"poŞ®loc/Heuri¡ic.h
"

22 
	~"poŞ®loc/PoŞAÎoÿ‹.h
"

23 
	~"Îvm/In¡ruùiÚs.h
"

24 
	~"Îvm/ModuË.h
"

25 
	~"Îvm/ADT/D•thFœ¡I‹¿tÜ.h
"

26 
	~"Îvm/SuµÜt/CommªdLše.h
"

27 
	~"Îvm/SuµÜt/FÜm©‹dSŒ—m.h
"

28 
	~"Îvm/T¬g‘/T¬g‘D©a.h
"

29 
	~<io¡»am
>

31 
usšg
 
Çme¥aû
 
	gÎvm
;

32 
usšg
 
Çme¥aû
 
	gPA
;

54 
	gAÎH—pNodesHeuri¡ic
::
G‘NodesR—chabËFromGlob®s
 (
DSG¿ph
* 
G
,

55 
D’£S‘
<cÚ¡ 
DSNode
*> &
NodesFromGlob®s
) {

60 
DSG¿ph
 * 
	gGlob®sG¿ph
 = 
G
->
g‘Glob®sG¿ph
();

61 ià(!
	gGlob®sG¿ph
)

62 
	gGlob®sG¿ph
 = 
G
;

67 
	gDSG¿ph
::
node_™”©Ü
 
NI
 = 
Glob®sG¿ph
->
node_begš
();

68 
	gNI
 !ğ
Glob®sG¿ph
->
node_’d
();

69 ++
	gNI
) {

70 
	gNI
->
m¬kR—chabËNodes
(
NodesFromGlob®s
);

77 
	g¡d
::
veùÜ
<cÚ¡ 
DSNode
 *> 
toRemove
;

78 
	gD’£S‘
<cÚ¡ 
	gDSNode
*>::
™”©Ü
 
I
 = 
NodesFromGlob®s
.
begš
(),

79 
	gE
 = 
NodesFromGlob®s
.
’d
(); 
	gI
 !ğ
E
; ) {

80 
	gD’£S‘
<cÚ¡ 
	gDSNode
*>::
™”©Ü
 
La¡
 = 
I
; ++
	gI
;

82 cÚ¡ 
DSNode
 *
	gtmp
 = *
La¡
;

83 ià(!(
	gtmp
->
isH—pNode
()))

84 
	gtoRemove
.
push_back
 (
tmp
);

87 ià(
	gtmp
->
isPŒToIÁNode
())

88 
	gtoRemove
.
push_back
(
tmp
);

94 
	gšdex
 = 0; index < 
	gtoRemove
.
size
(); ++index) {

95 
	gNodesFromGlob®s
.
”a£
(
toRemove
[
šdex
]);

103 ià(
	gG
->
g‘Glob®sG¿ph
()) {

108 
	gDSG¿ph
::
NodeM­Ty
 
NodeM­
;

109 
	gG
->
compu‹GToGGM­pšg
 (
NodeM­
);

121 
	gDSG¿ph
::
node_™”©Ü
 
ni
 = 
G
->
node_begš
();

122 ; 
	gni
 !ğ
G
->
node_’d
(); ++ni) {

123 
DSNode
 * 
	gN
 = 
ni
;

124 ià(
	gNodesFromGlob®s
.
couÁ
 (
NodeM­
[
N
].
g‘Node
()))

125 
	gNodesFromGlob®s
.
š£¹
 (
N
);

147 
	gAÎH—pNodesHeuri¡ic
::
	$fšdGlob®PoŞNodes
 (
DSNodeS‘_t
 & 
Nodes
) {

149 
DSG¿ph
* 
GG
 = 
G¿phs
->
	`g‘Glob®sG¿ph
();

152 
D’£S‘
<cÚ¡ 
DSNode
*> 
Glob®H—pNodes
;

153 
	`G‘NodesR—chabËFromGlob®s
 (
GG
, 
Glob®H—pNodes
);

157 
D’£S‘
<cÚ¡ 
DSNode
 *>::
™”©Ü
 
NI
 = 
Glob®H—pNodes
.
	`begš
();

158 
NI
 !ğ
Glob®H—pNodes
.
	`’d
();++NI) {

159 cÚ¡ 
DSNode
 * 
N
 = *
NI
;

160 
PoŞM­
[
N
] = 
	`OÃPoŞ
(N);

167 
ModuË
::
™”©Ü
 
F
 = 
M
->
	`begš
(); F !ğM->
	`’d
(); ++F) {

168 ià(
G¿phs
->
	`hasDSG¿ph
(*
F
)) {

169 
DSG¿ph
* 
G
 = 
G¿phs
->
	`g‘DSG¿ph
(*
F
);

170 
DSG¿ph
::
NodeM­Ty
 
NodeM­
;

171 
G
->
	`compu‹GToGGM­pšg
 (
NodeM­
);

178 
DSG¿ph
::
node_™”©Ü
 
ni
 = 
G
->
	`node_begš
();

179 ; 
ni
 !ğ
G
->
	`node_’d
(); ++ni) {

180 
DSNode
 * 
N
 = 
ni
;

181 
DSNode
 * 
GGN
 = 
NodeM­
[
N
].
	`g‘Node
();

184 ià(
GGN
 && 
Glob®H—pNodes
.
	`couÁ
 (GGN))

185 
PoŞM­
[
GGN
].
NodesInPoŞ
.
	`push_back
 (
N
);

196 
D’£S‘
<cÚ¡ 
DSNode
*>::
™”©Ü
 
I
 = 
Glob®H—pNodes
.
	`begš
(),

197 
E
 = 
Glob®H—pNodes
.
	`’d
(); 
I
 != E; ++I) {

198 
Nodes
.
	`š£¹
 (*
I
);

202 
	}
}

209 
boŞ


210 
	gAÎH—pNodesHeuri¡ic
::
	$runOnModuË
 (
ModuË
 & Module) {

214 
M
 = &
ModuË
;

219 
G¿phs
 = &
g‘AÇlysis
<
EQTDD©aSŒuùu»s
>();

220 
	`as£¹
 (
G¿phs
 && "No DSGraphs!\n");

226 
	`fšdGlob®PoŞNodes
 (
Glob®PoŞNodes
);

229  
çl£
;

230 
	}
}

233 
	gAÎH—pNodesHeuri¡ic
::
AssignToPoŞs
 (cÚ¡ 
¡d
::
veùÜ
<cÚ¡ 
DSNode
*> &
NodesToPA
,

234 
FunùiÚ
 *
F
, 
DSG¿ph
* 
G
,

235 
¡d
::
veùÜ
<
OÃPoŞ
> &
ResuÉPoŞs
) {

236 
i
 = 0, 
	ge
 = 
NodesToPA
.
size
(); 
	gi
 !ğ
e
; ++i){

237 ià(
	gPoŞM­
.
fšd
 (
NodesToPA
[
i
]è!ğ
PoŞM­
.
’d
())

238 
ResuÉPoŞs
.
push_back
(
PoŞM­
[
NodesToPA
[
i
]]);

240 
	gResuÉPoŞs
.
push_back
 (
OÃPoŞ
(
NodesToPA
[
i
]));

248 
	gRegi¡”Pass
<
	gAÎH—pNodesHeuri¡ic
>

249 
A
 ("paheur-AllHeapNodes", "Pool‡llocate‡ll (heap?)‚odes");

251 
	gRegi¡”AÇlysisGroup
<
	gHeuri¡ic
> 
Heuri¡ic1
(
A
);

253 
	gAÎH—pNodesHeuri¡ic
::
ID
 = 0;

	@AllNodesHeuristic.cpp

16 
	~"poŞ®loc/Heuri¡ic.h
"

18 
	~"Îvm/ModuË.h
"

20 
usšg
 
Çme¥aû
 
	gÎvm
;

21 
usšg
 
Çme¥aû
 
	gPA
;

40 
G‘NodesR—chabËFromGlob®s
 (
DSG¿ph
* 
G
,

41 
D’£S‘
<cÚ¡ 
DSNode
*> &
NodesFromGlob®s
) {

45 
as£¹
 (
G
->
g‘Glob®sG¿ph
() == 0);

46 
DSG¿ph
 * 
	gGlob®sG¿ph
 = 
G
;

51 
	gDSG¿ph
::
node_™”©Ü
 
NI
 = 
Glob®sG¿ph
->
node_begš
();

52 
	gNI
 !ğ
Glob®sG¿ph
->
node_’d
();

53 ++
	gNI
) {

54 
	gNI
->
m¬kR—chabËNodes
(
NodesFromGlob®s
);

74 
	gAÎNodesHeuri¡ic
::
	$fšdGlob®PoŞNodes
 (
DSNodeS‘_t
 & 
Nodes
) {

76 
DSG¿ph
* 
GG
 = 
G¿phs
->
	`g‘Glob®sG¿ph
();

81 
D’£S‘
<cÚ¡ 
DSNode
*> 
Glob®Nodes
;

82 
	`G‘NodesR—chabËFromGlob®s
 (
GG
, 
Glob®Nodes
);

87 
D’£S‘
<cÚ¡ 
DSNode
 *>::
™”©Ü
 
NI
 = 
Glob®Nodes
.
	`begš
();

88 
NI
 !ğ
Glob®Nodes
.
	`’d
();

89 ++
NI
) {

90 cÚ¡ 
DSNode
 * 
N
 = *
NI
;

91 
PoŞM­
[
N
] = 
	`OÃPoŞ
(N);

100 
ModuË
::
™”©Ü
 
F
 = 
M
->
	`begš
(); F !ğM->
	`’d
(); ++F) {

104 ià(!(
G¿phs
->
	`hasDSG¿ph
(*
F
))) ;

110 
DSG¿ph
* 
G
 = 
G¿phs
->
	`g‘DSG¿ph
(*
F
);

111 
DSG¿ph
::
NodeM­Ty
 
NodeM­
;

112 
G
->
	`compu‹GToGGM­pšg
 (
NodeM­
);

120 
DSG¿ph
::
node_™”©Ü
 
ni
 = 
G
->
	`node_begš
();

121 ; 
ni
 !ğ
G
->
	`node_’d
(); ++ni) {

122 
DSNode
 * 
N
 = 
ni
;

123 
DSNode
 * 
GGN
 = 
NodeM­
[
N
].
	`g‘Node
();

125 
	`as£¹
 (!
GGN
 || 
Glob®Nodes
.
	`couÁ
 (GGN));

126 ià(
GGN
 && 
Glob®Nodes
.
	`couÁ
 (GGN))

127 
PoŞM­
[
GGN
].
NodesInPoŞ
.
	`push_back
 (
N
);

143 
ModuË
::
™”©Ü
 
F
 = 
M
->
	`begš
(); F !ğM->
	`’d
(); ++F) {

144 ià(
F
->
	`isDeş¬©iÚ
()) ;

145 
DSG¿ph
* 
G
 = 
G¿phs
->
	`g‘DSG¿ph
(*
F
);

146 
DSG¿ph
::
node_™”©Ü
 
I
 = 
G
->
	`node_begš
(), 
E
 = G->
	`node_’d
();

147 
I
 !ğ
E
;

148 ++
I
) {

149 
DSNode
 * 
Node
 = 
I
;

150 ià(
Node
->
	`isEx‹º®Node
(è|| Node->
	`isUnknownNode
()) {

151 
Glob®Nodes
.
	`š£¹
 (
Node
);

166 
D’£S‘
<cÚ¡ 
DSNode
*>::
™”©Ü
 
I
 = 
Glob®Nodes
.
	`begš
(),

167 
E
 = 
Glob®Nodes
.
	`’d
(); 
I
 != E; ++I) {

168 
Nodes
.
	`š£¹
 (*
I
);

172 
	}
}

182 
	gAÎNodesHeuri¡ic
::
	$g‘LoÿlPoŞNodes
 (cÚ¡ 
FunùiÚ
 & 
F
, 
DSNodeLi¡_t
 & 
Nodes
) {

187 
DSG¿ph
* 
G
 = 
G¿phs
->
	`g‘DSG¿ph
(
F
);

188 ià(
G
->
	`node_begš
(è=ğG->
	`node_’d
()) ;

194 
G¿phs
->
	`g‘Glob®sG¿ph
();

198 
DSG¿ph
::
NodeM­Ty
 
Glob®sG¿phNodeM­pšg
;

199 
G
->
	`compu‹GToGGM­pšg
(
Glob®sG¿phNodeM­pšg
);

206 
DSG¿ph
::
node_™”©Ü
 
I
 = 
G
->
	`node_begš
(), 
E
 = G->
	`node_’d
();

207 
I
 !ğ
E
;

208 ++
I
) {

210 
DSNode
 * 
N
 = 
I
;

211 
DSNode
 * 
GGN
 = 
Glob®sG¿phNodeM­pšg
[
N
].
	`g‘Node
();

217 ià(!((
GGN
 && 
Glob®PoŞNodes
.
	`couÁ
 (GGN)))) {

220 
	`as£¹
(!
N
->
	`isGlob®Node
() && "Should be in global mapping!");

221 
Nodes
.
	`push_back
 (
N
);

226 
	}
}

229 
	gAÎNodesHeuri¡ic
::
AssignToPoŞs
 (cÚ¡ 
¡d
::
veùÜ
<cÚ¡ 
DSNode
*> &
NodesToPA
,

230 
FunùiÚ
 *
F
, 
DSG¿ph
* 
G
,

231 
¡d
::
veùÜ
<
OÃPoŞ
> &
ResuÉPoŞs
) {

232 
i
 = 0, 
	ge
 = 
NodesToPA
.
size
(); 
	gi
 !ğ
e
; ++i)

233 ià(
	gPoŞM­
.
fšd
 (
NodesToPA
[
i
]è!ğ
PoŞM­
.
’d
())

234 
ResuÉPoŞs
.
push_back
(
PoŞM­
[
NodesToPA
[
i
]]);

236 
	gResuÉPoŞs
.
push_back
 (
OÃPoŞ
(
NodesToPA
[
i
]));

247 
	gAÎNodesHeuri¡ic
::
	$»Ëa£MemÜy
 () {

248 
PoŞM­
.
	`ş—r
();

249 
Glob®PoŞNodes
.
	`ş—r
();

251 
	}
}

253 
boŞ


254 
	gAÎNodesHeuri¡ic
::
	$runOnModuË
 (
ModuË
 & Module) {

258 
M
 = &
ModuË
;

263 
G¿phs
 = &
g‘AÇlysis
<
EQTDD©aSŒuùu»s
>();

264 
	`as£¹
 (
G¿phs
 && "No DSGraphs!\n");

270 
	`fšdGlob®PoŞNodes
 (
Glob®PoŞNodes
);

273  
çl£
;

274 
	}
}

276 
	gRegi¡”Pass
<
	gAÎNodesHeuri¡ic
>

277 
X
 ("paheur-sc", "Pool‡llocate‡ll‚odes for SAFECode");

279 
	gRegi¡”AÇlysisGroup
<
	gHeuri¡ic
> 
Heuri¡ic
(
X
);

281 
	gAÎNodesHeuri¡ic
::
ID
 = 0;

	@Heuristic.cpp

19 
	~"d§/DSG¿phT¿™s.h
"

20 
	~"poŞ®loc/Heuri¡ic.h
"

21 
	~"poŞ®loc/PoŞAÎoÿ‹.h
"

22 
	~"Îvm/In¡ruùiÚs.h
"

23 
	~"Îvm/ModuË.h
"

24 
	~"Îvm/ADT/D•thFœ¡I‹¿tÜ.h
"

25 
	~"Îvm/SuµÜt/CommªdLše.h
"

26 
	~"Îvm/SuµÜt/FÜm©‹dSŒ—m.h
"

27 
	~"Îvm/T¬g‘/T¬g‘D©a.h
"

28 
	~<io¡»am
>

30 
usšg
 
Çme¥aû
 
	gÎvm
;

31 
usšg
 
Çme¥aû
 
	gPA
;

33 
	gÇme¥aû
 {

34 
	gş
::
İt
<
boŞ
>

35 
Di§bËAlignO±
("poolalloc-disable-alignopt",

36 
ş
::
desc
("Force‡ll…ool‡lignmento 8 bytes"));

55 
	gHeuri¡ic
::
	$g‘Recomm’dedSize
(cÚ¡ 
DSNode
 *
N
) {

56 
PoŞSize
 = 0;

62 ià(!
N
->
	`isA¼ayNode
()) {

63 
PoŞSize
 = 
N
->
	`g‘Size
();

70 ià(
PoŞSize
 == 1) PoolSize = 0;

71  
PoŞSize
;

72 
	}
}

99 
boŞ


100 
	$Wªts8By‹Alignm’t
(
Ty³
 *
Ty
, 
Offs
, cÚ¡ 
T¬g‘D©a
 &
TD
) {

105 ià(
Di§bËAlignO±
è 
Œue
;

111 ià((
Offs
 & 7) == 0) {

116 ià(
Ty
->
	`isDoubËTy
()è 
Œue
;

122 ià(
TD
.
	`g‘P»fTy³Alignm’t
(
Ty
) == 8)

123  
Œue
;

131 ià(
Ty
->
	`isFœ¡CÏssTy³
())

132  
çl£
;

139 ià(
SŒuùTy³
 *
STy
 = 
dyn_ÿ¡
<SŒuùTy³>(
Ty
)) {

140 cÚ¡ 
SŒuùLayout
 *
SL
 = 
TD
.
	`g‘SŒuùLayout
(
STy
);

141 
i
 = 0, 
e
 = 
STy
->
	`g‘NumEËm’ts
(); i !=ƒ; ++i) {

142 ià(
	`Wªts8By‹Alignm’t
(
STy
->
	`g‘EËm’tTy³
(
i
),

143 
Offs
+
SL
->
	`g‘EËm’tOff£t
(
i
), 
TD
))

144  
Œue
;

146 } ià(
Sequ’tŸlTy³
 *
STy
 = 
dyn_ÿ¡
<Sequ’tŸlTy³>(
Ty
)) {

147  
	`Wªts8By‹Alignm’t
(
STy
->
	`g‘EËm’tTy³
(), 
Offs
, 
TD
);

149 
	`”rs
(è<< *
Ty
 << "\n";

150 
	`as£¹
(0 && "Unknownype!");

153  
çl£
;

154 
	}
}

156 
	gHeuri¡ic
::
	$g‘Recomm’dedAlignm’t
(
Ty³
 *
Ty
,

157 cÚ¡ 
T¬g‘D©a
 &
TD
) {

158 ià(!
Ty
 || Ty->
	`isVoidTy
())

161  
	`Wªts8By‹Alignm’t
(
Ty
, 0, 
TD
) ? 8 : 4;

162 
	}
}

175 
	gHeuri¡ic
::
	$g‘Recomm’dedAlignm’t
(cÚ¡ 
DSNode
 *
Node
) {

179 cÚ¡ 
T¬g‘D©a
 &
TD
 = 
Node
->
	`g‘P¬’tG¿ph
()->
	`g‘T¬g‘D©a
();

186 
DSNode
::
cÚ¡_ty³_™”©Ü
 
tyi
;

187 
tyi
 = 
Node
->
	`ty³_begš
();y˜!ğNode->
	`ty³_’d
(); ++tyi) {

188 
sv£t
<
Ty³
*>::
cÚ¡_™”©Ü
 
tyii
 = 
tyi
->
£cÚd
->
	`begš
(),

189 
ty“
 = 
tyi
->
£cÚd
->
	`’d
(); 
tyii
 !=yee; ++tyii) {

194 
Ty³
 * 
Ty³C»©ed
 = *
tyii
;

195 ià(
Ty³C»©ed
) {

199 ià(
	`Wªts8By‹Alignm’t
(
Ty³C»©ed
, 
tyi
->
fœ¡
, 
TD
)) {

207 
	}
}

229 
G‘NodesR—chabËFromGlob®s
 (
DSG¿ph
* 
G
,

230 
D’£S‘
<cÚ¡ 
DSNode
*> &
NodesFromGlob®s
) {

235 
DSG¿ph
 * 
	gGlob®sG¿ph
 = 
G
->
g‘Glob®sG¿ph
();

236 ià(!
	gGlob®sG¿ph
)

237 
	gGlob®sG¿ph
 = 
G
;

242 
	gDSG¿ph
::
node_™”©Ü
 
NI
 = 
Glob®sG¿ph
->
node_begš
();

243 
	gNI
 !ğ
Glob®sG¿ph
->
node_’d
();

244 ++
	gNI
) {

245 
	gNI
->
m¬kR—chabËNodes
(
NodesFromGlob®s
);

251 
	g¡d
::
veùÜ
<cÚ¡ 
DSNode
 *> 
toRemove
;

252 
	gD’£S‘
<cÚ¡ 
	gDSNode
*>::
™”©Ü
 
I
 = 
NodesFromGlob®s
.
begš
(),

253 
	gE
 = 
NodesFromGlob®s
.
’d
(); 
	gI
 !ğ
E
; ) {

254 
	gD’£S‘
<cÚ¡ 
	gDSNode
*>::
™”©Ü
 
La¡
 = 
I
; ++
	gI
;

260 cÚ¡ 
DSNode
 *
	gtmp
 = *
La¡
;

261 ià(!(
	gtmp
->
isH—pNode
()))

262 
	gtoRemove
.
push_back
 (
tmp
);

268 
	gšdex
 = 0; index < 
	gtoRemove
.
size
(); ++index) {

269 
	gNodesFromGlob®s
.
”a£
(
toRemove
[
šdex
]);

277 ià(
	gG
->
g‘Glob®sG¿ph
()) {

282 
	gDSG¿ph
::
NodeM­Ty
 
NodeM­
;

283 
	gG
->
compu‹GToGGM­pšg
 (
NodeM­
);

294 
	gDSG¿ph
::
node_™”©Ü
 
ni
 = 
G
->
node_begš
();

295 ; 
	gni
 !ğ
G
->
node_’d
(); ++ni) {

296 
DSNode
 * 
	gN
 = 
ni
;

297 ià(
	gNodesFromGlob®s
.
couÁ
 (
NodeM­
[
N
].
g‘Node
()))

298 
	gNodesFromGlob®s
.
š£¹
 (
N
);

320 
	gHeuri¡ic
::
	$fšdGlob®PoŞNodes
 (
DSNodeS‘_t
 & 
Nodes
) {

322 
DSG¿ph
* 
GG
 = 
G¿phs
->
	`g‘Glob®sG¿ph
();

325 
D’£S‘
<cÚ¡ 
DSNode
*> 
Glob®H—pNodes
;

326 
	`G‘NodesR—chabËFromGlob®s
 (
GG
, 
Glob®H—pNodes
);

332 
ModuË
::
™”©Ü
 
F
 = 
M
->
	`begš
(); F !ğM->
	`’d
(); ++F) {

333 ià(
G¿phs
->
	`hasDSG¿ph
(*
F
)) {

334 
DSG¿ph
* 
G
 = 
G¿phs
->
	`g‘DSG¿ph
(*
F
);

335 
	`G‘NodesR—chabËFromGlob®s
 (
G
, 
Glob®H—pNodes
);

345 
D’£S‘
<cÚ¡ 
DSNode
*>::
™”©Ü
 
I
 = 
Glob®H—pNodes
.
	`begš
(),

346 
E
 = 
Glob®H—pNodes
.
	`’d
(); 
I
 != E; ++I) {

347 
Nodes
.
	`š£¹
 (*
I
);

351 
	}
}

374 
	gHeuri¡ic
::
g‘Glob®PoŞNodes
 (
¡d
::
veùÜ
<cÚ¡ 
DSNode
 *> & 
Nodes
) {

379 
Nodes
.
š£¹
 (Nodes.
’d
(), 
Glob®PoŞNodes
.
begš
(), GlobalPoolNodes.end());

391 
	gHeuri¡ic
::
	$g‘LoÿlPoŞNodes
 (cÚ¡ 
FunùiÚ
 & 
F
, 
DSNodeLi¡_t
 & 
Nodes
) {

396 
DSG¿ph
* 
G
 = 
G¿phs
->
	`g‘DSG¿ph
(
F
);

397 ià(
G
->
	`node_begš
(è=ğG->
	`node_’d
()) ;

403 
G¿phs
->
	`g‘Glob®sG¿ph
();

407 
DSG¿ph
::
NodeM­Ty
 
Glob®sG¿phNodeM­pšg
;

408 
G
->
	`compu‹GToGGM­pšg
(
Glob®sG¿phNodeM­pšg
);

415 
DSG¿ph
::
node_™”©Ü
 
I
 = 
G
->
	`node_begš
(), 
E
 = G->
	`node_’d
();

416 
I
 !ğ
E
;

417 ++
I
){

419 
DSNode
 * 
N
 = 
I
;

420 
DSNode
 * 
GGN
 = 
Glob®sG¿phNodeM­pšg
[
N
].
	`g‘Node
();

428 ià((
N
->
	`isH—pNode
()è|| (
GGN
 && GGN->isHeapNode())) {

429 ià(!(
Glob®PoŞNodes
.
	`couÁ
 (
N
è|| Glob®PoŞNodes.couÁ (
GGN
))) {

432 
	`as£¹
((!
N
->
	`isGlob®Node
(è|| N->
	`isPŒToIÁNode
()) && "Should be in global mapping!");

433 if(!
N
->
	`isPŒToIÁNode
()) {

434 
Nodes
.
	`push_back
 (
N
);

441 
	}
}

450 
boŞ


451 
	gAÎButUÄ—chabËFromMemÜyHeuri¡ic
::
	$runOnModuË
 (
ModuË
 & Module) {

455 
M
 = &
ModuË
;

460 
G¿phs
 = &
g‘AÇlysis
<
EQTDD©aSŒuùu»s
>();

466 
	`fšdGlob®PoŞNodes
 (
Glob®PoŞNodes
);

469  
çl£
;

470 
	}
}

473 
	gAÎButUÄ—chabËFromMemÜyHeuri¡ic
::
AssignToPoŞs
 (

474 cÚ¡ 
DSNodeLi¡_t
 &
NodesToPA
,

475 
FunùiÚ
 *
F
, 
DSG¿ph
* 
G
,

476 
¡d
::
veùÜ
<
OÃPoŞ
> &
ResuÉPoŞs
) {

480 
¡d
::
£t
<cÚ¡ 
DSNode
*> 
R—chabËFromMemÜy
;

481 
	gDSG¿ph
::
node_™”©Ü
 
I
 = 
G
->
node_begš
(), 
	gE
 = G->
node_’d
();

482 
	gI
 !ğ
E
; ++I) {

483 
DSNode
 *
	gN
 = 
I
;

488 ià(
	gN
->
isA¼ay
(è|| N->
isH—pNode
(è|| N->
isAÎoÿNode
() ||

489 
	gN
->
isUnknownNode
())

492 ià(!
	gR—chabËFromMemÜy
.
couÁ
(
N
)) {

493 
	gDSNode
::
™”©Ü
 
NI
 = 
N
->
begš
(), 
	gE
 = N->
’d
(); 
	gNI
 !ğ
E
; ++NI) {

498 ià(!(*
	gNI
)) ;

504 
	gdf_ext_™”©Ü
<cÚ¡ 
	gDSNode
*>

505 
	gDI
 = 
df_ext_begš
(*
NI
, 
R—chabËFromMemÜy
),

506 
	gE
 = 
df_ext_’d
(*
NI
, 
R—chabËFromMemÜy
); 
	gDI
 !ğ
E
; ++DI)

514 
	gi
 = 0, 
	ge
 = 
NodesToPA
.
size
(); i !ğ
e
; ++i)

515 ià(
	gR—chabËFromMemÜy
.
couÁ
(
NodesToPA
[
i
]))

516 
	gResuÉPoŞs
.
push_back
(
OÃPoŞ
(
NodesToPA
[
i
]));

524 
boŞ


525 
	gCyşicNodesHeuri¡ic
::
	$runOnModuË
 (
ModuË
 & Module) {

529 
M
 = &
ModuË
;

534 
G¿phs
 = &
g‘AÇlysis
<
EQTDD©aSŒuùu»s
>();

540 
	`fšdGlob®PoŞNodes
 (
Glob®PoŞNodes
);

543  
çl£
;

544 
	}
}

546 
boŞ
 
	$NodeExi¡sInCyşe
(cÚ¡ 
DSNode
 *
N
) {

547 
DSNode
::
cÚ¡_™”©Ü
 
I
 = 
N
->
	`begš
(), 
E
 = N->
	`’d
(); I != E; ++I)

548 ià(*
I
 && 
¡d
::
	`fšd
(
	`df_begš
(*I), 
	`df_’d
(*I), 
N
) != df_end(*I))

549  
Œue
;

550  
çl£
;

551 
	}
}

554 
	gCyşicNodesHeuri¡ic
::
AssignToPoŞs
(cÚ¡ 
DSNodeLi¡_t
 &
NodesToPA
,

555 
FunùiÚ
 *
F
, 
DSG¿ph
* 
G
,

556 
¡d
::
veùÜ
<
OÃPoŞ
> &
ResuÉPoŞs
) {

557 
i
 = 0, 
	ge
 = 
NodesToPA
.
size
(); 
	gi
 !ğ
e
; ++i)

558 ià(
NodeExi¡sInCyşe
(
NodesToPA
[
i
]))

559 
	gResuÉPoŞs
.
push_back
(
OÃPoŞ
(
NodesToPA
[
i
]));

567 
boŞ


568 
	gSm¬tCßÎesûNodesHeuri¡ic
::
	$runOnModuË
 (
ModuË
 & Module) {

572 
M
 = &
ModuË
;

577 
G¿phs
 = &
g‘AÇlysis
<
EQTDD©aSŒuùu»s
>();

583 
	`fšdGlob®PoŞNodes
 (
Glob®PoŞNodes
);

586  
çl£
;

587 
	}
}

590 
	gSm¬tCßÎesûNodesHeuri¡ic
::
AssignToPoŞs
(cÚ¡ 
DSNodeLi¡_t
 &
NodesToPA
,

591 
FunùiÚ
 *
F
, 
DSG¿ph
* 
G
,

592 
¡d
::
veùÜ
<
OÃPoŞ
> &
ResuÉPoŞs
) {

595 ià(
F
 == 0) {

596 
i
 = 0, 
	ge
 = 
NodesToPA
.
size
(); 
	gi
 !ğ
e
; ++i) {

597 cÚ¡ 
DSNode
 *
	gNode
 = 
NodesToPA
[
i
];

598 ià((
	gNode
->
isNodeCom¶‘–yFŞded
(è|| !Node->
isA¼ayNode
()) &&

599 
NodeExi¡sInCyşe
(
Node
))

600 
	gResuÉPoŞs
.
push_back
(
OÃPoŞ
(
Node
));

609 
boŞ
 
	$NodeIsS–fRecursive
(
DSNode
 *
N
) {

610 
DSNode
::
™”©Ü
 
I
 = 
N
->
	`begš
(), 
E
 = N->
	`’d
(); I != E; ++I)

611 ià(*
I
 =ğ
N
è 
Œue
;

612  
çl£
;

613 
	}
}

620 
POVis™
(
DSNode
 *
N
, 
¡d
::
£t
<DSNode*> &
Vis™ed
,

621 
¡d
::
veùÜ
<
DSNode
*> &
Ord”
) {

622 ià(!
Vis™ed
.
š£¹
(
N
).
£cÚd
) ;

625 
	gDSNode
::
™”©Ü
 
I
 = 
N
->
begš
(), 
	gE
 = N->
’d
(); 
	gI
 !ğ
E
; ++I)

626 ià(
DSNode
 *
	gC
 = 
cÚ¡_ÿ¡
<DSNode*>(*
I
))

627 
POVis™
(
C
, 
Vis™ed
, 
Ord”
);

629 
	gOrd”
.
push_back
(
N
);

636 
Heuri¡ic
) {

637 
Sm¬tCßÎesûNodes
: {

638 
¡d
::
£t
<
DSNode
*> 
	`NodesToPAS‘
(
NodesToPA
.
	`begš
(), NodesToPA.
	`’d
());

642 
¡d
::
m­
<
DSNode
*, std::
veùÜ
<DSNode*> > 
Inv”£G¿ph
;

644 
i
 = 0, 
e
 = 
NodesToPA
.
	`size
(); i !=ƒ; ++i) {

645 
DSNode
 *
Node
 = 
NodesToPA
[
i
];

646 
DSNode
::
™”©Ü
 
CI
 = 
Node
->
	`begš
(), 
E
 = Node->
	`’d
(); CI != E; ++CI)

647 ià(
DSNode
 *
Chd
 = 
cÚ¡_ÿ¡
<DSNode*>(*
CI
))

648 ià(
NodesToPAS‘
.
	`couÁ
(
Chd
))

649 
Inv”£G¿ph
[
Chd
].
	`push_back
(
Node
);

658 
¡d
::
£t
<
DSNode
*> 
Vis™ed
;

659 
¡d
::
veùÜ
<
DSNode
*> 
Ord”
;

660 
i
 = 0, 
e
 = 
NodesToPA
.
	`size
(); i !=ƒ; ++i)

661 
	`POVis™
(
NodesToPA
[
i
], 
Vis™ed
, 
Ord”
);

664 
¡d
::
	`»v”£
(
Ord”
.
	`begš
(), Ord”.
	`’d
());

669 
i
 = 0, 
e
 = 
Ord”
.
	`size
(); i !=ƒ; ++i)

670 ià(
NodesToPAS‘
.
	`couÁ
(
Ord”
[
i
])) {

671 
DSNode
 *
N
 = 
Ord”
[
i
];

675 ià(
	`NodeIsS–fRecursive
(
N
)) {

677 
V®ue
 *
AI
 = 
Ãw
 
	`AÎoÿIn¡
(
PoŞDescTy³
, 0, "PD", 
In£¹Pošt
);

680 ià(
N
->
	`isNodeCom¶‘–yFŞded
())

681 
¡d
::
û¼
 << "NodcŞÏpsšg iÀ'" << 
F
.
	`g‘Name
() << "'\n";

684 
PoŞDesütÜs
.
	`š£¹
(
¡d
::
	`make_·œ
(
N
, 
AI
));

686 } ià(
N
->
	`isA¼ay
(è&& !N->
	`isNodeCom¶‘–yFŞded
()) {

688 
PoŞDesütÜs
[
N
] =

689 
CÚ¡ªt
::
	`g‘NuÎV®ue
(
Poš‹rTy³
::
	`g‘Unqu®
(
PoŞDescTy³
));

690 ++
NumNÚ´of™
;

704 
¡d
::
veùÜ
<
DSNode
*> &
P»ds
 = 
Inv”£G¿ph
[
N
];

705 
V®ue
 *
P»dPoŞ
 = 0;

706 
boŞ
 
HasUnvis™edP»d
 = 
çl£
;

707 
boŞ
 
HasA¼ayP»d
 = 
çl£
;

708 
boŞ
 
HasMuÉËP»dPoŞs
 = 
çl£
;

709 
p
 = 0, 
e
 = 
P»ds
.
	`size
();… !=ƒ; ++p) {

710 
DSNode
 *
P»d
 = 
P»ds
[
p
];

711 ià(!
PoŞDesütÜs
.
	`couÁ
(
P»d
))

712 
HasUnvis™edP»d
 = 
Œue
;

713 ià(
P»d
->
	`isA¼ay
(è&& !P»d->
	`isNodeCom¶‘–yFŞded
())

714 
HasA¼ayP»d
 = 
Œue
;

715 ià(
P»dPoŞ
 && 
PoŞDesütÜs
[
P»d
] != PredPool)

716 
HasMuÉËP»dPoŞs
 = 
Œue
;

717 ià(!
P»dPoŞ
 &&

718 !
i§
<
CÚ¡ªtPoš‹rNuÎ
>(
PoŞDesütÜs
[
P»d
]))

719 
P»dPoŞ
 = 
PoŞDesütÜs
[
P»d
];

723 ià(
HasMuÉËP»dPoŞs
) {

726 
PoŞDesütÜs
[
N
] =

727 
CÚ¡ªt
::
	`g‘NuÎV®ue
(
Poš‹rTy³
::
	`g‘Unqu®
(
PoŞDescTy³
));

728 ++
NumNÚ´of™
;

729 } ià(
P»dPoŞ
) {

732 
PoŞDesütÜs
[
N
] = 
P»dPoŞ
;

733 ++
NumCŞoÿ‹d
;

734 } ià(
HasA¼ayP»d
 || 
HasUnvis™edP»d
) {

738 
V®ue
 *
AI
 = 
Ãw
 
	`AÎoÿIn¡
(
PoŞDescTy³
, 0, "PD", 
In£¹Pošt
);

739 ià(
N
->
	`isNodeCom¶‘–yFŞded
())

740 
¡d
::
û¼
 << "NodcŞÏpsšg iÀ'" << 
F
.
	`g‘Name
() << "'\n";

742 
PoŞDesütÜs
[
N
] = 
AI
;

746 
	`as£¹
(
P»dPoŞ
 == 0);

747 
PoŞDesütÜs
[
N
] =

748 
CÚ¡ªt
::
	`g‘NuÎV®ue
(
Poš‹rTy³
::
	`g‘Unqu®
(
PoŞDescTy³
));

749 ++
NumNÚ´of™
;

754 
	}
}

764 
boŞ


765 
	gAÎInOÃGlob®PoŞHeuri¡ic
::
	$runOnModuË
 (
ModuË
 & Module) {

769 
M
 = &
ModuË
;

774 
G¿phs
 = &
g‘AÇlysis
<
EQTDD©aSŒuùu»s
>();

780 
	`fšdGlob®PoŞNodes
 (
Glob®PoŞNodes
);

783  
çl£
;

784 
	}
}

787 
	gAÎInOÃGlob®PoŞHeuri¡ic
::
AssignToPoŞs
(cÚ¡ 
DSNodeLi¡_t
 &
NodesToPA
,

788 
FunùiÚ
 *
F
, 
DSG¿ph
* 
G
,

789 
¡d
::
veùÜ
<
OÃPoŞ
> &
ResuÉPoŞs
) {

790 ià(
TheGlob®PD
 == 0)

791 
TheGlob®PD
 = 
PA
->
C»©eGlob®PoŞ
(0, 0);

794 
OÃPoŞ
 
	gPoŞ
;

795 
	gPoŞ
.
	gNodesInPoŞ
 = 
NodesToPA
;

796 
	gPoŞ
.
	gPoŞDesc
 = 
TheGlob®PD
;

797 
	gResuÉPoŞs
.
push_back
(
PoŞ
);

807 
boŞ


808 
	gOÆyOv”h—dHeuri¡ic
::
	$runOnModuË
 (
ModuË
 & Module) {

812 
M
 = &
ModuË
;

817 
G¿phs
 = &
g‘AÇlysis
<
EQTDD©aSŒuùu»s
>();

823 
	`fšdGlob®PoŞNodes
 (
Glob®PoŞNodes
);

826  
çl£
;

827 
	}
}

830 
	gOÆyOv”h—dHeuri¡ic
::
AssignToPoŞs
(cÚ¡ 
DSNodeLi¡_t
 &
NodesToPA
,

831 
FunùiÚ
 *
F
, 
DSG¿ph
* 
G
,

832 
¡d
::
veùÜ
<
OÃPoŞ
> &
ResuÉPoŞs
) {

834 
i
 = 0, 
	ge
 = 
NodesToPA
.
size
(); 
	gi
 !ğ
e
; ++i)

835 
	gResuÉPoŞs
.
push_back
(
OÃPoŞ
(
NodesToPA
[
i
]));

841 
V®ue
 *

842 
g‘DyÇmiÿÎyNuÎPoŞ
(
BasicBlock
::
™”©Ü
 
I
) {

845 
V®ue
 *
NuÎGlob®
 = 0;

846 ià(!
	gNuÎGlob®
) {

847 
ModuË
 *
	gM
 = 
I
->
g‘P¬’t
()->getParent()->getParent();

848 
Ty³
 * 
	gPoŞTy
 = 
PoŞAÎoÿ‹
::
PoŞDescPŒTy
;

849 
CÚ¡ªt
 * 
	gIn™
 = 
CÚ¡ªtPoš‹rNuÎ
::
g‘
(
ÿ¡
<
Poš‹rTy³
>(
PoŞTy
));

850 
	gNuÎGlob®
 = 
Ãw
 
Glob®V¬ŸbË
(*
M
,

851 
PoŞAÎoÿ‹
::
PoŞDescPŒTy
, 
çl£
,

852 
Glob®V®ue
::
Ex‹º®Lškage
,

853 
In™
,

856 
	gi§
<
	gAÎoÿIn¡
>(
	gI
)) ++I;

858  
Ãw
 
LßdIn¡
(
NuÎGlob®
, "nuÎpd", 
I
);

865 
	gOÆyOv”h—dHeuri¡ic
::
HackFunùiÚBody
(
FunùiÚ
 &
F
,

866 
¡d
::
m­
<cÚ¡ 
DSNode
*, 
V®ue
*> &
PDs
) {

867 
CÚ¡ªt
 *
	gPoŞIn™
 = 
PA
->
PoŞIn™
;

868 
CÚ¡ªt
 *
	gPoŞDe¡roy
 = 
PA
->
PoŞDe¡roy
;

870 
V®ue
 *
	gNuÎPD
 = 
g‘DyÇmiÿÎyNuÎPoŞ
(
F
.
äÚt
().
begš
());

871 
	g¡d
::
m­
<cÚ¡ 
DSNode
*, 
	gV®ue
*>::
™”©Ü
 
PDI
 = 
PDs
.
begš
(),

872 
	gE
 = 
PDs
.
’d
(); 
	gPDI
 !ğ
E
; ++PDI) {

873 
V®ue
 *
	gOldPD
 = 
PDI
->
£cÚd
;

874 
	g¡d
::
veùÜ
<
U£r
*> 
OldPDU£rs
(
OldPD
->
u£_begš
(), OldPD->
u£_’d
());

875 
	gi
 = 0, 
	ge
 = 
OldPDU£rs
.
size
(); i !ğ
e
; ++i) {

876 
C®lS™e
 
PDU£r
(
ÿ¡
<
In¡ruùiÚ
>(
OldPDU£rs
[
i
]));

877 ià(
	gPDU£r
.
g‘C®ËdV®ue
(è!ğ
PoŞIn™
 &&

878 
PDU£r
.
g‘C®ËdV®ue
(è!ğ
PoŞDe¡roy
) {

879 
as£¹
(
PDU£r
.
g‘In¡ruùiÚ
()->
g‘P¬’t
()->g‘P¬’t(è=ğ&
F
 &&

881 
	gPDU£r
.
g‘In¡ruùiÚ
()->
»¶aûU£sOfW™h
(
OldPD
, 
NuÎPD
);

892 
boŞ


893 
	gNoNodesHeuri¡ic
::
	$runOnModuË
 (
ModuË
 & Module) {

897 
M
 = &
ModuË
;

900  
çl£
;

901 
	}
}

906 
	gRegi¡”Pass
<
	gAÎButUÄ—chabËFromMemÜyHeuri¡ic
>

907 
B
 ("paheur-AllButUnreachableFromMemory", "Pool‡llocate‡ll„eachable from memory objects");

909 
	gRegi¡”Pass
<
	gCyşicNodesHeuri¡ic
>

910 
C
 ("paheur-CyclicNodes", "Pool‡llocate‚odes with cycles");

912 
	gRegi¡”Pass
<
	gSm¬tCßÎesûNodesHeuri¡ic
>

913 
D
 ("paheur-SmartCoallesceNodes", "Pool‡llocate usinghe smart‚ode merging heuristic ");

915 
	gRegi¡”Pass
<
	gAÎInOÃGlob®PoŞHeuri¡ic
>

916 
E
 ("paheur-AllInOneGlobalPool", "Pool‡llocate usinghe…ool†ibraryo„eplace malloc/free");

918 
	gRegi¡”Pass
<
	gOÆyOv”h—dHeuri¡ic
>

919 
F
 ("paheur-OnlyOverhead", "Do‚ot…ool‡llocate‡nything, but induce‡ll overhead from it");

921 
	gRegi¡”Pass
<
	gNoNodesHeuri¡ic
>

922 
G
 ("paheur-NoNodes", "Pool‡llocate‚othing heuristic");

927 
	gRegi¡”AÇlysisGroup
<
	gHeuri¡ic
>

928 
Heuri¡icGroup
 ("Pool Allocation Heuristic");

930 
	gRegi¡”AÇlysisGroup
<
	gHeuri¡ic
> 
Heuri¡ic2
(
B
);

931 
	gRegi¡”AÇlysisGroup
<
	gHeuri¡ic
> 
Heuri¡ic3
(
C
);

932 
	gRegi¡”AÇlysisGroup
<
	gHeuri¡ic
> 
Heuri¡ic4
(
D
);

933 
	gRegi¡”AÇlysisGroup
<
	gHeuri¡ic
> 
Heuri¡ic5
(
E
);

934 
	gRegi¡”AÇlysisGroup
<
	gHeuri¡ic
> 
Heuri¡ic6
(
F
);

935 
	gRegi¡”AÇlysisGroup
<
	gHeuri¡ic
, 
	gŒue
> 
Heuri¡ic7
(
G
);

937 
	gHeuri¡ic
::
ID
 = 0;

938 
	gAÎButUÄ—chabËFromMemÜyHeuri¡ic
::
ID
 = 0;

939 
	gCyşicNodesHeuri¡ic
::
ID
 = 0;

940 
	gSm¬tCßÎesûNodesHeuri¡ic
::
ID
 = 0;

941 
	gAÎInOÃGlob®PoŞHeuri¡ic
::
ID
 = 0;

942 
	gOÆyOv”h—dHeuri¡ic
::
ID
 = 0;

943 
	gNoNodesHeuri¡ic
::
ID
 = 0;

	@PAMultipleGlobalPool.cpp

16 
	#DEBUG_TYPE
 "poŞ®loc"

	)

18 
	~"d§/D©aSŒuùu».h
"

19 
	~"d§/DSG¿ph.h
"

20 
	~"d§/C®lT¬g‘s.h
"

21 
	~"poŞ®loc/PoŞAÎoÿ‹.h
"

22 
	~"Îvm/CÚ¡ªts.h
"

23 
	~"Îvm/D”ivedTy³s.h
"

24 
	~"Îvm/In¡ruùiÚs.h
"

25 
	~"Îvm/ModuË.h
"

26 
	~"Îvm/CÚ¡ªts.h
"

27 
	~"Îvm/SuµÜt/CFG.h
"

28 
	~"Îvm/SuµÜt/Ty³Bud”.h
"

29 
	~"Îvm/T¬g‘/T¬g‘D©a.h
"

30 
	~"Îvm/T¿nsfÜms/Uts/BasicBlockUts.h
"

31 
	~"Îvm/T¿nsfÜms/Uts/ClÚšg.h
"

32 
	~"Îvm/ADT/D•thFœ¡I‹¿tÜ.h
"

33 
	~"Îvm/ADT/Sti¡ic.h
"

34 
	~"Îvm/ADT/STLExŒas.h
"

35 
	~"Îvm/SuµÜt/CommªdLše.h
"

36 
	~"Îvm/SuµÜt/Debug.h
"

37 
	~"Îvm/SuµÜt/FÜm©‹dSŒ—m.h
"

38 
	~"Îvm/SuµÜt/Tim”.h
"

40 
	~<io¡»am
>

42 
usšg
 
Çme¥aû
 
	gÎvm
;

43 
usšg
 
Çme¥aû
 
	gPA
;

45 
	gÎvm
::
PoŞAÎoÿ‹MuÉËGlob®PoŞ
::
ID
 = 0;

47 
	gÇme¥aû
 {

48 
	gRegi¡”Pass
<
	gPoŞAÎoÿ‹MuÉËGlob®PoŞ
>

49 
X
("poolalloc-multi-global-pool", "Pool‡llocate objects into multiple global…ools");

51 
	gRegi¡”AÇlysisGroup
<
	gPoŞAÎoÿ‹Group
> 
PAGroup1
(
X
);

54 
šlše
 
V®ue
 *

55 
ÿ¡To
 (
V®ue
 * 
V
, 
Ty³
 * 
Ty
, cÚ¡ 
¡d
::
¡ršg
 & 
Name
, 
In¡ruùiÚ
 * 
In£¹Pt
) {

59 ià(
	gV
->
g‘Ty³
(è=ğ
Ty
)

60  
V
;

65 ià(
CÚ¡ªt
 * 
	gC
 = 
dyn_ÿ¡
<CÚ¡ªt>(
V
)) {

66 
CÚ¡ªt
 * 
CE
 = 
CÚ¡ªtEx´
::
g‘ZExtOrB™Ca¡
 (
C
, 
Ty
);

67  
	gCE
;

73  
	gCa¡In¡
::
C»©eZExtOrB™Ca¡
 (
V
, 
Ty
, 
Name
, 
In£¹Pt
);

76 
	gPoŞAÎoÿ‹MuÉËGlob®PoŞ
::
	$g‘AÇlysisU§ge
(
AÇlysisU§ge
 &
AU
) const {

77 
AU
.
addRequœed
<
T¬g‘D©a
>();

78 
	`as£¹
(0 && "PoolAllocateMultipleGlobalPool doesn't work! Needs Steensgard-like‡nalysis, which was„emoved!");

81 
AU
.
	`£tP»£rvesAÎ
();

82 
	}
}

84 
boŞ
 
	gPoŞAÎoÿ‹MuÉËGlob®PoŞ
::
	$runOnModuË
(
ModuË
 &
M
) {

85 
cu¼’tModuË
 = &
M
;

86 ià(
M
.
	`begš
(è=ğM.
	`’d
()è 
çl£
;

91 
VoidTy³
 = 
Ty³
::
	`g‘VoidTy
(
	`g‘Glob®CÚ‹xt
());

92 
IÁ8Ty³
 = 
IÁeg”Ty³
::
	`g‘IÁ8Ty
(
	`g‘Glob®CÚ‹xt
());

93 
IÁ32Ty³
 = 
IÁeg”Ty³
::
	`g‘IÁ32Ty
(
	`g‘Glob®CÚ‹xt
());

96 
G¿phs
 = 
NULL
;

97 
	`as£¹
 (
G¿phs
 && "No DSA…ass‡vailable!\n");

99 
T¬g‘D©a
 & 
TD
 = 
g‘AÇlysis
<TargetData>();

102 
	`AddPoŞPrÙÙy³s
(&
M
);

107 
	`C»©eGlob®PoŞ
(32, 1, 
M
);

112 
ModuË
::
™”©Ü
 
I
 = 
M
.
	`begš
(), 
E
 = M.
	`’d
(); I != E; ++I) {

113 
¡d
::
¡ršg
 
Çme
 = 
I
->
	`g‘Name
();

114 ià(
Çme
 == "__poolalloc_init") ;

115 ià(!(
I
->
	`isDeş¬©iÚ
()))

116 
	`ProûssFunùiÚBodySim¶e
(*
I
, 
TD
);

119  
Œue
;

120 
	}
}

123 
	gPoŞAÎoÿ‹MuÉËGlob®PoŞ
::
	$ProûssFunùiÚBodySim¶e
 (
FunùiÚ
& 
F
, 
T¬g‘D©a
 & 
TD
) {

124 
¡d
::
veùÜ
<
In¡ruùiÚ
*> 
toD–‘e
;

125 
¡d
::
veùÜ
<
R‘uºIn¡
*> 
R‘uºs
;

130 
FuncInfo
 
	`FInfo
(
F
);

131 
FunùiÚInfo
.
	`š£¹
 (
¡d
::
	`make_·œ
(&
F
, 
FInfo
));

136 
DSG¿ph
* 
ECG
 = 
G¿phs
->
	`g‘DSG¿ph
(
F
);

137 
DSSÿÏrM­
 & 
SM
 = 
ECG
->
	`g‘SÿÏrM­
();

139 
FunùiÚ
::
™”©Ü
 
i
 = 
F
.
	`begš
(), 
e
 = F.
	`’d
(); i !=ƒ; ++i)

140 
BasicBlock
::
™”©Ü
 
ii
 = 
i
->
	`begš
(), 
“
 = i->
	`’d
(); ii !=ƒe; ++ii) {

142 ià(
çl£
) {

145 
DSNode
 * 
Node
 = 
ECG
->
	`g‘NodeFÜV®ue
(
MI
).
	`g‘Node
();

146 
Glob®V¬ŸbË
 * 
PoŞ
 = 
PoŞM­
[
Node
];

147 
FInfo
.
PoŞDesütÜs
.
	`š£¹
(
¡d
::
	`make_·œ
(
Node
,
PoŞ
));

150 
toD–‘e
.
	`push_back
(
ii
);

154 
V®ue
 * 
AÎocSize
;

155 ià(
MI
->
	`isA¼ayAÎoÿtiÚ
()) {

156 
V®ue
 * 
NumEËm’ts
 = 
MI
->
	`g‘A¼aySize
();

157 
V®ue
 * 
EËm’tSize
 = 
CÚ¡ªtIÁ
::
	`g‘
(
IÁ32Ty³
,

158 
TD
.
	`g‘Ty³AÎocSize
(
MI
->
	`g‘AÎoÿ‹dTy³
()));

159 
AÎocSize
 = 
Bš¬yO³¿tÜ
::
	`C»©e
 (
In¡ruùiÚ
::
Mul
,

160 
EËm’tSize
,

161 
NumEËm’ts
,

163 
MI
);

165 
AÎocSize
 = 
CÚ¡ªtIÁ
::
	`g‘
(
IÁ32Ty³
,

166 
TD
.
	`g‘Ty³AÎocSize
(
MI
->
	`g‘AÎoÿ‹dTy³
()));

169 
V®ue
* 
¬gs
[] = {
PoŞ
, 
AÎocSize
};

170 
In¡ruùiÚ
* 
x
 = 
C®lIn¡
::
	`C»©e
(
PoŞAÎoc
, &
¬gs
[0], &¬gs[2], 
MI
->
	`g‘Name
(), 
ii
);

171 
V®ue
 * 
ÿ¡ed
 = 
	`ÿ¡To
(
x
, 
ii
->
	`g‘Ty³
(), "", ii);

172 
ii
->
	`»¶aûAÎU£sW™h
(
ÿ¡ed
);

175 
DSNodeHªdË
 
NH
 = 
SM
[
ii
];

176 
SM
.
	`”a£
(
ii
);

177 
SM
[
ÿ¡ed
] = SM[
x
] = 
NH
;

179 } ià(
C®lIn¡
 * 
CI
 = 
dyn_ÿ¡
<C®lIn¡>(
ii
)) {

180 
C®lS™e
 
	`CS
(
CI
);

181 
FunùiÚ
 *
CF
 = 
CS
.
	`g‘C®ËdFunùiÚ
();

182 ià(
CÚ¡ªtEx´
 *
CE
 = 
dyn_ÿ¡
<CÚ¡ªtEx´>(
CS
.
	`g‘C®ËdV®ue
()))

183 ià(
CE
->
	`g‘Opcode
(è=ğ
In¡ruùiÚ
::
B™Ca¡
 &&

184 
i§
<
FunùiÚ
>(
CE
->
	`g‘O³¿nd
(0)))

185 
CF
 = 
ÿ¡
<
FunùiÚ
>(
CE
->
	`g‘O³¿nd
(0));

186 ià(
CF
 && (CF->
	`isDeş¬©iÚ
()è&& (CF->
	`g‘Name
() == "realloc")) {

188 
DSNode
 * 
Node
 = 
ECG
->
	`g‘NodeFÜV®ue
(
CI
).
	`g‘Node
();

189 
Glob®V¬ŸbË
 * 
PoŞ
 = 
PoŞM­
[
Node
];

191 
FInfo
.
PoŞDesütÜs
.
	`š£¹
(
¡d
::
	`make_·œ
(
Node
,
PoŞ
));

194 
toD–‘e
.
	`push_back
(
ii
);

197 
In¡ruùiÚ
 *
In£¹Pt
 = 
CI
;

198 
V®ue
 *
OldPŒ
 = 
CS
.
	`g‘Argum’t
(0);

199 
V®ue
 *
Size
 = 
CS
.
	`g‘Argum’t
(1);

202 ià(
Size
->
	`g‘Ty³
(è!ğ
IÁ32Ty³
)

203 
Size
 = 
Ca¡In¡
::
	`C»©eIÁeg”Ca¡
 (Size,

204 
IÁ32Ty³
,

205 
çl£
,

206 
Size
->
	`g‘Name
(),

207 
In£¹Pt
);

209 
Ty³
 *
VoidPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
IÁ8Ty³
);

210 ià(
OldPŒ
->
	`g‘Ty³
(è!ğ
VoidPŒTy
)

211 
OldPŒ
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
 (OldPtr,

212 
VoidPŒTy
,

213 
OldPŒ
->
	`g‘Name
(),

214 
In£¹Pt
);

216 
¡d
::
¡ršg
 
Name
 = 
CI
->
	`g‘Name
(); CI->
	`£tName
("");

217 
V®ue
* 
O±s
[3] = {
PoŞ
, 
OldPŒ
, 
Size
};

218 
In¡ruùiÚ
 *
V
 = 
C®lIn¡
::
	`C»©e
 (
PoŞR—Îoc
,

219 
O±s
,

220 
Name
,

221 
In£¹Pt
);

222 
V®ue
 *
Ca¡ed
 = 
	`ÿ¡To
(
V
, 
CI
->
	`g‘Ty³
(), V->
	`g‘Name
(), 
In£¹Pt
);

225 
CI
->
	`»¶aûAÎU£sW™h
(
Ca¡ed
);

228 
DSNodeHªdË
 
NH
 = 
SM
[
CI
];

229 
SM
.
	`”a£
(
CI
);

230 
SM
[
Ca¡ed
] = SM[
V
] = 
NH
;

231 } ià(
CF
 && (CF->
	`isDeş¬©iÚ
()è&& (CF->
	`g‘Name
() == "calloc")) {

233 
DSNode
 * 
Node
 = 
ECG
->
	`g‘NodeFÜV®ue
(
CI
).
	`g‘Node
();

234 
Glob®V¬ŸbË
 * 
PoŞ
 = 
PoŞM­
[
Node
];

235 
FInfo
.
PoŞDesütÜs
.
	`š£¹
(
¡d
::
	`make_·œ
(
Node
,
PoŞ
));

238 
toD–‘e
.
	`push_back
(
ii
);

241 
In¡ruùiÚ
 *
In£¹Pt
 = 
CI
;

242 
V®ue
 *
NumEËm’ts
 = 
CS
.
	`g‘Argum’t
(0);

243 
V®ue
 *
Size
 = 
CS
.
	`g‘Argum’t
(1);

246 ià(
Size
->
	`g‘Ty³
(è!ğ
IÁ32Ty³
)

247 
Size
 = 
Ca¡In¡
::
	`C»©eIÁeg”Ca¡
 (Size,

248 
IÁ32Ty³
,

249 
çl£
,

250 
Size
->
	`g‘Name
(),

251 
In£¹Pt
);

253 ià(
NumEËm’ts
->
	`g‘Ty³
(è!ğ
IÁ32Ty³
)

254 
NumEËm’ts
 = 
Ca¡In¡
::
	`C»©eIÁeg”Ca¡
 (
Size
,

255 
IÁ32Ty³
,

256 
çl£
,

257 
NumEËm’ts
->
	`g‘Name
(),

258 
In£¹Pt
);

260 
¡d
::
¡ršg
 
Name
 = 
CI
->
	`g‘Name
(); CI->
	`£tName
("");

261 
V®ue
* 
O±s
[3] = {
PoŞ
, 
NumEËm’ts
, 
Size
};

262 
In¡ruùiÚ
 *
V
 = 
C®lIn¡
::
	`C»©e
 (
PoŞC®loc
,

263 
O±s
,

264 
Name
,

265 
In£¹Pt
);

267 
V®ue
 *
Ca¡ed
 = 
	`ÿ¡To
(
V
, 
CI
->
	`g‘Ty³
(), V->
	`g‘Name
(), 
In£¹Pt
);

270 
CI
->
	`»¶aûAÎU£sW™h
(
Ca¡ed
);

273 
DSNodeHªdË
 
NH
 = 
SM
[
CI
];

274 
SM
.
	`”a£
(
CI
);

275 
SM
[
Ca¡ed
] = SM[
V
] = 
NH
;

276 } ià(
CF
 && (CF->
	`isDeş¬©iÚ
()è&& (CF->
	`g‘Name
() == "strdup")) {

278 
DSNode
 * 
Node
 = 
ECG
->
	`g‘NodeFÜV®ue
(
CI
).
	`g‘Node
();

279 
Glob®V¬ŸbË
 * 
PoŞ
 = 
PoŞM­
[
Node
];

280 
FInfo
.
PoŞDesütÜs
.
	`š£¹
(
¡d
::
	`make_·œ
(
Node
, 
PoŞ
));

283 
toD–‘e
.
	`push_back
(
ii
);

286 
In¡ruùiÚ
 *
In£¹Pt
 = 
CI
;

287 
V®ue
 *
OldPŒ
 = 
CS
.
	`g‘Argum’t
(0);

290 
Ty³
 *
VoidPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
IÁ8Ty³
);

291 ià(
OldPŒ
->
	`g‘Ty³
(è!ğ
VoidPŒTy
)

292 
OldPŒ
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
 (OldPtr,

293 
VoidPŒTy
,

294 
OldPŒ
->
	`g‘Name
(),

295 
In£¹Pt
);

297 
¡d
::
¡ršg
 
Name
 = 
CI
->
	`g‘Name
(); CI->
	`£tName
("");

298 
V®ue
* 
O±s
[2] = {
PoŞ
, 
OldPŒ
};

299 
In¡ruùiÚ
 *
V
 = 
C®lIn¡
::
	`C»©e
 (
PoŞSŒdup
,

300 
O±s
,

301 
Name
,

302 
In£¹Pt
);

303 
V®ue
 *
Ca¡ed
 = 
	`ÿ¡To
(
V
, 
CI
->
	`g‘Ty³
(), V->
	`g‘Name
(), 
In£¹Pt
);

306 
CI
->
	`»¶aûAÎU£sW™h
(
Ca¡ed
);

309 
DSNodeHªdË
 
NH
 = 
SM
[
CI
];

310 
SM
.
	`”a£
(
CI
);

311 
SM
[
Ca¡ed
] = SM[
V
] = 
NH
;

315 } ià(
F»eIn¡
 * 
FI
 = 
dyn_ÿ¡
<F»eIn¡ > (
ii
)) {

316 
Ty³
 * 
VoidPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
IÁ8Ty³
);

317 
V®ue
 * 
F»edNode
 = 
	`ÿ¡To
 (
FI
->
	`g‘Poš‹rO³¿nd
(), 
VoidPŒTy
, "ÿ¡", 
ii
);

318 
DSNode
 * 
Node
 = 
ECG
->
	`g‘NodeFÜV®ue
(
FI
->
	`g‘Poš‹rO³¿nd
()).
	`g‘Node
();

319 
Glob®V¬ŸbË
 * 
PoŞ
 = 
PoŞM­
[
Node
];

320 
	`as£¹
 (
PoŞ
 && "No Pool Handle for…oolfree()!");

321 
toD–‘e
.
	`push_back
(
ii
);

322 
V®ue
* 
¬gs
[] = {
PoŞ
, 
F»edNode
};

323 
C®lIn¡
 * 
CI
 = C®lIn¡::
	`C»©e
(
PoŞF»e
, &
¬gs
[0], &¬gs[2], "", 
ii
);

325 
DSNodeHªdË
 
NH
 = 
SM
[
ii
];

326 
SM
.
	`”a£
(
ii
);

327 
SM
[
CI
] = 
NH
;

329 } ià(
i§
<
R‘uºIn¡
>(
ii
)) {

330 
R‘uºs
.
	`push_back
(
ÿ¡
<
R‘uºIn¡
>(
ii
));

335 
x
 = 0; x < 
toD–‘e
.
	`size
(); ++x)

336 
toD–‘e
[
x
]->
	`”a£FromP¬’t
();

337 
	}
}

342 
	gPoŞAÎoÿ‹MuÉËGlob®PoŞ
::
	$C»©eGlob®PoŞ
 (
RecSize
,

343 
Align
,

344 
ModuË
& 
M
) {

346 
FunùiÚ
 *
In™Func
 = FunùiÚ::
C»©e


347 (
FunùiÚTy³
::
	`g‘
(
VoidTy³
, 
¡d
::
veùÜ
<
Ty³
*>(), 
çl£
),

348 
Glob®V®ue
::
Ex‹º®Lškage
, "__poŞ®loc_š™", &
M
);

352 
Ty³
 * 
VoidPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
IÁ8Ty³
);

353 
A¼ayTy³
 * 
LLVMU£dTy
 = A¼ayTy³::
	`g‘
(
VoidPŒTy
, 1);

354 
CÚ¡ªt
 * 
C
 = 
CÚ¡ªtEx´
::
	`g‘B™Ca¡
 (
ÿ¡
<CÚ¡ªt>(
In™Func
), 
VoidPŒTy
);

355 
¡d
::
veùÜ
<
CÚ¡ªt
*> 
	`U£dFunùiÚs
(1,
C
);

356 
CÚ¡ªt
 * 
NewIn™
 = 
CÚ¡ªtA¼ay
::
	`g‘
(
LLVMU£dTy
, 
U£dFunùiÚs
);

358 
Ãw
 
	`Glob®V¬ŸbË
 (
M
, 
LLVMU£dTy
, 
çl£
,

359 
Glob®V®ue
::
Aµ’dšgLškage
,

360 
NewIn™
, "llvm.used");

363 
	`as£¹
(0 && "Not implemented!");

365 
S‹’sg¯rdD©aSŒuùu»s
 * 
DS
 = (S‹’sg¯rdD©aSŒuùu»s*)
G¿phs
;

367 
	`as£¹
 (
DS
 && "PoolAllocateMultipleGlobalPools„equires Steensgaard Data Structure!");

372 
DSG¿ph
 * 
G
 = 
DS
->
	`g‘ResuÉG¿ph
();

373 
DSG¿ph
::
node_cÚ¡_™”©Ü
 
I
 = 
G
->
	`node_begš
(),

374 
E
 = 
G
->
	`node_’d
(); 
I
 != E; ++I) {

375 
	`g’”©ePoŞ
 (
I
->
	`g‘Size
(), 
Align
, 
M
, 
BB
, I);

378 
DSG¿ph
 * 
GG
 = 
DS
->
	`g‘Glob®sG¿ph
();

379 
DSG¿ph
::
node_cÚ¡_™”©Ü
 
I
 = 
GG
->
	`node_begš
(),

380 
E
 = 
GG
->
	`node_’d
(); 
I
 != E; ++I) {

381 ià(
I
->
	`glob®s_begš
(è!ğI->
	`glob®s_’d
()) {

382 cÚ¡ 
Glob®V®ue
 * 
GV
 = *(
I
->
	`glob®s_begš
());

383 
DSNodeHªdË
 
NH
 = 
G
->
	`g‘NodeFÜV®ue
(
GV
);

384 ià(!
NH
.
	`isNuÎ
()) {

385 
PoŞM­
[&*
I
] = PoŞM­[
NH
.
	`g‘Node
()];

387 
	`g’”©ePoŞ
(
I
->
	`g‘Size
(), 
Align
, 
M
, 
BB
, I);

392 
R‘uºIn¡
::
	`C»©e
(
	`g‘Glob®CÚ‹xt
(), 
BB
);

394 
	}
}

397 
	gPoŞAÎoÿ‹MuÉËGlob®PoŞ
::
	$g’”©ePoŞ
(
RecSize
,

398 
Align
,

399 
ModuË
& 
M
,

400 
BasicBlock
 * 
In£¹AtEnd
,

401 cÚ¡ 
DSNode
 * 
Node
) {

403 ià(!
PoŞM­
[
Node
]) {

404 
Glob®V¬ŸbË
 *
GV
 =

405 
Ãw
 
Glob®V¬ŸbË


406 (
M
,

407 
	`g‘PoŞTy³
(&
M
.
	`g‘CÚ‹xt
()), 
çl£
, 
Glob®V®ue
::
Ex‹º®Lškage
,

408 
CÚ¡ªtAgg»g©eZ”o
::
	`g‘
(
	`g‘PoŞTy³
(&
M
.
	`g‘CÚ‹xt
())), "__poolalloc_GlobalPool");

410 
V®ue
 *
ElSize
 = 
CÚ¡ªtIÁ
::
	`g‘
(
IÁ32Ty³
, 
RecSize
);

411 
V®ue
 *
AlignV
 = 
CÚ¡ªtIÁ
::
	`g‘
(
IÁ32Ty³
, 
Align
);

412 
V®ue
* 
O±s
[3] = {
GV
, 
ElSize
, 
AlignV
};

414 
C®lIn¡
::
	`C»©e
(
PoŞIn™
, 
O±s
, "", 
In£¹AtEnd
);

415 
PoŞM­
[
Node
] = 
GV
;

417 
	}
}

420 
V®ue
 *

421 
	gPoŞAÎoÿ‹MuÉËGlob®PoŞ
::
	$g‘Glob®PoŞ
 (cÚ¡ 
DSNode
 * 
Node
) {

422 
V®ue
 * 
PoŞ
 = 
PoŞM­
[
Node
];

423 
	`as£¹
 (
PoŞ
 && "Every DSNode correspondso‡…ool handle!");

424  
PoŞ
;

425 
	}
}

427 
V®ue
 *

428 
	gPoŞAÎoÿ‹MuÉËGlob®PoŞ
::
	$g‘PoŞ
 (cÚ¡ 
DSNode
 * 
N
, 
FunùiÚ
 & 
F
) {

429  
	`g‘Glob®PoŞ
(
N
);

430 
	}
}

433 
	gPoŞAÎoÿ‹MuÉËGlob®PoŞ
::
´št
(
Îvm
::
¿w_o¡»am
 &
OS
, cÚ¡ 
ModuË
 * 
M
) const {

434 
	gPoŞM­Ty
::
cÚ¡_™”©Ü
 
I
 = 
PoŞM­
.
begš
(), 
	gE
 = PoŞM­.
’d
(); 
	gI
 !ğ
E
; ++I) {

435 
	gOS
 << 
	gI
->
	gfœ¡
 << " -> " << I->
	g£cÚd
->
g‘Name
() << "\n";

440 
	gPoŞAÎoÿ‹MuÉËGlob®PoŞ
::
	$dump
() const {

441 
	`´št
 (
	`”rs
(), 
cu¼’tModuË
);

442 
	}
}

444 
	gPoŞAÎoÿ‹MuÉËGlob®PoŞ
::~
	$PoŞAÎoÿ‹MuÉËGlob®PoŞ
(è{
	}
}

	@PASimple.cpp

15 
	#DEBUG_TYPE
 "poŞ®loc"

	)

17 
	~"d§/D©aSŒuùu».h
"

18 
	~"d§/DSG¿ph.h
"

19 
	~"d§/C®lT¬g‘s.h
"

20 
	~"poŞ®loc/PoŞAÎoÿ‹.h
"

21 
	~"Îvm/CÚ¡ªts.h
"

22 
	~"Îvm/D”ivedTy³s.h
"

23 
	~"Îvm/In¡ruùiÚs.h
"

24 
	~"Îvm/ModuË.h
"

25 
	~"Îvm/CÚ¡ªts.h
"

26 
	~"Îvm/SuµÜt/CFG.h
"

27 
	~"Îvm/T¬g‘/T¬g‘D©a.h
"

28 
	~"Îvm/T¿nsfÜms/Uts/BasicBlockUts.h
"

29 
	~"Îvm/T¿nsfÜms/Uts/ClÚšg.h
"

30 
	~"Îvm/ADT/D•thFœ¡I‹¿tÜ.h
"

31 
	~"Îvm/ADT/Sti¡ic.h
"

32 
	~"Îvm/ADT/STLExŒas.h
"

33 
	~"Îvm/SuµÜt/CommªdLše.h
"

34 
	~"Îvm/SuµÜt/Debug.h
"

35 
	~"Îvm/SuµÜt/Tim”.h
"

37 
	~<io¡»am
>

39 
usšg
 
Çme¥aû
 
	gÎvm
;

40 
usšg
 
Çme¥aû
 
	gPA
;

42 
	gÎvm
::
PoŞAÎoÿ‹Sim¶e
::
ID
 = 0;

44 
	gÇme¥aû
 {

45 
	gRegi¡”Pass
<
	gPoŞAÎoÿ‹Sim¶e
>

46 
X
("poolalloc-simple", "Pool‡llocateƒverything into‡ single global…ool");

48 
	gRegi¡”AÇlysisGroup
<
	gPoŞAÎoÿ‹Group
, 
	gŒue
> 
PAGroup1
(
X
);

51 
šlše
 
V®ue
 *

52 
ÿ¡To
 (
V®ue
 * 
V
, 
Ty³
 * 
Ty
, 
¡d
::
¡ršg
 
Name
, 
In¡ruùiÚ
 * 
In£¹Pt
) {

56 ià(
	gV
->
g‘Ty³
(è=ğ
Ty
)

57  
V
;

62 ià(
CÚ¡ªt
 * 
	gC
 = 
dyn_ÿ¡
<CÚ¡ªt>(
V
)) {

63 
CÚ¡ªt
 * 
CE
 = 
CÚ¡ªtEx´
::
g‘ZExtOrB™Ca¡
 (
C
, 
Ty
);

64  
	gCE
;

70  
	gCa¡In¡
::
C»©eZExtOrB™Ca¡
 (
V
, 
Ty
, 
Name
, 
In£¹Pt
);

73 
	gPoŞAÎoÿ‹Sim¶e
::
	$g‘AÇlysisU§ge
(
AÇlysisU§ge
 &
AU
) const {

74 
AU
.
addRequœed
<
T¬g‘D©a
>();

76 ià(
Com¶‘eDSA
) {

77 
AU
.
addRequœedT¿ns™ive
<
EQTDD©aSŒuùu»s
>();

78 
AU
.
addP»£rved
<
EQTDD©aSŒuùu»s
>();

80 
AU
.
addRequœedT¿ns™ive
<
BasicD©aSŒuùu»s
>();

81 
AU
.
addP»£rved
<
BasicD©aSŒuùu»s
>();

84 
AU
.
	`£tP»£rvesAÎ
();

85 
	}
}

95 
	$FŞdNodesInDSG¿ph
 (
DSG¿ph
 & 
G¿ph
) {

97 
¡d
::
veùÜ
<
DSNodeHªdË
> 
H—pNodes
;

102 
DSG¿ph
::
node_™”©Ü
 
i
;

103 
DSG¿ph
::
node_™”©Ü
 
e
 = 
G¿ph
.
	`node_’d
();

104 
i
 = 
G¿ph
.
	`node_begš
(); i !ğ
e
; ++i) {

105 
DSNode
 * 
Node
 = 
i
;

106 ià(
Node
->
	`isH—pNode
())

107 
H—pNodes
.
	`push_back
 (
	`DSNodeHªdË
(
Node
));

113 
i
 = 0; i < 
H—pNodes
.
	`size
(); ++i)

114 
H—pNodes
[
i
].
	`g‘Node
()->
	`fŞdNodeCom¶‘–y
();

116 
	}
}

118 
boŞ
 
	gPoŞAÎoÿ‹Sim¶e
::
	$runOnModuË
(
ModuË
 &
M
) {

119 ià(
M
.
	`begš
(è=ğM.
	`’d
()è 
çl£
;

124 
VoidTy³
 = 
Ty³
::
	`g‘VoidTy
(
M
.
	`g‘CÚ‹xt
());

125 
IÁ8Ty³
 = 
IÁeg”Ty³
::
	`g‘IÁ8Ty
(
M
.
	`g‘CÚ‹xt
());

126 
IÁ32Ty³
 = 
IÁeg”Ty³
::
	`g‘IÁ32Ty
(
M
.
	`g‘CÚ‹xt
());

129 ià(
Com¶‘eDSA
) {

130 
G¿phs
 = &
g‘AÇlysis
<
EQTDD©aSŒuùu»s
>();

132 
G¿phs
 = &
g‘AÇlysis
<
BasicD©aSŒuùu»s
>();

134 
	`as£¹
 (
G¿phs
 && "No DSA…ass‡vailable!\n");

135 
T¬g‘D©a
 & 
TD
 = 
g‘AÇlysis
<TargetData>();

138 
	`AddPoŞPrÙÙy³s
(&
M
);

145 
Glob®ECs
 = 
G¿phs
->
	`g‘Glob®ECs
();

146 
CombšedDSG¿ph
 = 
Ãw
 
	`DSG¿ph
 (
Glob®ECs
,

147 
TD
,

148 
G¿phs
->
	`g‘Ty³SS
(),

149 
G¿phs
->
	`g‘Glob®sG¿ph
());

150 
ModuË
::
™”©Ü
 
I
 = 
M
.
	`begš
(), 
E
 = M.
	`’d
(); I != E; ++I) {

151 ià(
G¿phs
->
	`hasDSG¿ph
 (*
I
))

152 
CombšedDSG¿ph
->
	`şÚeIÁo
 (
G¿phs
->
	`g‘DSG¿ph
(*
I
));

160 
	`FŞdNodesInDSG¿ph
 (*
CombšedDSG¿ph
);

161 
	`FŞdNodesInDSG¿ph
 (*(
CombšedDSG¿ph
->
	`g‘Glob®sG¿ph
()));

166 
TheGlob®PoŞ
 = 
	`C»©eGlob®PoŞ
(1, 1, 
M
);

172 
ModuË
::
™”©Ü
 
I
 = 
M
.
	`begš
(), 
E
 = M.
	`’d
(); I != E; ++I) {

176 
¡d
::
¡ršg
 
Çme
 = 
I
->
	`g‘Name
();

177 ià(
Çme
 == "__poolalloc_init") ;

178 ià(
Çme
 =ğ
PoŞIn™
->
	`g‘Name
().
	`¡r
()) ;

183 ià(!(
I
->
	`isDeş¬©iÚ
()))

184 
	`ProûssFunùiÚBodySim¶e
(*
I
, 
TD
);

187  
Œue
;

188 
	}
}

191 
	gPoŞAÎoÿ‹Sim¶e
::
	$ProûssFunùiÚBodySim¶e
 (
FunùiÚ
& 
F
, 
T¬g‘D©a
 & 
TD
) {

195 
¡d
::
veùÜ
<
In¡ruùiÚ
*> 
toD–‘e
;

200 
FuncInfo
 
	`FInfo
(
F
);

201 
FunùiÚInfo
.
	`š£¹
 (
¡d
::
	`make_·œ
(&
F
, 
FInfo
));

207 
FunùiÚ
::
™”©Ü
 
i
 = 
F
.
	`begš
(), 
e
 = F.
	`’d
(); i !=ƒ; ++i) {

208 
BasicBlock
::
™”©Ü
 
ii
 = 
i
->
	`begš
(), 
“
 = i->
	`’d
(); ii !=ƒe; ++ii) {

209 ià(
C®lIn¡
 * 
CI
 = 
dyn_ÿ¡
<C®lIn¡>(
ii
)) {

213 
C®lS™e
 
	`CS
(
CI
);

214 
FunùiÚ
 *
CF
 = 
CS
.
	`g‘C®ËdFunùiÚ
();

215 ià(
CÚ¡ªtEx´
 *
CE
 = 
dyn_ÿ¡
<CÚ¡ªtEx´>(
CS
.
	`g‘C®ËdV®ue
())) {

216 ià(
CE
->
	`g‘Opcode
(è=ğ
In¡ruùiÚ
::
B™Ca¡
 &&

217 
i§
<
FunùiÚ
>(
CE
->
	`g‘O³¿nd
(0))) {

218 
CF
 = 
ÿ¡
<
FunùiÚ
>(
CE
->
	`g‘O³¿nd
(0));

225 ià(
CF
 && (CF->
	`isDeş¬©iÚ
()è&& (CF->
	`g‘Name
() == "malloc")) {

227 
DSNode
 * 
Node
 = 
CombšedDSG¿ph
->
	`g‘NodeFÜV®ue
(
CI
).
	`g‘Node
();

228 
FInfo
.
PoŞDesütÜs
.
	`š£¹
(
¡d
::
	`make_·œ
(
Node
,
TheGlob®PoŞ
));

231 
toD–‘e
.
	`push_back
(
CI
);

234 
In¡ruùiÚ
 *
In£¹Pt
 = 
CI
;

235 
V®ue
 *
Size
 = 
CS
.
	`g‘Argum’t
(0);

238 ià(
Size
->
	`g‘Ty³
(è!ğ
IÁ32Ty³
)

239 
Size
 = 
Ca¡In¡
::
	`C»©eIÁeg”Ca¡
 (Size,

240 
IÁ32Ty³
,

241 
çl£
,

242 
Size
->
	`g‘Name
(),

243 
In£¹Pt
);

249 
¡d
::
¡ršg
 
Name
 = 
CI
->
	`g‘Name
(); CI->
	`£tName
("");

254 
V®ue
* 
O±s
[2] = {
TheGlob®PoŞ
, 
Size
};

255 
In¡ruùiÚ
 *
V
 = 
C®lIn¡
::
	`C»©e
 (
PoŞAÎoc
,

256 
O±s
,

257 
Name
,

258 
In£¹Pt
);

263 
CombšedDSG¿ph
->
	`g‘SÿÏrM­
().
	`»¶aûSÿÏr
 (
CI
, 
V
);

265 
In¡ruùiÚ
 *
Ca¡ed
 = 
V
;

266 ià(
V
->
	`g‘Ty³
(è!ğ
CI
->getType())

267 
Ca¡ed
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
 (
V
, 
CI
->
	`g‘Ty³
(), V->
	`g‘Name
(), 
In£¹Pt
);

270 
CI
->
	`»¶aûAÎU£sW™h
(
Ca¡ed
);

271 } ià(
CF
 && (CF->
	`isDeş¬©iÚ
()è&& (CF->
	`g‘Name
() == "memalign")) {

272 
DSNode
 * 
Node
 = 
CombšedDSG¿ph
->
	`g‘NodeFÜV®ue
(
CI
).
	`g‘Node
();

273 
FInfo
.
PoŞDesütÜs
.
	`š£¹
(
¡d
::
	`make_·œ
(
Node
,
TheGlob®PoŞ
));

276 
toD–‘e
.
	`push_back
(
CI
);

279 
In¡ruùiÚ
 *
In£¹Pt
 = 
CI
;

280 
V®ue
 *
Size
 = 
CS
.
	`g‘Argum’t
(0);

281 
V®ue
 *
Align
 = 
CS
.
	`g‘Argum’t
(1);

284 ià(
Size
->
	`g‘Ty³
(è!ğ
IÁ32Ty³
)

285 
Size
 = 
Ca¡In¡
::
	`C»©eIÁeg”Ca¡
 (Size,

286 
IÁ32Ty³
,

287 
çl£
,

288 
Size
->
	`g‘Name
(),

289 
In£¹Pt
);

290 ià(
Align
->
	`g‘Ty³
(è!ğ
IÁ32Ty³
)

291 
Align
 = 
Ca¡In¡
::
	`C»©eIÁeg”Ca¡
 (Align,

292 
IÁ32Ty³
,

293 
çl£
,

294 
Align
->
	`g‘Name
(),

295 
In£¹Pt
);

300 
¡d
::
¡ršg
 
Name
 = 
CI
->
	`g‘Name
(); CI->
	`£tName
("");

305 
V®ue
* 
O±s
[3] = {
TheGlob®PoŞ
, 
Align
, 
Size
};

306 
In¡ruùiÚ
 *
V
 = 
C®lIn¡
::
	`C»©e
 (
PoŞMemAlign
,

307 
O±s
,

308 
Name
,

309 
In£¹Pt
);

314 
CombšedDSG¿ph
->
	`g‘SÿÏrM­
().
	`»¶aûSÿÏr
 (
CI
, 
V
);

316 
In¡ruùiÚ
 *
Ca¡ed
 = 
V
;

317 ià(
V
->
	`g‘Ty³
(è!ğ
CI
->getType())

318 
Ca¡ed
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
 (
V
, 
CI
->
	`g‘Ty³
(), V->
	`g‘Name
(), 
In£¹Pt
);

321 
CI
->
	`»¶aûAÎU£sW™h
(
Ca¡ed
);

322 } ià(
CF
 && (CF->
	`isDeş¬©iÚ
()è&& (CF->
	`g‘Name
() == "realloc")) {

324 
DSNode
 * 
Node
 = 
CombšedDSG¿ph
->
	`g‘NodeFÜV®ue
(
CI
).
	`g‘Node
();

325 
FInfo
.
PoŞDesütÜs
.
	`š£¹
(
¡d
::
	`make_·œ
(
Node
,
TheGlob®PoŞ
));

328 
toD–‘e
.
	`push_back
(
ii
);

331 
In¡ruùiÚ
 *
In£¹Pt
 = 
CI
;

332 
V®ue
 *
OldPŒ
 = 
CS
.
	`g‘Argum’t
(0);

333 
V®ue
 *
Size
 = 
CS
.
	`g‘Argum’t
(1);

336 ià(
Size
->
	`g‘Ty³
(è!ğ
IÁ32Ty³
)

337 
Size
 = 
Ca¡In¡
::
	`C»©eIÁeg”Ca¡
 (Size,

338 
IÁ32Ty³
,

339 
çl£
,

340 
Size
->
	`g‘Name
(),

341 
In£¹Pt
);

343 
Ty³
 *
VoidPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
IÁ8Ty³
);

344 ià(
OldPŒ
->
	`g‘Ty³
(è!ğ
VoidPŒTy
)

345 
OldPŒ
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
 (OldPtr,

346 
VoidPŒTy
,

347 
OldPŒ
->
	`g‘Name
(),

348 
In£¹Pt
);

350 
¡d
::
¡ršg
 
Name
 = 
CI
->
	`g‘Name
(); CI->
	`£tName
("");

351 
V®ue
* 
O±s
[3] = {
TheGlob®PoŞ
, 
OldPŒ
, 
Size
};

352 
In¡ruùiÚ
 *
V
 = 
C®lIn¡
::
	`C»©e
 (
PoŞR—Îoc
,

353 
O±s
,

354 
Name
,

355 
In£¹Pt
);

359 
CombšedDSG¿ph
->
	`g‘SÿÏrM­
().
	`»¶aûSÿÏr
 (
CI
, 
V
);

361 
In¡ruùiÚ
 *
Ca¡ed
 = 
V
;

362 ià(
V
->
	`g‘Ty³
(è!ğ
CI
->getType())

363 
Ca¡ed
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
 (
V
, 
CI
->
	`g‘Ty³
(), V->
	`g‘Name
(), 
In£¹Pt
);

366 
CI
->
	`»¶aûAÎU£sW™h
(
Ca¡ed
);

367 } ià(
CF
 && (CF->
	`isDeş¬©iÚ
()è&& (CF->
	`g‘Name
() == "calloc")) {

369 
DSNode
 * 
Node
 = 
CombšedDSG¿ph
->
	`g‘NodeFÜV®ue
(
CI
).
	`g‘Node
();

370 
FInfo
.
PoŞDesütÜs
.
	`š£¹
(
¡d
::
	`make_·œ
(
Node
,
TheGlob®PoŞ
));

373 
toD–‘e
.
	`push_back
(
ii
);

376 
In¡ruùiÚ
 *
In£¹Pt
 = 
CI
;

377 
V®ue
 *
NumEËm’ts
 = 
CS
.
	`g‘Argum’t
(0);

378 
V®ue
 *
Size
 = 
CS
.
	`g‘Argum’t
(1);

381 ià(
Size
->
	`g‘Ty³
(è!ğ
IÁ32Ty³
)

382 
Size
 = 
Ca¡In¡
::
	`C»©eIÁeg”Ca¡
 (Size,

383 
IÁ32Ty³
,

384 
çl£
,

385 
Size
->
	`g‘Name
(),

386 
In£¹Pt
);

388 ià(
NumEËm’ts
->
	`g‘Ty³
(è!ğ
IÁ32Ty³
)

389 
NumEËm’ts
 = 
Ca¡In¡
::
	`C»©eIÁeg”Ca¡
 (NumElements,

390 
IÁ32Ty³
,

391 
çl£
,

392 
NumEËm’ts
->
	`g‘Name
(),

393 
In£¹Pt
);

395 
¡d
::
¡ršg
 
Name
 = 
CI
->
	`g‘Name
(); CI->
	`£tName
("");

396 
V®ue
* 
O±s
[3] = {
TheGlob®PoŞ
, 
NumEËm’ts
, 
Size
};

397 
In¡ruùiÚ
 *
V
 = 
C®lIn¡
::
	`C»©e
 (
PoŞC®loc
,

398 
O±s
,

399 
Name
,

400 
In£¹Pt
);

405 
CombšedDSG¿ph
->
	`g‘SÿÏrM­
().
	`»¶aûSÿÏr
 (
CI
, 
V
);

407 
In¡ruùiÚ
 *
Ca¡ed
 = 
V
;

408 ià(
V
->
	`g‘Ty³
(è!ğ
CI
->getType())

409 
Ca¡ed
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
 (
V
, 
CI
->
	`g‘Ty³
(), V->
	`g‘Name
(), 
In£¹Pt
);

412 
CI
->
	`»¶aûAÎU£sW™h
(
Ca¡ed
);

413 } ià(
CF
 && (CF->
	`isDeş¬©iÚ
()è&& (CF->
	`g‘Name
() == "strdup")) {

415 
DSNode
 * 
Node
 = 
CombšedDSG¿ph
->
	`g‘NodeFÜV®ue
(
CI
).
	`g‘Node
();

416 
FInfo
.
PoŞDesütÜs
.
	`š£¹
(
¡d
::
	`make_·œ
(
Node
,
TheGlob®PoŞ
));

419 
toD–‘e
.
	`push_back
(
ii
);

422 
In¡ruùiÚ
 *
In£¹Pt
 = 
CI
;

423 
V®ue
 *
OldPŒ
 = 
CS
.
	`g‘Argum’t
(0);

426 
Ty³
 *
VoidPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
IÁ8Ty³
);

427 ià(
OldPŒ
->
	`g‘Ty³
(è!ğ
VoidPŒTy
)

428 
OldPŒ
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
 (OldPtr,

429 
VoidPŒTy
,

430 
OldPŒ
->
	`g‘Name
(),

431 
In£¹Pt
);

433 
¡d
::
¡ršg
 
Name
 = 
CI
->
	`g‘Name
(); CI->
	`£tName
("");

434 
V®ue
* 
O±s
[2] = {
TheGlob®PoŞ
, 
OldPŒ
};

435 
In¡ruùiÚ
 *
V
 = 
C®lIn¡
::
	`C»©e
 (
PoŞSŒdup
,

436 
O±s
,

437 
Name
,

438 
In£¹Pt
);

443 
CombšedDSG¿ph
->
	`g‘SÿÏrM­
().
	`»¶aûSÿÏr
 (
CI
, 
V
);

445 
In¡ruùiÚ
 *
Ca¡ed
 = 
V
;

446 ià(
V
->
	`g‘Ty³
(è!ğ
CI
->getType())

447 
Ca¡ed
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
 (
V
, 
CI
->
	`g‘Ty³
(), V->
	`g‘Name
(), 
In£¹Pt
);

450 
CI
->
	`»¶aûAÎU£sW™h
(
Ca¡ed
);

451 } ià(
CF
 && (CF->
	`isDeş¬©iÚ
()è&& ((CF->
	`g‘Name
() == "free") || (CF->getName() == "cfree"))) {

452 
Ty³
 * 
VoidPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
IÁ8Ty³
);

453 
V®ue
 * 
F»edNode
 = 
	`ÿ¡To
 (
CI
->
	`g‘O³¿nd
(0), 
VoidPŒTy
, "ÿ¡", 
ii
);

454 
toD–‘e
.
	`push_back
(
ii
);

455 
V®ue
* 
¬gs
[] = {
TheGlob®PoŞ
, 
F»edNode
};

456 
C®lIn¡
::
	`C»©e
(
PoŞF»e
, 
¬gs
, "", 
ii
);

464 ià(
CF
) {

465 
CouÁ
 = 
	`g‘NumIn™ŸlPoŞArgum’ts
(
CF
->
	`g‘Name
());

466 
Ty³
 * 
VoidPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
IÁ8Ty³
);

467 
V®ue
 * 
PoŞ
 = 
	`ÿ¡To
 (
TheGlob®PoŞ
, 
VoidPŒTy
, "poŞ", 
ii
);

468 
ArgIndex
 = 0; ArgIndex < 
CouÁ
; ArgIndex++ )

469 
CI
->
	`£tArgO³¿nd
 (
ArgIndex
, 
PoŞ
);

478 
x
 = 0; x < 
toD–‘e
.
	`size
(); ++x)

479 
toD–‘e
[
x
]->
	`”a£FromP¬’t
();

480 
	}
}

484 
Glob®V¬ŸbË
 *

485 
	gPoŞAÎoÿ‹Sim¶e
::
	$C»©eGlob®PoŞ
 (
RecSize
,

486 
Align
,

487 
ModuË
& 
M
) {

492 ià(
Glob®V¬ŸbË
 * 
GV
 = 
M
.
	`g‘NamedGlob®
 ("__poolalloc_GlobalPool")) {

493  
GV
;

499 
Glob®V¬ŸbË
 *
GV
 =

500 
Ãw
 
	`Glob®V¬ŸbË
(
M
,

501 
	`g‘PoŞTy³
(&
M
.
	`g‘CÚ‹xt
()), 
çl£
, 
Glob®V®ue
::
Ex‹º®Lškage
,

502 
CÚ¡ªtAgg»g©eZ”o
::
	`g‘
(
	`g‘PoŞTy³
(&
M
.
	`g‘CÚ‹xt
())),

510 
FunùiÚ
 *
In™Func
 = 
	`ü—‹Glob®PoŞCtÜ
(
M
);

511 
V®ue
 *
ElSize
 = 
CÚ¡ªtIÁ
::
	`g‘
(
IÁ32Ty³
, 
RecSize
);

512 
V®ue
 *
AlignV
 = 
CÚ¡ªtIÁ
::
	`g‘
(
IÁ32Ty³
, 
Align
);

513 
V®ue
 *
O±s
[3] = { 
GV
, 
ElSize
, 
AlignV
 };

515 
C®lIn¡
 *
In™C®l
 = C®lIn¡::
	`C»©e
(
PoŞIn™
, 
O±s
, "");

516 
In™C®l
->
	`š£¹BefÜe
(&
In™Func
->
	`g‘EÁryBlock
().
	`äÚt
());

518  
GV
;

519 
	}
}

	@PointerCompress.cpp

14 
	#DEBUG_TYPE
 "poš‹rcom´ess"

	)

16 
	~"d§/D©aSŒuùu».h
"

17 
	~"d§/DSG¿ph.h
"

18 
	~"poŞ®loc/Heuri¡ic.h
"

19 
	~"poŞ®loc/PoŞAÎoÿ‹.h
"

20 
	~"Îvm/CÚ¡ªts.h
"

21 
	~"Îvm/In¡ruùiÚs.h
"

22 
	~"Îvm/ModuË.h
"

23 
	~"Îvm/ADT/Sti¡ic.h
"

24 
	~"Îvm/ADT/STLExŒas.h
"

25 
	~"Îvm/SuµÜt/CommªdLše.h
"

26 
	~"Îvm/SuµÜt/Debug.h
"

27 
	~"Îvm/SuµÜt/G‘EËm’tPŒTy³I‹¿tÜ.h
"

28 
	~"Îvm/SuµÜt/In¡Vis™Ü.h
"

29 
	~"Îvm/SuµÜt/FÜm©‹dSŒ—m.h
"

31 
	~"Îvm/T¿nsfÜms/Uts/ClÚšg.h
"

33 
usšg
 
Çme¥aû
 
	gÎvm
;

38 
Ty³
 *
	gMEMUINTTYPE
;

42 
Ty³
 *
	gSCALARUINTTYPE
;

44 
Ty³
 * 
	gVoidTy³
 = 0;

45 
Ty³
 * 
	gIÁ8Ty³
 = 0;

46 
Ty³
 * 
	gIÁ16Ty³
 = 0;

47 
Ty³
 * 
	gIÁ32Ty³
 = 0;

48 
Ty³
 * 
	gIÁ64Ty³
 = 0;

50 
	gÇme¥aû
 {

51 
	gş
::
İt
<
boŞ
>

52 
Sm®lIÁCom´ess
("compress-to-16-bits",

53 
ş
::
desc
("Pointer compress data structureso 16 bit "

55 
	gş
::
İt
<
boŞ
>

56 
Di§bËPoŞBa£ASR
("disable-ptrcomp-poolbase-aggregation",

57 
ş
::
desc
("Don't optimize…ool base†oads"));

58 
	gş
::
İt
<
boŞ
>

59 
ADLFix
("adl-pc",

60 
ş
::
desc
("Enable Andrew's fixes/hacks"));

63 
STATISTIC
 (
NumCom´es£d
, "Number of…ools…ointer compressed");

64 
STATISTIC
 (
NumNÙCom´es£d
, "Number of…ools‚ot compressible");

65 
STATISTIC
 (
NumClÚed
 , "Number of functions cloned");

67 
şass
 
	gCom´es£dPoŞInfo
;

71 
	sFunùiÚClÚeRecÜd
 {

74 
FunùiÚ
 *
	gPAFn
;

75 
FunùiÚClÚeRecÜd
(
FunùiÚ
 *
·â
è: 
PAFn
(pafn) {}

81 
¡d
::
m­
<cÚ¡ 
DSNode
*, 
	gV®ue
*> 
	gPoŞDesütÜs
;

85 
	g¡d
::
m­
<
V®ue
*, cÚ¡ 
	gV®ue
*> 
	gNewToOldV®ueM­
;

87 cÚ¡ 
V®ue
 *
g‘V®ueInOrigš®FunùiÚ
(V®u*
V
) const {

88 
	g¡d
::
m­
<
V®ue
*, cÚ¡ 
	gV®ue
*>::
cÚ¡_™”©Ü
 
I
 =

89 
NewToOldV®ueM­
.
fšd
(
V
);

90 ià(
	gI
 =ğ
NewToOldV®ueM­
.
’d
()) {

91 
I
 = 
NewToOldV®ueM­
.
begš
(); 
	gI
 !ğNewToOldV®ueM­.
’d
(); ++I)

92 
”rs
(è<< "MAP: " << *
	gI
->
	gfœ¡
 << " TO: " << *I->
	g£cÚd
 << "\n";

94 
as£¹
 (
I
 !ğ
NewToOldV®ueM­
.
’d
() && "Value did‚ot come from clone!");

95  
	gI
->
	g£cÚd
;

101 şas 
	cPoš‹rCom´ess
 : 
public
 
ModuËPass
 {

102 
PoŞAÎoÿ‹
 *
PoŞAÎoc
;

103 
Com¶‘eBUD©aSŒuùu»s
 *
	gECG
;

107 
	g¡d
::
	t·œ
<
	tFunùiÚ
*, 
	t¡d
::
	t£t
<cÚ¡ 
	tDSNode
*> > 
	tClÚeID
;

108 
	g¡d
::
m­
<
ClÚeID
, 
	gFunùiÚ
 *> 
	gClÚedFunùiÚM­
;

110 
	g¡d
::
m­
<
¡d
::
·œ
<
FunùiÚ
*, std::
veùÜ
<> >,

111 
	gFunùiÚ
*> 
	gExtClÚeFunùiÚM­
;

115 
	g¡d
::
m­
<
FunùiÚ
*, 
	gFunùiÚClÚeRecÜd
> 
	gClÚedFunùiÚInfoM­
;

120 
	g¡d
::
m­
<cÚ¡ 
DSNode
*, 
	gGlob®V®ue
*> 
	gCom´es£dGlob®PoŞs
;

122 
	gpublic
:

123 
CÚ¡ªt
 *
PoŞIn™PC
, *
	gPoŞDe¡royPC
, *
	gPoŞAÎocPC
;

124 
	g¡d
::
	tm­
<cÚ¡ 
	tDSNode
*, 
	tCom´es£dPoŞInfo
> 
	tPoŞInfoM­
;

125 
	gID
;

127 
Poš‹rCom´ess
(è: 
ModuËPass
(
ID
) {}

131 
¡d
::
veùÜ
<
FunùiÚ
*> 
NoArgFunùiÚsC®Ëd
;

133 
boŞ
 
runOnModuË
(
ModuË
 &
M
);

135 
HªdËGlob®PoŞs
(
ModuË
 &
M
);

138 
g‘AÇlysisU§ge
(
AÇlysisU§ge
 &
AU
) const;

140 
PoŞAÎoÿ‹
 *
g‘PoŞAÎoc
(ècÚ¡ {  
	gPoŞAÎoc
; }

142 cÚ¡ 
DSG¿ph
* 
g‘G¿phFÜFunc
(
PA
::
FuncInfo
 *
FI
) const {

143  
ECG
->
g‘DSG¿ph
(
FI
->
F
);

149 
FunùiÚClÚeRecÜd
 *
g‘ClÚeInfo
(
FunùiÚ
 &
F
) {

150 
	g¡d
::
m­
<
FunùiÚ
*, 
	gFunùiÚClÚeRecÜd
>::
™”©Ü
 
I
 =

151 
ClÚedFunùiÚInfoM­
.
fšd
(&
F
);

152  
	gI
 =ğ
ClÚedFunùiÚInfoM­
.
’d
(è? 0 : &
I
->
£cÚd
;

155 
FunùiÚ
 *
G‘FunùiÚClÚe
(FunùiÚ *
F
,

156 
¡d
::
£t
<cÚ¡ 
DSNode
*> &
PoŞsToCom´ess
,

157 
PA
::
FuncInfo
 &
FI
, cÚ¡ 
DSG¿ph
 &
CG
);

158 
FunùiÚ
 *
G‘ExtFunùiÚClÚe
(FunùiÚ *
F
,

159 cÚ¡ 
¡d
::
veùÜ
<> &
Args
);

161 
	g´iv©e
:

162 
In™ŸlizePoŞLib¿ryFunùiÚs
(
ModuË
 &
M
);

163 
boŞ
 
Com´essPoŞsInFunùiÚ
(
FunùiÚ
 &
F
,

164 
¡d
::
veùÜ
<¡d::
·œ
<
V®ue
*, V®ue*> > *
P»m­³dV®s
 = 0,

165 
¡d
::
£t
<cÚ¡ 
DSNode
*> *
Ex‹º®PoŞsToCom´ess
 = 0);

167 
FšdPoŞsToCom´ess
(
¡d
::
£t
<cÚ¡ 
DSNode
*> &
PoŞs
,

168 
¡d
::
m­
<cÚ¡ 
DSNode
*, 
V®ue
*> &
P»assigÃdPoŞs
,

169 
FunùiÚ
 &
F
, 
DSG¿ph
* 
DSG
, 
PA
::
FuncInfo
 *
FI
);

172 
	gPoš‹rCom´ess
::
ID
 = 0;

173 
	gRegi¡”Pass
<
	gPoš‹rCom´ess
>

174 
X
("pointercompress", "Compressype-safe data structures");

181 
	gÇme¥aû
 {

184 şas 
	cCom´es£dPoŞInfo
 {

185 cÚ¡ 
DSNode
 *
	gPoŞ
;

186 
V®ue
 *
	gPoŞDesc
;

187 
Ty³
 *
	gNewTy
;

188 
	gNewSize
;

189 
mubË
 
V®ue
 *
	gPoŞBa£
;

190 
	gpublic
:

191 
Com´es£dPoŞInfo
(cÚ¡ 
DSNode
 *
N
, 
V®ue
 *
PD
)

192 : 
PoŞ
(
N
), 
PoŞDesc
(
PD
), 
NewTy
(0), 
PoŞBa£
(0) {}

196 
In™Ÿlize
(
¡d
::
m­
<cÚ¡ 
DSNode
*, 
Com´es£dPoŞInfo
> &
Nodes
,

197 cÚ¡ 
T¬g‘D©a
 &
TD
);

199 cÚ¡ 
DSNode
 *
g‘Node
(ècÚ¡ {  
	gPoŞ
; }

200 
Ty³
 *
g‘NewTy³
(ècÚ¡ {  
	gNewTy
; }

204 
g‘NewSize
(ècÚ¡ {  
	gNewSize
; }

208 
V®ue
 *
g‘PoŞDesc
(ècÚ¡ {  
	gPoŞDesc
; }

212 
V®ue
 *
Em™PoŞBa£Lßd
(
In¡ruùiÚ
 &
I
) const;

213 
£tPoŞBa£
(
V®ue
 *
PB
ècÚ¡ { 
	gPoŞBa£
 = PB; }

216 
dump
() const;

218 
	g´iv©e
:

219 
Ty³
 *
Compu‹Com´es£dTy³
(Ty³ *
OrigTy
, 
NodeOff£t
,

220 
¡d
::
m­
<cÚ¡ 
DSNode
*, 
Com´es£dPoŞInfo
> &
Nodes
);

226 
	gCom´es£dPoŞInfo
::
In™Ÿlize
(
¡d
::
m­
<cÚ¡ 
DSNode
*,

227 
Com´es£dPoŞInfo
> &
Nodes
,

228 cÚ¡ 
T¬g‘D©a
 &
TD
) {

233 
	gNewTy
 = 0;

237 
	gNewSize
 = 0;

244 
Ty³
 *
	gCom´es£dPoŞInfo
::

245 
Compu‹Com´es£dTy³
(
Ty³
 *
OrigTy
, 
NodeOff£t
,

246 
¡d
::
m­
<cÚ¡ 
DSNode
*, 
Com´es£dPoŞInfo
> &
Nodes
) {

247 ià(
	gdyn_ÿ¡
<
	gPoš‹rTy³
>(
	gOrigTy
)) {

248 ià(
	gADLFix
) {

249 
DSNode
 *
	gPoš‹eNode
 = 
g‘Node
()->
g‘Lšk
(
NodeOff£t
).getNode();

250 ià(
	gPoš‹eNode
 =ğ
g‘Node
())

251  
MEMUINTTYPE
;

252  
	gOrigTy
;

259  
	gMEMUINTTYPE
;

261  
	gOrigTy
;

262 } ià(
	gOrigTy
->
isFœ¡CÏssTy³
(è|| OrigTy =ğ
VoidTy³
)

263  
OrigTy
;

266 cÚ¡ 
	gT¬g‘D©a
 &
	gTD
 = 
g‘Node
()->
g‘P¬’tG¿ph
()->
g‘T¬g‘D©a
();

269 ià(
SŒuùTy³
 *
	gSTy
 = 
dyn_ÿ¡
<SŒuùTy³>(
OrigTy
)) {

270 
¡d
::
veùÜ
<
Ty³
*> 
EËm’ts
;

271 
	gEËm’ts
.
»£rve
(
STy
->
g‘NumEËm’ts
());

273 cÚ¡ 
SŒuùLayout
 *
	gSL
 = 
TD
.
g‘SŒuùLayout
(
STy
);

275 
	gi
 = 0, 
	ge
 = 
STy
->
g‘NumEËm’ts
(); i !ğ
e
; ++i)

276 
	gEËm’ts
.
push_back
(
Compu‹Com´es£dTy³
(
STy
->
g‘EËm’tTy³
(
i
),

277 
NodeOff£t
+
SL
->
g‘EËm’tOff£t
(
i
),

278 
Nodes
));

279  
	gSŒuùTy³
::
g‘
(
STy
->
g‘CÚ‹xt
(),
EËm’ts
);

280 } ià(
A¼ayTy³
 *
	gATy
 = 
dyn_ÿ¡
<A¼ayTy³>(
OrigTy
)) {

281  
A¼ayTy³
::
g‘
(
Compu‹Com´es£dTy³
(
ATy
->
g‘EËm’tTy³
(),

282 
NodeOff£t
, 
Nodes
),

283 
ATy
->
g‘NumEËm’ts
());

285 
”rs
(è<< "TYPE: " << *
	gOrigTy
 << "\n";

286 
as£¹
(0 && "FIXME: Unhandled‡ggregateype!");

287 
abÜt
();

293 
V®ue
 *
	gCom´es£dPoŞInfo
::
	$Em™PoŞBa£Lßd
(
In¡ruùiÚ
 &
I
) const {

294 ià(
Di§bËPoŞBa£ASR
) {

295 
	`as£¹
(
PoŞBa£
 == 0 && "Mixing‡nd matching optimized vs‚ot!");

298 
CÚ¡ªt
 *
Z”o
 = 
CÚ¡ªtIÁ
::
	`g‘
(
IÁ32Ty³
, 0);

299 
V®ue
 *
O±s
[2] = {
Z”o
, Zero};

300 
V®ue
 *
Ba£PŒPŒ
 = 
G‘EËm’tPŒIn¡
::
	`C»©e
(
	`g‘PoŞDesc
(), 
O±s
,

301 "poŞba£±½Œ", &
I
);

302  
Ãw
 
	`LßdIn¡
(
Ba£PŒPŒ
, "poŞba£±r", &
I
);

306 ià(
PoŞBa£
 =ğ0 && (
i§
<
Argum’t
>(
PoŞDesc
) ||

307 
i§
<
Glob®V¬ŸbË
>(
PoŞDesc
))) {

308 
BasicBlock
::
™”©Ü
 
IP
 = 
I
.
	`g‘P¬’t
()->g‘P¬’t()->
	`begš
()->begin();

309 
i§
<
AÎoÿIn¡
>(
IP
)) ++IP;

310 
CÚ¡ªt
 *
Z”o
 = 
CÚ¡ªtIÁ
::
	`g‘
(
IÁ32Ty³
, 0);

311 
V®ue
 *
O±s
[2] = {
Z”o
, Zero};

312 
V®ue
 *
Ba£PŒPŒ
 = 
G‘EËm’tPŒIn¡
::
	`C»©e
(
	`g‘PoŞDesc
(), 
O±s
,

313 "poŞba£±½Œ", 
IP
);

314 
PoŞBa£
 = 
Ãw
 
	`LßdIn¡
(
Ba£PŒPŒ
, "poŞba£±r", 
IP
);

317 
	`as£¹
(
PoŞBa£
 && "Mixing‡nd matching optimized vs‚ot!");

318  
PoŞBa£
;

320 
	}
}

325 
	gCom´es£dPoŞInfo
::
	$dump
() const {

335 
	}
}

342 
Çme¥aû
 {

348 
şass
 
In¡ruùiÚRewr™”
 : 
public
 
Îvm
::
In¡Vis™Ü
<InstructionRewriter> {

351 
¡d
::
m­
<
V®ue
*, 
	gV®ue
*> 
	gOldToNewV®ueM­
;

353 cÚ¡ 
	gPoš‹rCom´ess
::
PoŞInfoM­
 &
PoŞInfo
;

357 cÚ¡ 
	gT¬g‘D©a
 &
	gTD
;

360 
DSG¿ph
* 
	gDSG
;

364 
	gPA
::
FuncInfo
 &
PAFuncInfo
;

369 
FunùiÚClÚeRecÜd
 *
	gFCR
;

371 
	gPoš‹rCom´ess
 &
	gPŒComp
;

372 
	gpublic
:

373 
In¡ruùiÚRewr™”
(cÚ¡ 
Poš‹rCom´ess
::
PoŞInfoM­
 &
poŞInfo
,

374 
DSG¿ph
* 
dsg
, 
PA
::
FuncInfo
 &
·fi
,

375 
FunùiÚClÚeRecÜd
 *
fü
, 
Poš‹rCom´ess
 &
±rcomp
)

376 : 
PoŞInfo
(
poŞInfo
), 
TD
(
dsg
->
g‘T¬g‘D©a
()), 
DSG
(dsg),

377 
PAFuncInfo
(
·fi
), 
FCR
(
fü
), 
PŒComp
(
±rcomp
) {

380 ~
In¡ruùiÚRewr™”
();

386 
P»m­V®ues
(
¡d
::
veùÜ
<¡d::
·œ
<
V®ue
*, V®ue*> > &
V®s
) {

387 
	gi
 = 0, 
	ge
 = 
V®s
.
size
(); i !ğ
e
; ++i)

388 
	gOldToNewV®ueM­
.
š£¹
(
V®s
[
i
]);

393 
V®ue
 *
g‘T¿nsfÜmedV®ue
(V®u*
V
) {

394 ià(
	gi§
<
	gCÚ¡ªtPoš‹rNuÎ
>(
	gV
))

395  
	gCÚ¡ªtIÁ
::
g‘
(
SCALARUINTTYPE
, 0);

396 ià(
	gi§
<
	gUndefV®ue
>(
	gV
))

397  
	gUndefV®ue
::
g‘
(
SCALARUINTTYPE
);

399 ià(!
g‘NodeIfCom´es£d
(
V
))

400 
as£¹
(
g‘NodeIfCom´es£d
(
V
) && "Value is‚ot compressed!");

401 
	gV®ue
 *&
	gRV
 = 
OldToNewV®ueM­
[
V
];

402 ià(
	gRV
)  RV;

404 
	gRV
 = 
Ãw
 
Argum’t
(
SCALARUINTTYPE
);

405  
	gRV
;

410 
£tT¿nsfÜmedV®ue
(
In¡ruùiÚ
 &
Old
, 
V®ue
 *
New
) {

411 
	gV®ue
 *&
	gEV
 = 
OldToNewV®ueM­
[&
Old
];

412 ià(
	gEV
) {

413 
as£¹
(
i§
<
Argum’t
>(
EV
) && "Not‡ forward„eference!");

414 
	gEV
->
»¶aûAÎU£sW™h
(
New
);

415 
d–‘e
 
	gEV
;

417 
	gEV
 = 
New
;

423 
DSNodeHªdË
 
g‘M­³dNodeHªdË
(
V®ue
 *
V
) {

424 
as£¹
(
i§
<
Poš‹rTy³
>(
V
->
g‘Ty³
()) && "Not‡…ointer value!");

427 ià(
	gFCR
)

428 
	gV
 = 
cÚ¡_ÿ¡
<
V®ue
*>(
FCR
->
g‘V®ueInOrigš®FunùiÚ
(
V
));

432 ià(!
	gPAFuncInfo
.
	gNewToOldV®ueM­
.
em±y
())

433 ià((
	gV
 = 
PAFuncInfo
.
M­V®ueToOrigš®
(
V
)) == 0)

435  
DSNodeHªdË
();

437  
	gDSG
->
g‘NodeFÜV®ue
(
V
);

442 cÚ¡ 
DSNode
 *
g‘NodeIfCom´es£d
(
V®ue
 *
V
) {

443 ià(!
	gi§
<
	gPoš‹rTy³
>(
	gV
->
g‘Ty³
()è|| i§<
	gCÚ¡ªtPoš‹rNuÎ
>(V) ||

444 
	gi§
<
	gFunùiÚ
>(
	gV
))

447 
DSNode
 *
	gN
 = 
g‘M­³dNodeHªdË
(
V
).
g‘Node
();

448  
	gPoŞInfo
.
couÁ
(
N
è? 
	gN
 : 0;

453 cÚ¡ 
	gCom´es£dPoŞInfo
 &
g‘PoŞInfo
(cÚ¡ 
DSNode
 *
N
) {

454 
as£¹
(
N
 && "Pool‚ot compressed!");

455 
	gPoš‹rCom´ess
::
PoŞInfoM­
::
cÚ¡_™”©Ü
 
I
 = 
PoŞInfo
.
fšd
(
N
);

456 
as£¹
(
I
 !ğ
PoŞInfo
.
’d
() && "Pool is‚ot compressed!");

457  
	gI
->
	g£cÚd
;

462 cÚ¡ 
Com´es£dPoŞInfo
 *
g‘PoŞInfo
(
V®ue
 *
V
) {

463 ià(cÚ¡ 
DSNode
 *
	gN
 = 
g‘NodeIfCom´es£d
(
V
))

464  &
g‘PoŞInfo
(
N
);

470 cÚ¡ 
Com´es£dPoŞInfo
 *
g‘PoŞInfoFÜPoŞDesc
(
V®ue
 *
PD
) const {

471 
	gPoš‹rCom´ess
::
PoŞInfoM­
::
cÚ¡_™”©Ü
 
I
 = 
PoŞInfo
.
begš
(),

472 
	gE
 = 
PoŞInfo
.
’d
(); 
	gI
 !ğ
E
; ++I)

473 ià(
	gI
->
	g£cÚd
.
g‘PoŞDesc
(è=ğ
PD
)

474  &
I
->
£cÚd
;

481 
V®ueRemoved
(
V®ue
 *
V
) {

482 ià(
	gFCR
) {

484 
	gFCR
->
	gNewToOldV®ueM­
.
”a£
(
V
);

485 } ià(!
	gPAFuncInfo
.
	gNewToOldV®ueM­
.
em±y
()) {

487 
	gPAFuncInfo
.
	gNewToOldV®ueM­
.
”a£
(
V
);

491 
	gDSG
->
g‘SÿÏrM­
().
”a£IfExi¡s
(
V
);

498 
V®ueR•Ïûd
(
V®ue
 &
Old
, V®u*
New
) {

500 ià(
	gFCR
) {

501 
	g¡d
::
m­
<
V®ue
*, cÚ¡ 
	gV®ue
*>::
™”©Ü
 
I
 =

502 
FCR
->
NewToOldV®ueM­
.
fšd
(&
Old
);

503 
as£¹
(
I
 !ğ
FCR
->
NewToOldV®ueM­
.
’d
() && "Didn't findƒlement!?");

504 
	gFCR
->
	gNewToOldV®ueM­
.
š£¹
(
¡d
::
make_·œ
(
New
, 
I
->
£cÚd
));

505 
	gFCR
->
	gNewToOldV®ueM­
.
”a£
(
I
);

506 } ià(!
	gPAFuncInfo
.
	gNewToOldV®ueM­
.
em±y
()) {

508 
	gPA
::
FuncInfo
::
NewToOldV®ueM­Ty
::
™”©Ü
 
I
 =

509 
PAFuncInfo
.
NewToOldV®ueM­
.
fšd
(&
Old
);

510 ià(
	gI
 !ğ
PAFuncInfo
.
NewToOldV®ueM­
.
’d
()) {

511 
PAFuncInfo
.
NewToOldV®ueM­
[
New
] = 
I
->
£cÚd
;

512 
	gPAFuncInfo
.
	gNewToOldV®ueM­
.
”a£
(
I
);

519 ià(
	gDSG
->
g‘SÿÏrM­
().
couÁ
(&
Old
))

520 
	gDSG
->
g‘SÿÏrM­
().
»¶aûSÿÏr
(&
Old
, 
New
);

528 
vis™R‘uºIn¡
(
R‘uºIn¡
 &
RI
);

529 
vis™Ca¡In¡
(
Ca¡In¡
 &
CI
);

530 
vis™PHINode
(
PHINode
 &
PN
);

531 
vis™S–eùIn¡
(
S–eùIn¡
 &
SI
);

532 
vis™ICmpIn¡
(
ICmpIn¡
 &
I
);

533 
vis™FCmpIn¡
(
FCmpIn¡
 &
I
);

534 
vis™G‘EËm’tPŒIn¡
(
G‘EËm’tPŒIn¡
 &
GEPI
);

535 
vis™LßdIn¡
(
LßdIn¡
 &
LI
);

536 
vis™StÜeIn¡
(
StÜeIn¡
 &
SI
);

538 
vis™C®lIn¡
(
C®lIn¡
 &
CI
);

539 
vis™PoŞIn™
(
C®lIn¡
 &
CI
);

540 
vis™PoŞAÎoc
(
C®lIn¡
 &
CI
);

541 
vis™PoŞDe¡roy
(
C®lIn¡
 &
CI
);

543 
vis™In¡ruùiÚ
(
In¡ruùiÚ
 &
I
) {

544 #iâdeà
NDEBUG


545 
boŞ
 
	gUnhªdËd
 = !!
g‘NodeIfCom´es£d
(&
I
);

546 
	gi
 = 0, 
	ge
 = 
I
.
g‘NumO³¿nds
(); i !ğ
e
; ++i)

547 
	gUnhªdËd
 |ğ!!
g‘NodeIfCom´es£d
(
I
.
g‘O³¿nd
(
i
));

549 ià(
	gUnhªdËd
) {

550 
”rs
(è<< "ERROR: UNHANDLED INSTRUCTION: " << 
	gI
;

560 
	gIn¡ruùiÚRewr™”
::~
	$In¡ruùiÚRewr™”
() {

562 
¡d
::
m­
<
V®ue
*, V®ue*>::
™”©Ü
 
I
 = 
OldToNewV®ueM­
.
	`begš
(),

563 
E
 = 
OldToNewV®ueM­
.
	`’d
(); 
I
 != E; ++I) {

564 
	`as£¹
((!
i§
<
Argum’t
>(
I
->
£cÚd
è|| 
ÿ¡
<Argum’t>(I->£cÚd)->
	`g‘P¬’t
())

567 ià(!
I
->
fœ¡
->
	`u£_em±y
())

568 
I
->
fœ¡
->
	`»¶aûAÎU£sW™h
(
UndefV®ue
::
	`g‘
(I->fœ¡->
	`g‘Ty³
()));

571 ià(
In¡ruùiÚ
 *
In¡
 = 
dyn_ÿ¡
<In¡ruùiÚ>(
I
->
fœ¡
)) {

572 
	`V®ueRemoved
(
In¡
);

573 
In¡
->
	`”a£FromP¬’t
();

574 } ià(
Argum’t
 *
Arg
 = 
dyn_ÿ¡
<Argum’t>(
I
->
fœ¡
)) {

575 
	`as£¹
(
Arg
->
	`g‘P¬’t
() == 0 && "Unexpected‡rgumentype here!");

576 
d–‘e
 
Arg
;

578 
	`as£¹
(0 && "Unknownƒntry inhis map!");

581 
	}
}

583 
	gIn¡ruùiÚRewr™”
::
	$vis™R‘uºIn¡
(
R‘uºIn¡
 &
RI
) {

584 ià(
RI
.
	`g‘NumO³¿nds
(è&& 
i§
<
Poš‹rTy³
>(RI.
	`g‘O³¿nd
(0)->
	`g‘Ty³
()))

585 ià(!
i§
<
Poš‹rTy³
>(
RI
.
	`g‘P¬’t
()->g‘P¬’t()->
	`g‘R‘uºTy³
())) {

587 
R‘uºIn¡
::
	`C»©e
(
RI
.
	`g‘CÚ‹xt
(),

588 
	`g‘T¿nsfÜmedV®ue
(
RI
.
	`g‘O³¿nd
(0)), &RI);

589 
RI
.
	`”a£FromP¬’t
();

591 
	}
}

594 
	gIn¡ruùiÚRewr™”
::
	$vis™Ca¡In¡
(
Ca¡In¡
 &
CI
) {

595 ià(!
i§
<
Poš‹rTy³
>(
CI
.
	`g‘Ty³
())) {

598 ià(
i§
<
Poš‹rTy³
>(
CI
.
	`g‘O³¿nd
(0)->
	`g‘Ty³
()) &&

599 
	`g‘PoŞInfo
(
CI
.
	`g‘O³¿nd
(0)))

600 
CI
.
	`£tO³¿nd
(0, 
	`g‘T¿nsfÜmedV®ue
(CI.
	`g‘O³¿nd
(0)));

604 cÚ¡ 
Com´es£dPoŞInfo
 *
PI
 = 
	`g‘PoŞInfo
(&
CI
);

605 ià(!
PI
) ;

606 
	`as£¹
(
	`g‘PoŞInfo
(
CI
.
	`g‘O³¿nd
(0)è=ğ
PI
 && "Not cast from…tr ->…tr?");

610 
	`£tT¿nsfÜmedV®ue
(
CI
, 
	`g‘T¿nsfÜmedV®ue
(CI.
	`g‘O³¿nd
(0)));

611 
	}
}

613 
	gIn¡ruùiÚRewr™”
::
	$vis™PHINode
(
PHINode
 &
PN
) {

614 cÚ¡ 
Com´es£dPoŞInfo
 *
De¡PI
 = 
	`g‘PoŞInfo
(&
PN
);

615 ià(
De¡PI
 == 0) ;

617 
PHINode
 *
New
 = PHINode::
	`C»©e
 (
SCALARUINTTYPE
, 
PN
.
	`g‘NumIncomšgV®ues
(), PN.
	`g‘Name
(), &PN);

619 
i
 = 0, 
e
 = 
PN
.
	`g‘NumIncomšgV®ues
(); i !=ƒ; ++i)

620 
New
->
	`addIncomšg
(
	`g‘T¿nsfÜmedV®ue
(
PN
.
	`g‘IncomšgV®ue
(
i
)),

621 
PN
.
	`g‘IncomšgBlock
(
i
));

622 
	`£tT¿nsfÜmedV®ue
(
PN
, 
New
);

623 
	}
}

625 
	gIn¡ruùiÚRewr™”
::
	$vis™S–eùIn¡
(
S–eùIn¡
 &
SI
) {

626 cÚ¡ 
Com´es£dPoŞInfo
 *
De¡PI
 = 
	`g‘PoŞInfo
(&
SI
);

627 ià(
De¡PI
 == 0) ;

629 
	`£tT¿nsfÜmedV®ue
(
SI
, 
S–eùIn¡
::
	`C»©e
(SI.
	`g‘O³¿nd
(0),

630 
	`g‘T¿nsfÜmedV®ue
(
SI
.
	`g‘O³¿nd
(1)),

631 
	`g‘T¿nsfÜmedV®ue
(
SI
.
	`g‘O³¿nd
(2)),

632 
SI
.
	`g‘Name
(), &SI));

633 
	}
}

635 
	gIn¡ruùiÚRewr™”
::
	$vis™ICmpIn¡
(
ICmpIn¡
 &
SCI
) {

636 ià(!
i§
<
Poš‹rTy³
>(
SCI
.
	`g‘O³¿nd
(0)->
	`g‘Ty³
())) ;

637 
V®ue
 *
NÚNuÎPŒ
 = 
SCI
.
	`g‘O³¿nd
(0);

638 ià(
i§
<
CÚ¡ªtPoš‹rNuÎ
>(
NÚNuÎPŒ
)) {

639 
NÚNuÎPŒ
 = 
SCI
.
	`g‘O³¿nd
(1);

640 ià(
i§
<
CÚ¡ªtPoš‹rNuÎ
>(
NÚNuÎPŒ
))

644 cÚ¡ 
Com´es£dPoŞInfo
 *
SrcPI
 = 
	`g‘PoŞInfo
(
NÚNuÎPŒ
);

645 ià(
SrcPI
 == 0) ;

647 
¡d
::
¡ršg
 
Name
 = 
SCI
.
	`g‘Name
(); SCI.
	`£tName
("");

648 
V®ue
 *
New
 = 
Ãw
 
	`ICmpIn¡
(&
SCI
, SCI.
	`g‘P»diÿ‹
(),

649 
	`g‘T¿nsfÜmedV®ue
(
SCI
.
	`g‘O³¿nd
(0)),

650 
	`g‘T¿nsfÜmedV®ue
(
SCI
.
	`g‘O³¿nd
(1)),

651 
Name
);

652 
SCI
.
	`»¶aûAÎU£sW™h
(
New
);

653 
	`V®ueR•Ïûd
(
SCI
, 
New
);

654 
SCI
.
	`”a£FromP¬’t
();

655 
	}
}

657 
	gIn¡ruùiÚRewr™”
::
	$vis™FCmpIn¡
(
FCmpIn¡
 &
SCI
) {

658 ià(!
i§
<
Poš‹rTy³
>(
SCI
.
	`g‘O³¿nd
(0)->
	`g‘Ty³
())) ;

659 
V®ue
 *
NÚNuÎPŒ
 = 
SCI
.
	`g‘O³¿nd
(0);

660 ià(
i§
<
CÚ¡ªtPoš‹rNuÎ
>(
NÚNuÎPŒ
)) {

661 
NÚNuÎPŒ
 = 
SCI
.
	`g‘O³¿nd
(1);

662 ià(
i§
<
CÚ¡ªtPoš‹rNuÎ
>(
NÚNuÎPŒ
))

666 cÚ¡ 
Com´es£dPoŞInfo
 *
SrcPI
 = 
	`g‘PoŞInfo
(
NÚNuÎPŒ
);

667 ià(
SrcPI
 == 0) ;

669 
¡d
::
¡ršg
 
Name
 = 
SCI
.
	`g‘Name
(); SCI.
	`£tName
("");

670 
V®ue
 *
New
 = 
Ãw
 
	`FCmpIn¡
(&
SCI
, SCI.
	`g‘P»diÿ‹
(),

671 
	`g‘T¿nsfÜmedV®ue
(
SCI
.
	`g‘O³¿nd
(0)),

672 
	`g‘T¿nsfÜmedV®ue
(
SCI
.
	`g‘O³¿nd
(1)),

673 
Name
);

674 
SCI
.
	`»¶aûAÎU£sW™h
(
New
);

675 
	`V®ueR•Ïûd
(
SCI
, 
New
);

676 
SCI
.
	`”a£FromP¬’t
();

677 
	}
}

679 
	gIn¡ruùiÚRewr™”
::
	$vis™G‘EËm’tPŒIn¡
(
G‘EËm’tPŒIn¡
 &
GEPI
) {

680 cÚ¡ 
Com´es£dPoŞInfo
 *
PI
 = 
	`g‘PoŞInfo
(&
GEPI
);

681 ià(
PI
 == 0) ;

684 
V®ue
 *
V®
 = 
	`g‘T¿nsfÜmedV®ue
(
GEPI
.
	`g‘O³¿nd
(0));

686 
boŞ
 
AÎZ”os
 = 
Œue
;

687 
i
 = 1, 
e
 = 
GEPI
.
	`g‘NumO³¿nds
(); i !=ƒ; ++i)

688 ià(!
i§
<
CÚ¡ªt
>(
GEPI
.
	`g‘O³¿nd
(
i
)) ||

689 !
ÿ¡
<
CÚ¡ªt
>(
GEPI
.
	`g‘O³¿nd
(
i
))->
	`isNuÎV®ue
()) {

690 
AÎZ”os
 = 
çl£
;

693 ià(
AÎZ”os
) {

696 
	`£tT¿nsfÜmedV®ue
(
GEPI
, 
V®
);

702 
Ty³
 *
NTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
PI
->
	`g‘NewTy³
());

706 if(
i§
<
Poš‹rTy³
>(
GEPI
.
	`g‘O³¿nd
(0)->
	`g‘Ty³
())) {

707 
Ty³
* 
PT
 =

708 
ÿ¡
<
Poš‹rTy³
>(
GEPI
.
	`g‘O³¿nd
(0)->
	`g‘Ty³
())->
	`g‘EËm’tTy³
();

709 if(
i§
<
A¼ayTy³
>(
PT
)) {

718 
g•_ty³_™”©Ü
 
GTI
 = 
	`g•_ty³_begš
(
GEPI
);

719 
i
 = 1, 
e
 = 
GEPI
.
	`g‘NumO³¿nds
(); i !ğe; ++i, ++
GTI
) {

720 
V®ue
 *
Idx
 = 
GEPI
.
	`g‘O³¿nd
(
i
);

721 ià(
SŒuùTy³
 *
STy
 = 
dyn_ÿ¡
<SŒuùTy³>(*
GTI
)) {

722 
ušt64_t
 
F›ld
 = ()
ÿ¡
<
CÚ¡ªtIÁ
>(
Idx
)->
	`g‘ZExtV®ue
();

723 ià(
F›ld
) {

724 
ušt64_t
 
F›ldOffs
 = 
TD
.
	`g‘SŒuùLayout
(
ÿ¡
<
SŒuùTy³
>(
NTy
))

725 ->
	`g‘EËm’tOff£t
(
F›ld
);

726 
CÚ¡ªt
 *
F›ldOffsC¡
 = 
CÚ¡ªtIÁ
::
	`g‘
(
SCALARUINTTYPE
, 
F›ldOffs
);

727 
V®
 = 
Bš¬yO³¿tÜ
::
	`C»©eAdd
(V®, 
F›ldOffsC¡
,

728 
GEPI
.
	`g‘Name
(), &GEPI);

732 ià(
STy
->
	`g‘NumEËm’ts
() > 1 ||

733 (
i§
<
SŒuùTy³
>(
NTy
) &&

734 
ÿ¡
<
SŒuùTy³
>(
NTy
)->
	`g‘NumEËm’ts
() == 1))

735 
NTy
 = 
ÿ¡
<
SŒuùTy³
>(NTy)->
	`g‘EËm’tTy³
(
F›ld
);

737 
	`as£¹
(
i§
<
Sequ’tŸlTy³
>(*
GTI
) && "Not struct or sequential?");

738 
Sequ’tŸlTy³
 *
SeqTy
 = 
ÿ¡
<Sequ’tŸlTy³>(*
GTI
);

739 ià(!
i§
<
CÚ¡ªt
>(
Idx
è|| !
ÿ¡
<CÚ¡ªt>(Idx)->
	`isNuÎV®ue
()) {

741 
Ty³
 *
ElTy
 = 
ÿ¡
<
Sequ’tŸlTy³
>(
NTy
)->
	`g‘EËm’tTy³
();

742 ià(
Idx
->
	`g‘Ty³
(è!ğ
SCALARUINTTYPE
)

743 
Idx
 = 
Ca¡In¡
::
	`C»©eSExtOrB™Ca¡
(Idx, 
SCALARUINTTYPE
, Idx->
	`g‘Name
(), &
GEPI
);

745 
CÚ¡ªt
 *
SÿË
 = 
CÚ¡ªtIÁ
::
	`g‘
(
SCALARUINTTYPE
,

746 
TD
.
	`g‘Ty³AÎocSize
(
ElTy
));

747 
Idx
 = 
Bš¬yO³¿tÜ
::
	`C»©eMul
(Idx, 
SÿË
, "f›ldidx", &
GEPI
);

748 
V®
 = 
Bš¬yO³¿tÜ
::
	`C»©eAdd
(V®, 
Idx
, 
GEPI
.
	`g‘Name
(), &GEPI);

752 ià(!
i§
<
A¼ayTy³
>(
SeqTy
è|| 
ÿ¡
<A¼ayTy³>(SeqTy)->
	`g‘NumEËm’ts
() != 1 ||

753 (
i§
<
A¼ayTy³
>(
NTy
è&& 
ÿ¡
<A¼ayTy³>(NTy)->
	`g‘NumEËm’ts
() == 1))

754 
NTy
 = 
ÿ¡
<
Sequ’tŸlTy³
>(NTy)->
	`g‘EËm’tTy³
();

758 
	`£tT¿nsfÜmedV®ue
(
GEPI
, 
V®
);

759 
	}
}

761 
	gIn¡ruùiÚRewr™”
::
	$vis™LßdIn¡
(
LßdIn¡
 &
LI
) {

762 cÚ¡ 
Com´es£dPoŞInfo
 *
SrcPI
 = 
	`g‘PoŞInfo
(
LI
.
	`g‘O³¿nd
(0));

763 ià(
SrcPI
 == 0) {

767 ià(
	`g‘PoŞInfo
(&
LI
)) {

768 
V®ue
 *
NLI
 = 
Ãw
 
	`LßdIn¡
(
LI
.
	`g‘O³¿nd
(0), LI.
	`g‘Name
()+".cp", &LI);

769 
V®ue
 *
NC
 = 
Ca¡In¡
::
	`C»©eZExtOrB™Ca¡
(
NLI
, 
SCALARUINTTYPE
, NLI->
	`g‘Name
(), &
LI
);

770 
	`£tT¿nsfÜmedV®ue
(
LI
, 
NC
);

778 
boŞ
 
LßdšgCom´es£dPŒ
 = 
	`g‘NodeIfCom´es£d
(&
LI
) != 0;

780 
V®ue
 *
Ba£PŒ
 = 
SrcPI
->
	`Em™PoŞBa£Lßd
(
LI
);

783 
V®ue
* 
Ops
 = 
	`g‘T¿nsfÜmedV®ue
(
LI
.
	`g‘O³¿nd
(0));

784 ià(
Ops
->
	`g‘Ty³
(è=ğ
IÁ16Ty³
)

785 
Ops
 = 
Ca¡In¡
::
	`C»©eZExtOrB™Ca¡
(Ops, 
IÁ32Ty³
, "ex‹nd_idx", &
LI
);

786 
V®ue
 *
SrcPŒ
 = 
G‘EËm’tPŒIn¡
::
	`C»©e
(
Ba£PŒ
, 
Ops
,

787 
LI
.
	`g‘O³¿nd
(0)->
	`g‘Name
()+".pp", &LI);

788 
Ty³
 *
De¡Ty
 = 
LßdšgCom´es£dPŒ
 ? 
MEMUINTTYPE
 : 
LI
.
	`g‘Ty³
();

789 
SrcPŒ
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(SrcPŒ, 
Poš‹rTy³
::
	`g‘Unqu®
(
De¡Ty
),

790 
SrcPŒ
->
	`g‘Name
(), &
LI
);

791 
¡d
::
¡ršg
 
OldName
 = 
LI
.
	`g‘Name
(); LI.
	`£tName
("");

792 
V®ue
 *
NewLßd
 = 
Ãw
 
	`LßdIn¡
(
SrcPŒ
, 
OldName
, &
LI
);

794 ià(
LßdšgCom´es£dPŒ
) {

796 ià(
MEMUINTTYPE
 !ğ
SCALARUINTTYPE
)

797 
NewLßd
 = 
Ca¡In¡
::
	`C»©eZExtOrB™Ca¡
(NewLßd, 
SCALARUINTTYPE
, NewLßd->
	`g‘Name
(), &
LI
);

799 
	`£tT¿nsfÜmedV®ue
(
LI
, 
NewLßd
);

801 
LI
.
	`»¶aûAÎU£sW™h
(
NewLßd
);

802 
	`V®ueR•Ïûd
(
LI
, 
NewLßd
);

803 
LI
.
	`”a£FromP¬’t
();

805 
	}
}

809 
	gIn¡ruùiÚRewr™”
::
	$vis™StÜeIn¡
(
StÜeIn¡
 &
SI
) {

810 cÚ¡ 
Com´es£dPoŞInfo
 *
De¡PI
 = 
	`g‘PoŞInfo
(
SI
.
	`g‘O³¿nd
(1));

811 ià(
De¡PI
 == 0) {

814 ià(
	`g‘PoŞInfo
(
SI
.
	`g‘O³¿nd
(0))) {

815 
V®ue
 *
SrcV®
 = 
	`g‘T¿nsfÜmedV®ue
(
SI
.
	`g‘O³¿nd
(0));

816 
SrcV®
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(SrcV®, 
SI
.
	`g‘O³¿nd
(0)->
	`g‘Ty³
(),

817 
SrcV®
->
	`g‘Name
(), &
SI
);

818 
SI
.
	`£tO³¿nd
(0, 
SrcV®
);

829 
V®ue
 *
SrcV®
 = 
SI
.
	`g‘O³¿nd
(0);

830 ià(!
i§
<
CÚ¡ªtPoš‹rNuÎ
>(
SrcV®
)) {

831 ià(
	`g‘PoŞInfo
(
SrcV®
)) {

833 
SrcV®
 = 
	`g‘T¿nsfÜmedV®ue
(SrcVal);

836 ià(
SrcV®
->
	`g‘Ty³
(è!ğ
MEMUINTTYPE
)

837 
SrcV®
 = 
Ca¡In¡
::
	`C»©eZExtOrB™Ca¡
(SrcV®, 
MEMUINTTYPE
, SrcV®->
	`g‘Name
(), &
SI
);

841 
SrcV®
 = 
CÚ¡ªtIÁ
::
	`g‘
(
MEMUINTTYPE
, 0);

845 
V®ue
 *
Ba£PŒ
 = 
De¡PI
->
	`Em™PoŞBa£Lßd
(
SI
);

848 
V®ue
* 
Ops
 = 
	`g‘T¿nsfÜmedV®ue
(
SI
.
	`g‘O³¿nd
(1));

849 ià(
Ops
->
	`g‘Ty³
(è=ğ
IÁ16Ty³
)

850 
Ops
 = 
Ca¡In¡
::
	`C»©eZExtOrB™Ca¡
(Ops, 
IÁ32Ty³
, "ex‹nd_idx", &
SI
);

852 
V®ue
 *
De¡PŒ
 = 
G‘EËm’tPŒIn¡
::
	`C»©e
(
Ba£PŒ
, 
Ops
,

853 
SI
.
	`g‘O³¿nd
(1)->
	`g‘Name
()+".pp",

854 &
SI
);

855 
De¡PŒ
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(DestPtr,

856 
Poš‹rTy³
::
	`g‘Unqu®
(
SrcV®
->
	`g‘Ty³
()),

857 
De¡PŒ
->
	`g‘Name
(), &
SI
);

858 
Ãw
 
	`StÜeIn¡
(
SrcV®
, 
De¡PŒ
, &
SI
);

862 
SI
.
	`”a£FromP¬’t
();

863 
	}
}

866 
	gIn¡ruùiÚRewr™”
::
	$vis™PoŞIn™
(
C®lIn¡
 &
CI
) {

869 cÚ¡ 
Com´es£dPoŞInfo
 *
PI
 = 
	`g‘PoŞInfoFÜPoŞDesc
(
CI
.
	`g‘O³¿nd
(1));

870 ià(
PI
 == 0) ;

872 
¡d
::
veùÜ
<
V®ue
*> 
Ops
;

873 
Ops
.
	`push_back
(
CI
.
	`g‘O³¿nd
(1));

875 
Ops
.
	`push_back
(
CÚ¡ªtIÁ
::
	`g‘
(
IÁ32Ty³
, 
PI
->
	`g‘NewSize
()));

879 
Ops
.
	`push_back
(
CÚ¡ªtIÁ
::
	`g‘
(
IÁ32Ty³
,

880 
PA
::
Heuri¡ic
::
	`g‘Recomm’dedAlignm’t
(
PI
->
	`g‘NewTy³
(), 
TD
)));

882 
V®ue
 *
PB
 = 
C®lIn¡
::
	`C»©e
(
PŒComp
.
PoŞIn™PC
, 
Ops
, "", &
CI
);

884 ià(!
Di§bËPoŞBa£ASR
) {

885 
PB
->
	`£tName
(
CI
.
	`g‘O³¿nd
(1)->
	`g‘Name
()+".poolbase");

887 
PI
->
	`£tPoŞBa£
(
PB
);

890 
CI
.
	`”a£FromP¬’t
();

891 
	}
}

893 
	gIn¡ruùiÚRewr™”
::
	$vis™PoŞDe¡roy
(
C®lIn¡
 &
CI
) {

896 cÚ¡ 
Com´es£dPoŞInfo
 *
PI
 = 
	`g‘PoŞInfoFÜPoŞDesc
(
CI
.
	`g‘O³¿nd
(1));

897 ià(
PI
 == 0) ;

899 
C®lIn¡
::
	`C»©e
(
PŒComp
.
PoŞDe¡royPC
, 
CI
.
	`g‘O³¿nd
(1), "", &CI);

900 
CI
.
	`”a£FromP¬’t
();

901 
	}
}

903 
	gIn¡ruùiÚRewr™”
::
	$vis™PoŞAÎoc
(
C®lIn¡
 &
CI
) {

904 cÚ¡ 
Com´es£dPoŞInfo
 *
PI
 = 
	`g‘PoŞInfo
(&
CI
);

905 ià(
PI
 == 0) ;

907 
V®ue
 *
Size
 = 
CI
.
	`g‘O³¿nd
(2);

910 ià(
OldSizeV
 = 
PA
::
Heuri¡ic
::
	`g‘Recomm’dedSize
(
PI
->
	`g‘Node
()))

911 ià(
OldSizeV
 !ğ
PI
->
	`g‘NewSize
()) {

914 
V®ue
 *
OldSize
 = 
CÚ¡ªtIÁ
::
	`g‘
(
IÁ32Ty³
, 
OldSizeV
);

915 
V®ue
 *
NewSize
 = 
CÚ¡ªtIÁ
::
	`g‘
(
IÁ32Ty³
, 
PI
->
	`g‘NewSize
());

917 
Size
 = 
Bš¬yO³¿tÜ
::
	`C»©eAdd
(Size,

918 
CÚ¡ªtIÁ
::
	`g‘
(
IÁ32Ty³
,

919 
OldSizeV
-1),

920 "roundup", &
CI
);

921 
Size
 = 
Bš¬yO³¿tÜ
::
	`C»©eUDiv
(Size, 
OldSize
, "numnodes", &
CI
);

922 
Size
 = 
Bš¬yO³¿tÜ
::
	`C»©eMul
(Size, 
NewSize
, "Ãwby‹s", &
CI
);

925 
V®ue
 *
O±s
[2] = {
CI
.
	`g‘O³¿nd
(1), 
Size
};

926 
V®ue
 *
NC
 = 
C®lIn¡
::
	`C»©e
(
PŒComp
.
PoŞAÎocPC
, 
O±s
, 
CI
.
	`g‘Name
(), &CI);

927 
	`£tT¿nsfÜmedV®ue
(
CI
, 
NC
);

928 
	}
}

931 
	gIn¡ruùiÚRewr™”
::
	$vis™C®lIn¡
(
C®lIn¡
 &
CI
) {

932 ià(
FunùiÚ
 *
F
 = 
CI
.
	`g‘C®ËdFunùiÚ
()) {

934 ià(
F
->
	`g‘Name
() == "poolinit") {

935 
	`vis™PoŞIn™
(
CI
);

937 } ià(
F
->
	`g‘Name
() == "pooldestroy") {

938 
	`vis™PoŞDe¡roy
(
CI
);

940 } ià(
F
->
	`g‘Name
() == "poolalloc") {

941 
	`vis™PoŞAÎoc
(
CI
);

952 
¡d
::
£t
<cÚ¡ 
DSNode
*> 
PoŞsToCom´ess
;

955 
PA
::
FuncInfo
 *
FI
 = 0;

956 cÚ¡ 
DSG¿ph
 *
CG
 = 0;

957 
FunùiÚ
 *
C®Ëe
 = 
CI
.
	`g‘C®ËdFunùiÚ
();

958 ià(
C®Ëe
)

959 ià((
FI
 = 
PŒComp
.
	`g‘PoŞAÎoc
()->
	`g‘FuncInfoOrClÚe
(*
C®Ëe
)))

960 
CG
 = 
PŒComp
.
	`g‘G¿phFÜFunc
(
FI
);

962 ià(!
C®Ëe
) {

966 } ià(
C®Ëe
->
	`isDeş¬©iÚ
()) {

969 
¡d
::
veùÜ
<
V®ue
*> 
O³¿nds
;

970 
O³¿nds
.
	`»£rve
(
CI
.
	`g‘NumO³¿nds
()-1);

974 ià(
C®Ëe
->
	`g‘Name
() == "printf" || Callee->getName() == "sprintf") {

975 
i
 = 1, 
e
 = 
CI
.
	`g‘NumO³¿nds
(); i !=ƒ; ++i)

976 ià(
i§
<
Poš‹rTy³
>(
CI
.
	`g‘O³¿nd
(
i
)->
	`g‘Ty³
()) &&

977 
	`g‘PoŞInfo
(
CI
.
	`g‘O³¿nd
(
i
)))

978 
CI
.
	`£tO³¿nd
(
i
, 
	`g‘T¿nsfÜmedV®ue
(CI.
	`g‘O³¿nd
(i)));

980 } ià(
C®Ëe
->
	`g‘Name
() == "read") {

981 ià(cÚ¡ 
Com´es£dPoŞInfo
 *
De¡PI
 = 
	`g‘PoŞInfo
(
CI
.
	`g‘O³¿nd
(2))) {

982 
V®ue
 *
Ba£PŒ
 = 
De¡PI
->
	`Em™PoŞBa£Lßd
(
CI
);

983 
V®ue
 *
SrcPŒ
 = 
G‘EËm’tPŒIn¡
::
	`C»©e
(
Ba£PŒ
, 
	`g‘T¿nsfÜmedV®ue
(
CI
.
	`g‘O³¿nd
(2)),

984 
CI
.
	`g‘O³¿nd
(2)->
	`g‘Name
()+".pp", &CI);

985 
SrcPŒ
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(SrcPŒ, 
CI
.
	`g‘O³¿nd
(2)->
	`g‘Ty³
(), "", &CI);

986 
CI
.
	`£tO³¿nd
(2, 
SrcPŒ
);

989 } ià(
C®Ëe
->
	`g‘Name
() == "fwrite") {

990 ià(cÚ¡ 
Com´es£dPoŞInfo
 *
De¡PI
 = 
	`g‘PoŞInfo
(
CI
.
	`g‘O³¿nd
(1))) {

991 
V®ue
 *
Ba£PŒ
 = 
De¡PI
->
	`Em™PoŞBa£Lßd
(
CI
);

992 
V®ue
 *
SrcPŒ
 = 
G‘EËm’tPŒIn¡
::
	`C»©e
(
Ba£PŒ
, 
	`g‘T¿nsfÜmedV®ue
(
CI
.
	`g‘O³¿nd
(1)),

993 
CI
.
	`g‘O³¿nd
(1)->
	`g‘Name
()+".pp", &CI);

994 
SrcPŒ
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(SrcPŒ, 
CI
.
	`g‘O³¿nd
(1)->
	`g‘Ty³
(), "", &CI);

995 
CI
.
	`£tO³¿nd
(1, 
SrcPŒ
);

998 } ià(
C®Ëe
->
	`g‘Name
() == "llvm.memset" ||

999 
C®Ëe
->
	`g‘Name
() == "llvm.memset.i32" ||

1000 
C®Ëe
->
	`g‘Name
() == "llvm.memset.i64") {

1001 ià(cÚ¡ 
Com´es£dPoŞInfo
 *
De¡PI
 = 
	`g‘PoŞInfo
(
CI
.
	`g‘O³¿nd
(1))) {

1002 
V®ue
 *
Ba£PŒ
 = 
De¡PI
->
	`Em™PoŞBa£Lßd
(
CI
);

1003 
V®ue
 *
SrcPŒ
 = 
G‘EËm’tPŒIn¡
::
	`C»©e
(
Ba£PŒ
, 
	`g‘T¿nsfÜmedV®ue
(
CI
.
	`g‘O³¿nd
(1)),

1004 
CI
.
	`g‘O³¿nd
(1)->
	`g‘Name
()+".pp", &CI);

1005 
SrcPŒ
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(SrcPŒ, 
CI
.
	`g‘O³¿nd
(1)->
	`g‘Ty³
(), "", &CI);

1006 
CI
.
	`£tO³¿nd
(1, 
SrcPŒ
);

1009 } ià(
C®Ëe
->
	`g‘Name
() == "llvm.memcpy" ||

1010 
C®Ëe
->
	`g‘Name
() == "llvm.memcpy.i32" ||

1011 
C®Ëe
->
	`g‘Name
() == "llvm.memcpy.i64") {

1012 
boŞ
 
dÜ‘
 = 
çl£
;

1013 ià(cÚ¡ 
Com´es£dPoŞInfo
 *
De¡PI
 = 
	`g‘PoŞInfo
(
CI
.
	`g‘O³¿nd
(1))) {

1014 
V®ue
 *
Ba£PŒ
 = 
De¡PI
->
	`Em™PoŞBa£Lßd
(
CI
);

1015 
V®ue
 *
SrcPŒ
 = 
G‘EËm’tPŒIn¡
::
	`C»©e
(
Ba£PŒ
, 
	`g‘T¿nsfÜmedV®ue
(
CI
.
	`g‘O³¿nd
(1)),

1016 
CI
.
	`g‘O³¿nd
(1)->
	`g‘Name
()+".pp", &CI);

1017 
SrcPŒ
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(SrcPŒ, 
CI
.
	`g‘O³¿nd
(1)->
	`g‘Ty³
(), "", &CI);

1018 
CI
.
	`£tO³¿nd
(1, 
SrcPŒ
);

1019 
dÜ‘
 = 
Œue
;

1021 ià(cÚ¡ 
Com´es£dPoŞInfo
 *
De¡PI
 = 
	`g‘PoŞInfo
(
CI
.
	`g‘O³¿nd
(2))) {

1022 
V®ue
 *
Ba£PŒ
 = 
De¡PI
->
	`Em™PoŞBa£Lßd
(
CI
);

1023 
V®ue
 *
SrcPŒ
 = 
G‘EËm’tPŒIn¡
::
	`C»©e
(
Ba£PŒ
, 
	`g‘T¿nsfÜmedV®ue
(
CI
.
	`g‘O³¿nd
(2)),

1024 
CI
.
	`g‘O³¿nd
(2)->
	`g‘Name
()+".pp", &CI);

1025 
SrcPŒ
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(SrcPŒ, 
CI
.
	`g‘O³¿nd
(2)->
	`g‘Ty³
(), "", &CI);

1026 
CI
.
	`£tO³¿nd
(2, 
SrcPŒ
);

1027 
dÜ‘
 = 
Œue
;

1029 ià(
dÜ‘
) ;

1033 
¡d
::
veùÜ
<> 
Com´es£dArgs
;

1034 ià(
i§
<
Poš‹rTy³
>(
CI
.
	`g‘Ty³
()è&& 
	`g‘PoŞInfo
(&CI))

1035 
Com´es£dArgs
.
	`push_back
(0);

1037 
i
 = 1, 
e
 = 
CI
.
	`g‘NumO³¿nds
(); i !=ƒ; ++i)

1038 ià(
i§
<
Poš‹rTy³
>(
CI
.
	`g‘O³¿nd
(
i
)->
	`g‘Ty³
()) &&

1039 
	`g‘PoŞInfo
(
CI
.
	`g‘O³¿nd
(
i
))) {

1040 
Com´es£dArgs
.
	`push_back
(
i
);

1041 
O³¿nds
.
	`push_back
(
	`g‘T¿nsfÜmedV®ue
(
CI
.
	`g‘O³¿nd
(
i
)));

1043 
O³¿nds
.
	`push_back
(
CI
.
	`g‘O³¿nd
(
i
));

1046 ià(
Com´es£dArgs
.
	`em±y
()) {

1047 
PŒComp
.
NoArgFunùiÚsC®Ëd
.
	`push_back
(
C®Ëe
);

1051 
FunùiÚ
 *
ClÚe
 = 
PŒComp
.
	`G‘ExtFunùiÚClÚe
(
C®Ëe
, 
Com´es£dArgs
);

1052 
V®ue
 *
NC
 = 
C®lIn¡
::
	`C»©e
(
ClÚe
, 
O³¿nds
, 
CI
.
	`g‘Name
(), &CI);

1053 ià(
NC
->
	`g‘Ty³
(è!ğ
CI
.getType())

1054 
	`£tT¿nsfÜmedV®ue
(
CI
, 
NC
);

1056 ià(
CI
.
	`g‘Ty³
(è!ğ
VoidTy³
)

1057 
CI
.
	`»¶aûAÎU£sW™h
(
NC
);

1058 
	`V®ueR•Ïûd
(
CI
, 
NC
);

1059 
CI
.
	`”a£FromP¬’t
();

1065 
DSG¿ph
::
NodeM­Ty
 
C®ËeC®ËrM­
;

1068 ià(
i§
<
Poš‹rTy³
>(
CI
.
	`g‘Ty³
()))

1069 
DSG¿ph
::
	`compu‹NodeM­pšg
(
CG
->
	`g‘R‘uºNodeFÜ
(
FI
->
F
),

1070 
	`g‘M­³dNodeHªdË
(&
CI
), 
C®ËeC®ËrM­
);

1073 
NumPoŞArgs
 = 
FI
 ? FI->
ArgNodes
.
	`size
() : 0;

1076 
NumS—rch
 = 
FI
 ? FI->
F
.
	`¬g_size
(è+ 1: 
CI
.
	`g‘NumO³¿nds
();

1077 
i
 = 1, 
e
 = 
NumS—rch
; i !=ƒ; ++i)

1078 ià(
i§
<
Poš‹rTy³
>(
CI
.
	`g‘O³¿nd
(
i
)->
	`g‘Ty³
()è&& i > 
NumPoŞArgs
) {

1079 
Argum’t
 *
FÜm®Arg
 = 
	`Ãxt
(
FI
->
F
.
	`¬g_begš
(), 
i
-1-
NumPoŞArgs
);

1081 
DSG¿ph
::
	`compu‹NodeM­pšg
(
CG
->
	`g‘NodeFÜV®ue
(
FÜm®Arg
),

1082 
	`g‘M­³dNodeHªdË
(
CI
.
	`g‘O³¿nd
(
i
)),

1083 
C®ËeC®ËrM­
);

1090 
DSG¿ph
::
NodeM­Ty
::
™”©Ü
 
I
 = 
C®ËeC®ËrM­
.
	`begš
(),

1091 
E
 = 
C®ËeC®ËrM­
.
	`’d
(); 
I
 != E; ++I) {

1093 ià(
PoŞInfo
.
	`couÁ
(
I
->
£cÚd
.
	`g‘Node
()))

1094 
PoŞsToCom´ess
.
	`š£¹
(
I
->
fœ¡
);

1100 ià(
PoŞsToCom´ess
.
	`em±y
()) {

1101 
PŒComp
.
NoArgFunùiÚsC®Ëd
.
	`push_back
(
C®Ëe
);

1108 
FunùiÚ
 *
ClÚe
 = 
PŒComp
.
	`G‘FunùiÚClÚe
(
C®Ëe
, 
PoŞsToCom´ess
,

1109 *
FI
, *
CG
);

1113 
¡d
::
veùÜ
<
V®ue
*> 
O³¿nds
;

1114 
O³¿nds
.
	`»£rve
(
CI
.
	`g‘NumO³¿nds
()-1);

1116 
FunùiÚ
::
¬g_™”©Ü
 
AI
 = 
FI
->
F
.
	`¬g_begš
();

1119 
i
 = 1; i !ğ
NumPoŞArgs
+1; ++i)

1120 
O³¿nds
.
	`push_back
(
CI
.
	`g‘O³¿nd
(
i
));

1122 
i
 = 
NumPoŞArgs
+1, 
e
 = 
CI
.
	`g‘NumO³¿nds
(); i !ğe; ++i, ++
AI
)

1123 ià(
i§
<
Poš‹rTy³
>(
CI
.
	`g‘O³¿nd
(
i
)->
	`g‘Ty³
()) &&

1124 
PoŞsToCom´ess
.
	`couÁ
(
CG
->
	`g‘NodeFÜV®ue
(
AI
).
	`g‘Node
()))

1125 
O³¿nds
.
	`push_back
(
	`g‘T¿nsfÜmedV®ue
(
CI
.
	`g‘O³¿nd
(
i
)));

1127 
O³¿nds
.
	`push_back
(
CI
.
	`g‘O³¿nd
(
i
));

1129 
V®ue
 *
NC
 = 
C®lIn¡
::
	`C»©e
(
ClÚe
, 
O³¿nds
, 
CI
.
	`g‘Name
(), &CI);

1130 ià(
NC
->
	`g‘Ty³
(è!ğ
CI
.getType())

1131 
	`£tT¿nsfÜmedV®ue
(
CI
, 
NC
);

1133 ià(
CI
.
	`g‘Ty³
(è!ğ
VoidTy³
)

1134 
CI
.
	`»¶aûAÎU£sW™h
(
NC
);

1135 
	`V®ueR•Ïûd
(
CI
, 
NC
);

1136 
CI
.
	`”a£FromP¬’t
();

1138 
	}
}

1146 
	gPoš‹rCom´ess
::
	$g‘AÇlysisU§ge
(
AÇlysisU§ge
 &
AU
) const {

1148 
AU
.
addRequœed
<
PoŞAÎoÿ‹PassAÎPoŞs
>();

1151 
AU
.
addRequœed
<
Com¶‘eBUD©aSŒuùu»s
>();

1152 
	}
}

1156 
boŞ
 
	$PoŞIsCom´essibË
(cÚ¡ 
DSNode
 *
N
) {

1157 
	`as£¹
(!
N
->
	`isFÜw¬dšg
() && "Should‚ot be dealing with merged‚odes!");

1158 ià(
N
->
	`isNodeCom¶‘–yFŞded
()) {

1159 
	`DEBUG
(
	`”rs
() << "Node is‚otype-safe:\n");

1160  
çl£
;

1165 
boŞ
 
HasF›lds
 = 
çl£
;

1166 
DSNode
::
cÚ¡_edge_™”©Ü
 
I
 = 
N
->
	`edge_begš
(), 
E
 = N->
	`edge_’d
();

1167 
I
 !ğ
E
; ++I)

1168 ià(!
I
->
	`isNuÎ
()) {

1169 
HasF›lds
 = 
Œue
;

1170 ià(
I
->
	`g‘Node
(è!ğ
N
) {

1172 
	`DEBUG
(
	`”rs
() << "Node…ointso‚odes otherhan itself:\n");

1173  
çl£
;

1177 ià(!
HasF›lds
) {

1178 
	`DEBUG
(
	`”rs
() << "Node does‚ot contain‡ny…ointerso compress:\n");

1179  
çl£
;

1183 ià((
N
->
	`g‘NodeFÏgs
(è& 
DSNode
::
Compos™iÚ
è!ğDSNode::
H—pNode
) {

1184 
	`DEBUG
(
	`”rs
() << "Node contains‚on-heap values:\n");

1185  
çl£
;

1188  
Œue
;

1189 
	}
}

1194 
	gPoš‹rCom´ess
::
FšdPoŞsToCom´ess
(
¡d
::
£t
<cÚ¡ 
DSNode
*> &
PoŞs
,

1195 
¡d
::
m­
<cÚ¡ 
DSNode
*,

1196 
V®ue
*> &
P»assigÃdPoŞs
,

1197 
FunùiÚ
 &
F
, 
DSG¿ph
* 
DSG
,

1198 
PA
::
FuncInfo
 *
FI
) {

1199 
DEBUG
(
”rs
(è<< "IÀfunùiÚ '" << 
F
.
g‘Name
().
¡r
() << "':\n");

1200 
	gi
 = 0, 
	ge
 = 
FI
->
NodesToPA
.
size
(); i !ğ
e
; ++i) {

1201 cÚ¡ 
DSNode
 *
	gN
 = 
FI
->
NodesToPA
[
i
];

1205 ià(!
	gi§
<
	gCÚ¡ªtPoš‹rNuÎ
>(
	gFI
->
	gPoŞDesütÜs
[
N
])) {

1206 ià(
PoŞIsCom´essibË
(
N
)) {

1207 
	gPoŞs
.
š£¹
(
N
);

1208 ++
	gNumCom´es£d
;

1210 
DEBUG
(
”rs
(è<< "PCF: "; 
N
->
dump
());

1211 ++
	gNumNÙCom´es£d
;

1217 ià(
	gCom´es£dGlob®PoŞs
.
em±y
()) ;

1221 
	gECG
->
g‘Glob®sG¿ph
();

1225 
	gDSG¿ph
::
NodeM­Ty
 
Glob®sG¿phNodeM­pšg
;

1226 
	gDSG
->
compu‹GToGGM­pšg
(
Glob®sG¿phNodeM­pšg
);

1230 
	gDSG¿ph
::
node_™”©Ü
 
I
 = 
DSG
->
node_begš
(), 
	gE
 = DSG->
node_’d
();

1231 
	gI
 !ğ
E
;++I)

1232 ià(
	gGlob®sG¿phNodeM­pšg
.
couÁ
(
I
)) {

1234 
DSNode
 *
	gGGN
 = 
Glob®sG¿phNodeM­pšg
[
I
].
g‘Node
();

1235 ià(
	gCom´es£dGlob®PoŞs
.
couÁ
(
GGN
)) {

1236 
	gPoŞs
.
š£¹
(
I
);

1237 
	gP»assigÃdPoŞs
[
I
] = 
Com´es£dGlob®PoŞs
[
GGN
];

1245 
boŞ
 
	gPoš‹rCom´ess
::

1246 
Com´essPoŞsInFunùiÚ
(
FunùiÚ
 &
F
,

1247 
¡d
::
veùÜ
<¡d::
·œ
<
V®ue
*, V®ue*> > *
P»m­³dV®s
,

1248 
¡d
::
£t
<cÚ¡ 
DSNode
*> *
Ex‹º®PoŞsToCom´ess
){

1249 ià(
F
.
isDeş¬©iÚ
()è 
çl£
;

1254 
FunùiÚClÚeRecÜd
 *
	gFCR
 = 
g‘ClÚeInfo
(
F
);

1255 
FunùiÚ
 *
	gClÚeSourû
 = 
FCR
 ? FCR->
PAFn
 : 0;

1257 
	gPA
::
FuncInfo
 *
FI
;

1258 ià(
	gClÚeSourû
)

1259 
	gFI
 = 
PoŞAÎoc
->
g‘FuncInfoOrClÚe
(*
ClÚeSourû
);

1261 
	gFI
 = 
PoŞAÎoc
->
g‘FuncInfoOrClÚe
(
F
);

1263 ià(
	gFI
 == 0) {

1264 
”rs
() << "DIDN'T FIND POOL INFO FOR: "

1265 << *
F
.
g‘Ty³
(è<< F.
g‘Name
().
¡r
() << "!\n";

1266  
	gçl£
;

1272 ià(
	gFI
->
	gClÚe
 && &FI->
	gF
 =ğ&
F
)

1273  
çl£
;

1276 
DSG¿ph
* 
	gDSG
 = 
ECG
->
g‘DSG¿ph
(
FI
->
F
);

1278 
	g¡d
::
£t
<cÚ¡ 
DSNode
*> 
PoŞsToCom´essS‘
;

1282 
	g¡d
::
m­
<cÚ¡ 
DSNode
*, 
	gV®ue
*> 
	gP»assigÃdPoŞs
;

1283 
FšdPoŞsToCom´ess
(
PoŞsToCom´essS‘
, 
P»assigÃdPoŞs
, 
F
, 
DSG
, 
FI
);

1288 ià(
	gEx‹º®PoŞsToCom´ess
)

1289 
	gPoŞsToCom´essS‘
.
š£¹
(
Ex‹º®PoŞsToCom´ess
->
begš
(),

1290 
Ex‹º®PoŞsToCom´ess
->
’d
());

1293 ià(
	gPoŞsToCom´essS‘
.
em±y
()è 
	gçl£
;

1296 
	g¡d
::
m­
<cÚ¡ 
DSNode
*, 
	gCom´es£dPoŞInfo
> 
	gPoŞsToCom´ess
;

1298 
	g¡d
::
£t
<cÚ¡ 
DSNode
*>::
™”©Ü
 
I
 = 
PoŞsToCom´essS‘
.
begš
(),

1299 
	gE
 = 
PoŞsToCom´essS‘
.
’d
(); 
	gI
 !ğ
E
; ++I) {

1300 
V®ue
 *
	gPD
;

1301 ià(
V®ue
 *
	gPAPD
 = 
P»assigÃdPoŞs
[*
I
])

1302 
PD
 = 
PAPD
;

1303 ià(
	gFCR
)

1304 
	gPD
 = 
FCR
->
PoŞDesütÜs
.
fšd
(*
I
)->
£cÚd
;

1306 
	gPD
 = 
FI
->
PoŞDesütÜs
[*
I
];

1307 
as£¹
(
PD
 && "No…ool descriptor‡vailable forhis…ool???");

1309 
	gPoŞsToCom´ess
.
š£¹
(
¡d
::
make_·œ
(*
I
, 
Com´es£dPoŞInfo
(*I, 
PD
)));

1315 cÚ¡ 
	gT¬g‘D©a
 &
	gTD
 = 
DSG
->
g‘T¬g‘D©a
();

1316 
”rs
(è<< "IÀfunùiÚ '" << 
	gF
.
g‘Name
().
¡r
() << "':\n";

1317 
	g¡d
::
m­
<cÚ¡ 
DSNode
*, 
	gCom´es£dPoŞInfo
>::
™”©Ü


1318 
I
 = 
PoŞsToCom´ess
.
begš
(), 
	gE
 = PoŞsToCom´ess.
’d
(); 
	gI
 !ğ
E
; ++I) {

1320 
	gI
->
	g£cÚd
.
In™Ÿlize
(
PoŞsToCom´ess
, 
TD
);

1323 ià(
	gi§
<
	gAÎoÿIn¡
>(
	gI
->
	g£cÚd
.
g‘PoŞDesc
()) ||

1324 (
	gi§
<
	gGlob®V®ue
>(
	gI
->
	g£cÚd
.
g‘PoŞDesc
()) &&

1325 
	gF
.
hasEx‹º®Lškage
(è&& F.
g‘Name
().
¡r
() == "main")) {

1326 
”rs
() << " COMPRESSING POOL:\nPCS:";

1327 
	gI
->
	g£cÚd
.
dump
();

1332 
In¡ruùiÚRewr™”
 
IR
(
PoŞsToCom´ess
, 
DSG
, *
FI
, 
FCR
, *
this
);

1333 ià(
	gP»m­³dV®s
)

1334 
	gIR
.
P»m­V®ues
(*
P»m­³dV®s
);

1335 
	gIR
.
vis™
(
F
);

1336  
	gŒue
;

1342 
FunùiÚ
 *
	gPoš‹rCom´ess
::

1343 
G‘ExtFunùiÚClÚe
(
FunùiÚ
 *
F
, cÚ¡ 
¡d
::
veùÜ
<> &
ArgsToComp
) {

1344 
as£¹
(!
ArgsToComp
.
em±y
() && "No„easono make‡ clone!");

1345 
	gFunùiÚ
 *&
	gClÚe
 = 
ExtClÚeFunùiÚM­
[
¡d
::
make_·œ
(
F
, 
ArgsToComp
)];

1346 ià(
	gClÚe
)  Clone;

1348 
FunùiÚTy³
 *
	gFTy
 = 
F
->
g‘FunùiÚTy³
();

1349 
Ty³
 *
	gR‘Ty
 = 
FTy
->
g‘R‘uºTy³
();

1350 
	gArgIdx
 = 0;

1351 ià(
	gi§
<
	gPoš‹rTy³
>(
	gR‘Ty
è&& 
	gArgsToComp
[0] == 0) {

1352 
R‘Ty
 = 
SCALARUINTTYPE
;

1353 ++
	gArgIdx
;

1356 
	g¡d
::
veùÜ
<
Ty³
*> 
P¬amTy³s
;

1358 
	gi
 = 0, 
	ge
 = 
FTy
->
g‘NumP¬ams
(); i !ğ
e
; ++i)

1359 ià(
	gArgIdx
 < 
	gArgsToComp
.
size
(è&& ArgsToComp[
ArgIdx
]-1 =ğ
i
) {

1361 
P¬amTy³s
.
push_back
(
SCALARUINTTYPE
);

1362 ++
	gArgIdx
;

1364 
	gP¬amTy³s
.
push_back
(
FTy
->
g‘P¬amTy³
(
i
));

1366 
FunùiÚTy³
 *
	gCFTy
 = FunùiÚTy³::
g‘
(
R‘Ty
, 
P¬amTy³s
, 
FTy
->
isV¬Arg
());

1369 
	gClÚe
 = 
FunùiÚ
::
C»©e
 (
CFTy
, 
Glob®V®ue
::
Ex‹º®Lškage
,

1370 
F
->
g‘Name
().
¡r
()+"_pc");

1371 
	gF
->
g‘P¬’t
()->
g‘FunùiÚLi¡
().
š£¹
(
F
, 
ClÚe
);

1372  
	gClÚe
;

1378 
FunùiÚ
 *
	gPoš‹rCom´ess
::

1379 
G‘FunùiÚClÚe
(
FunùiÚ
 *
F
, 
¡d
::
£t
<cÚ¡ 
DSNode
*> &
PoŞsToCom´ess
,

1380 
PA
::
FuncInfo
 &
FI
, cÚ¡ 
DSG¿ph
 &
CG
) {

1381 
as£¹
(!
PoŞsToCom´ess
.
em±y
() && "No clone‚eeded!");

1386 
	gFunùiÚ
 *&
	gClÚe
 = 
ClÚedFunùiÚM­
[
¡d
::
make_·œ
(
F
, 
PoŞsToCom´ess
)];

1387 ià(
	gClÚe
)  Clone;

1390 
FunùiÚTy³
 *
	gFTy
 = 
F
->
g‘FunùiÚTy³
();

1391 
Ty³
 *
	gR‘Ty
 = 
FTy
->
g‘R‘uºTy³
();

1392 ià(
	gi§
<
	gPoš‹rTy³
>(
	gR‘Ty
) &&

1393 
	gPoŞsToCom´ess
.
couÁ
(
CG
.
g‘R‘uºNodeFÜ
(
FI
.
F
).
g‘Node
())) {

1394 
	gR‘Ty
 = 
SCALARUINTTYPE
;

1396 
	g¡d
::
veùÜ
<
Ty³
*> 
P¬amTy³s
;

1397 
	gNumPoŞArgs
 = 
FI
.
ArgNodes
.
size
();

1400 
	gi
 = 0; i !ğ
NumPoŞArgs
; ++i)

1401 
	gP¬amTy³s
.
push_back
(
FTy
->
g‘P¬amTy³
(
i
));

1403 
	gFunùiÚ
::
¬g_™”©Ü
 
AI
 = 
FI
.
F
.
¬g_begš
();

1404 
	gi
 = 
NumPoŞArgs
, 
	ge
 = 
FTy
->
g‘NumP¬ams
(); i !ğ
e
; ++i, ++
	gAI
)

1405 ià(
	gi§
<
	gPoš‹rTy³
>(
	gFTy
->
g‘P¬amTy³
(
i
)) &&

1406 
	gPoŞsToCom´ess
.
couÁ
(
CG
.
g‘NodeFÜV®ue
(
AI
).
g‘Node
())) {

1408 
	gP¬amTy³s
.
push_back
(
SCALARUINTTYPE
);

1410 
	gP¬amTy³s
.
push_back
(
FTy
->
g‘P¬amTy³
(
i
));

1412 
FunùiÚTy³
 *
	gCFTy
 = FunùiÚTy³::
g‘
(
R‘Ty
, 
P¬amTy³s
, 
FTy
->
isV¬Arg
());

1415 
	gClÚe
 = 
FunùiÚ
::
C»©e
 (
CFTy
, 
Glob®V®ue
::
IÁ”ÇlLškage
,

1416 
F
->
g‘Name
().
¡r
()+".pc");

1417 
	gF
->
g‘P¬’t
()->
g‘FunùiÚLi¡
().
š£¹
(
F
, 
ClÚe
);

1420 
	gFunùiÚClÚeRecÜd
 &
	gCFI
 =

1421 
ClÚedFunùiÚInfoM­
.
š£¹
(
¡d
::
make_·œ
(
ClÚe
, 
F
)).
	gfœ¡
->
	g£cÚd
;

1423 ++
	gNumClÚed
;

1424 
”rs
(è<< " CLONING FUNCTION: " << 
	gF
->
g‘Name
().
¡r
() << " -> "

1425 << 
	gClÚe
->
g‘Name
().
¡r
() << "\n";

1427 ià(
	gF
->
isDeş¬©iÚ
()) {

1428 
	gClÚe
->
£tLškage
(
Glob®V®ue
::
Ex‹º®Lškage
);

1429  
	gClÚe
;

1432 
V®ueToV®ueM­Ty
 
	gV®ueM­
;

1437 
	g¡d
::
veùÜ
<
¡d
::
·œ
<
V®ue
*,
	gV®ue
*> > 
	gRem­³dArgs
;

1440 
	gFunùiÚ
::
¬g_™”©Ü
 
CI
 = 
ClÚe
->
¬g_begš
();

1441 
	gFunùiÚ
::
¬g_™”©Ü
 
I
 = 
F
->
¬g_begš
(), 
	gE
 = F->
¬g_’d
();

1442 
	gI
 !ğ
E
; ++I, ++
	gCI
) {

1444 
	gCI
->
£tName
(
I
->
g‘Name
().
¡r
());

1447 ià(
	gCI
->
g‘Ty³
(è!ğ
I
->getType()) {

1450 
V®ue
 *
V
 = 
Ãw
 
Argum’t
(
I
->
g‘Ty³
());

1451 
	gRem­³dArgs
.
push_back
(
¡d
::
make_·œ
(
V
, 
CI
));

1452 
	gV®ueM­
[
I
] = 
V
;

1455 
	gV®ueM­
[
I
] = 
CI
;

1460 
	gSm®lVeùÜ
<
	gR‘uºIn¡
*,100> 
	gR‘uºs
;

1462 
ClÚeFunùiÚIÁo
(
ClÚe
, 
F
, 
V®ueM­
, 
Œue
, 
R‘uºs
);

1463 
	gR‘uºs
.
ş—r
();

1466 
	g¡d
::
m­
<
V®ue
*, cÚ¡ 
	gV®ue
*> &
	gNewToOldV®ueM­
 = 
CFI
.
NewToOldV®ueM­
;

1467 
	gV®ueToV®ueM­Ty
::
™”©Ü
 
I
 = 
V®ueM­
.
begš
(),

1468 
	gE
 = 
V®ueM­
.
’d
(); 
	gI
 !ğ
E
; ++I)

1469 
	gNewToOldV®ueM­
.
š£¹
(
¡d
::
make_·œ
(
I
->
£cÚd
, I->
fœ¡
));

1472 
	g¡d
::
m­
<cÚ¡ 
DSNode
*, 
	gV®ue
*>::
™”©Ü
 
I
 =

1473 
FI
.
PoŞDesütÜs
.
begš
(), 
	gE
 = FI.PoŞDesütÜs.
’d
();

1474 
	gI
 !ğ
E
; ++I)

1475 
	gCFI
.
	gPoŞDesütÜs
[
I
->
fœ¡
] = 
V®ueM­
[I->
£cÚd
];

1477 
	gV®ueM­
.
ş—r
();

1480 
Com´essPoŞsInFunùiÚ
(*
ClÚe
, &
Rem­³dArgs
, &
PoŞsToCom´ess
);

1481  
	gClÚe
;

1486 
	gPoš‹rCom´ess
::
	$HªdËGlob®PoŞs
(
ModuË
 &
M
) {

1487 ià(
PoŞAÎoc
->
Glob®Nodes
.
	`em±y
()) ;

1489 
	`DEBUG
(
	`”rs
() << "Inspecting global‚odes:\n");

1492 
¡d
::
m­
<cÚ¡ 
DSNode
*, 
V®ue
*>::
™”©Ü
 
I
 =

1493 
PoŞAÎoc
->
Glob®Nodes
.
	`begš
(), 
E
 = PoŞAÎoc->Glob®Nodes.
	`’d
();

1494 
I
 !ğ
E
; ++I) {

1495 cÚ¡ 
DSNode
 *
N
 = 
I
->
fœ¡
;

1499 ià(!
i§
<
CÚ¡ªtPoš‹rNuÎ
>(
I
->
£cÚd
)) {

1500 ià(
	`PoŞIsCom´essibË
(
N
)) {

1501 
Com´es£dGlob®PoŞs
.
	`š£¹
(
¡d
::
	`make_·œ
(
N
,

1502 
ÿ¡
<
Glob®V®ue
>(
I
->
£cÚd
)));

1503 ++
NumCom´es£d
;

1505 
	`DEBUG
(
	`”rs
(è<< "PCF: "; 
N
->
	`dump
());

1506 ++
NumNÙCom´es£d
;

1510 
	}
}

1515 
	gPoš‹rCom´ess
::
	$In™ŸlizePoŞLib¿ryFunùiÚs
(
ModuË
 &
M
) {

1516 
Ty³
 *
VoidPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
IÁ8Ty³
);

1517 
Ty³
 *
PoŞDescPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
A¼ayTy³
::
	`g‘
(
VoidPŒTy
, 16));

1519 
PoŞIn™PC
 = 
M
.
	`g‘OrIn£¹FunùiÚ
("poŞš™_pc", 
VoidPŒTy
, 
PoŞDescPŒTy
,

1520 
IÁ32Ty³
, IÁ32Ty³, 
NULL
);

1521 
PoŞDe¡royPC
 = 
M
.
	`g‘OrIn£¹FunùiÚ
("poŞde¡roy_pc", 
VoidTy³
,

1522 
PoŞDescPŒTy
, 
NULL
);

1523 
PoŞAÎocPC
 = 
M
.
	`g‘OrIn£¹FunùiÚ
("poŞ®loc_pc", 
SCALARUINTTYPE
,

1524 
PoŞDescPŒTy
, 
IÁ32Ty³
, 
NULL
);

1526 
	}
}

1528 
boŞ
 
	gPoš‹rCom´ess
::
	$runOnModuË
(
ModuË
 &
M
) {

1532 
VoidTy³
 = 
Ty³
::
	`g‘VoidTy
(
M
.
	`g‘CÚ‹xt
());

1533 
IÁ8Ty³
 = 
IÁeg”Ty³
::
	`g‘IÁ8Ty
(
M
.
	`g‘CÚ‹xt
());

1534 
IÁ16Ty³
 = 
IÁeg”Ty³
::
	`g‘IÁ16Ty
(
M
.
	`g‘CÚ‹xt
());

1535 
IÁ32Ty³
 = 
IÁeg”Ty³
::
	`g‘IÁ32Ty
(
M
.
	`g‘CÚ‹xt
());

1536 
IÁ64Ty³
 = 
IÁeg”Ty³
::
	`g‘IÁ64Ty
(
M
.
	`g‘CÚ‹xt
());

1538 
PoŞAÎoc
 = &
g‘AÇlysis
<
PoŞAÎoÿ‹PassAÎPoŞs
>();

1539 
ECG
 = &
g‘AÇlysis
<
Com¶‘eBUD©aSŒuùu»s
>();

1541 ià(
Sm®lIÁCom´ess
)

1542 
MEMUINTTYPE
 = 
IÁ16Ty³
;

1544 
MEMUINTTYPE
 = 
IÁ32Ty³
;

1547 
SCALARUINTTYPE
 = 
IÁ64Ty³
;

1551 
	`In™ŸlizePoŞLib¿ryFunùiÚs
(
M
);

1554 
	`HªdËGlob®PoŞs
(
M
);

1556 
¡d
::
£t
<
FunùiÚ
*> 
T¿nsfÜmedFns
;

1560 
boŞ
 
Chªged
 = 
çl£
;

1561 
ModuË
::
™”©Ü
 
I
 = 
M
.
	`begš
(), 
E
 = M.
	`’d
(); I != E; ++I)

1564 ià(
I
->
	`hasEx‹º®Lškage
()) {

1565 
Chªged
 |ğ
	`Com´essPoŞsInFunùiÚ
(*
I
);

1566 
T¿nsfÜmedFns
.
	`š£¹
(
I
);

1571 
i
 = 0; i !ğ
NoArgFunùiÚsC®Ëd
.
	`size
(); ++i)

1572 ià(
T¿nsfÜmedFns
.
	`š£¹
(
NoArgFunùiÚsC®Ëd
[
i
]).
£cÚd
)

1573 
Chªged
 |ğ
	`Com´essPoŞsInFunùiÚ
(*
NoArgFunùiÚsC®Ëd
[
i
]);

1575 
NoArgFunùiÚsC®Ëd
.
	`ş—r
();

1576 
ClÚedFunùiÚM­
.
	`ş—r
();

1577  
Chªged
;

1578 
	}
}

	@PoolAllocate.cpp

15 
	~<io¡»am
>

17 
	#DEBUG_TYPE
 "poŞ®loc"

	)

19 
	~"d§/D©aSŒuùu».h
"

20 
	~"d§/DSG¿ph.h
"

21 
	~"poŞ®loc/Heuri¡ic.h
"

22 
	~"poŞ®loc/PoŞAÎoÿ‹.h
"

23 
	~"poŞ®loc/RuÁimeChecks.h
"

24 
	~"Îvm/CÚ¡ªts.h
"

25 
	~"Îvm/D”ivedTy³s.h
"

26 
	~"Îvm/In¡ruùiÚs.h
"

27 
	~"Îvm/ModuË.h
"

28 
	~"Îvm/CÚ¡ªts.h
"

29 
	~"Îvm/A‰ribu‹s.h
"

30 
	~"Îvm/SuµÜt/CFG.h
"

31 
	~"Îvm/T¬g‘/T¬g‘D©a.h
"

32 
	~"Îvm/T¿nsfÜms/Uts/BasicBlockUts.h
"

33 
	~"Îvm/T¿nsfÜms/Uts/ClÚšg.h
"

34 
	~"Îvm/ADT/D•thFœ¡I‹¿tÜ.h
"

35 
	~"Îvm/ADT/Sti¡ic.h
"

36 
	~"Îvm/ADT/STLExŒas.h
"

37 
	~"Îvm/SuµÜt/CommªdLše.h
"

38 
	~"Îvm/SuµÜt/Debug.h
"

39 
	~"Îvm/SuµÜt/FÜm©‹dSŒ—m.h
"

40 
	~"Îvm/SuµÜt/Tim”.h
"

42 
usšg
 
Çme¥aû
 
	gÎvm
;

43 
usšg
 
Çme¥aû
 
	gPA
;

45 
	gPoŞAÎoÿ‹
::
ID
 = 0;

46 
	gPoŞAÎoÿ‹PassAÎPoŞs
::
ID
 = 0;

47 
	gPoŞAÎoÿ‹Group
::
ID
 = 0;

49 
Ty³
 *
	gPoŞAÎoÿ‹
::
PoŞDescPŒTy
 = 0;

51 
	gş
::
İt
<
boŞ
> 
PA
::
PA_SAFECODE
("·-§ãcode", 
ş
::
R—ÎyHidd’
);

53 
	gÇme¥aû
 {

54 
	gRegi¡”Pass
<
	gPoŞAÎoÿ‹
>

55 
X
("poolalloc", "Pool‡llocate disjoint data structures");

57 
	gRegi¡”Pass
<
	gPoŞAÎoÿ‹PassAÎPoŞs
>

58 
Y
("poolalloc-passing-all-pools", "Pool‡llocate disjoint data structures");

60 
	gRegi¡”AÇlysisGroup
<
	gPoŞAÎoÿ‹Group
> 
PAGroup
 ("Pool Allocation Group");

61 
	gRegi¡”AÇlysisGroup
<
	gPoŞAÎoÿ‹Group
> 
PAGroup1
(
X
);

63 
STATISTIC
 (
NumArgsAdded
, "Number of function‡rguments‡dded");

64 
STATISTIC
 (
MaxArgsAdded
, "Maximum function‡rguments‡ddedo one function");

65 
STATISTIC
 (
NumClÚed
 , "Number of functions cloned");

66 
STATISTIC
 (
NumPoŞs
 , "Number of…ools‡llocated");

67 
STATISTIC
 (
NumTSPoŞs
 , "Number ofypesafe…ools");

68 
STATISTIC
 (
NumPoŞF»e
 , "Number of…oolfree'sƒlided");

69 
STATISTIC
 (
NumNÚ´of™
, "Number of DSNodes‚ot…rofitable");

72 
Ty³
 *
	gVoidPŒTy
;

75 
Ty³
 *
	gPoŞDescTy³
;

77 
	gş
::
İt
<
boŞ
>

78 
Di§bËIn™De¡royO±
("poolalloc-force-simple-pool-init",

79 
ş
::
desc
("Always insert…oolinit/pooldestroy calls‡t start‡ndƒxit of functions"));

80 
	gş
::
İt
<
boŞ
>

81 
Di§bËPoŞF»eO±
("poolalloc-force-all-poolfrees",

82 
ş
::
desc
("Do‚otryoƒlide…oolfree's where…ossible"));

87 
	$ü—‹PoŞAÎocIn™
 (
ModuË
 & 
M
) {

91 
Ty³
 * 
VoidTy³
 = Ty³::
	`g‘VoidTy
(
M
.
	`g‘CÚ‹xt
());

92 
FunùiÚTy³
 * 
FTy
 = FunùiÚTy³::
	`g‘
(
VoidTy³
,

93 
¡d
::
veùÜ
<
Ty³
*>(),

94 
çl£
);

95 
FunùiÚ
 *
In™Func
 = FunùiÚ::
	`C»©e
 (
FTy
,

96 
Glob®V®ue
::
Ex‹º®Lškage
,

98 &
M
);

103 
BasicBlock
 * 
BB
 = BasicBlock::
	`C»©e
 (
M
.
	`g‘CÚ‹xt
(), "’Œy", 
In™Func
);

104 
R‘uºIn¡
::
	`C»©e
(
M
.
	`g‘CÚ‹xt
(), 
BB
);

107 
	}
}

117 
FunùiÚ
 * 
	gPoŞAÎoÿ‹
::
	$ü—‹Glob®PoŞCtÜ
 (
ModuË
 & 
M
) {

121 
LLVMCÚ‹xt
 & 
CÚ‹xt
 = 
M
.
	`g‘CÚ‹xt
();

122 
Ty³
 * 
VoidTy³
 = Ty³::
	`g‘VoidTy
 (
CÚ‹xt
);

123 
FunùiÚTy³
 * 
FTy
 = FunùiÚTy³::
	`g‘
(
VoidTy³
,

124 
¡d
::
veùÜ
<
Ty³
*>(),

125 
çl£
);

126 
FunùiÚ
 *
In™Func
 = FunùiÚ::
	`C»©e
 (
FTy
,

127 
Glob®V®ue
::
Ex‹º®Lškage
,

129 &
M
);

134 
BasicBlock
 * 
BB
 = BasicBlock::
	`C»©e
 (
CÚ‹xt
, "’Œy", 
In™Func
);

135 
R‘uºIn¡
::
	`C»©e
(
CÚ‹xt
, 
BB
);

140 
Ty³
 * 
IÁ32Ty³
 = 
IÁeg”Ty³
::
	`g‘IÁ32Ty
(
CÚ‹xt
);

141 
¡d
::
veùÜ
<
CÚ¡ªt
 *> 
CtÜIn™s
;

147 
CtÜIn™s
.
	`push_back
 (
CÚ¡ªtIÁ
::
	`g‘
 (
IÁ32Ty³
, 0));

148 
CtÜIn™s
.
	`push_back
 (
In™Func
);

149 
CÚ¡ªt
 * 
RuÁimeCtÜIn™
 = 
CÚ¡ªtSŒuù
::
	`g‘AnÚ
(
CÚ‹xt
, 
CtÜIn™s
);

155 
¡d
::
veùÜ
<
CÚ¡ªt
 *> 
Cu¼’tCtÜs
;

156 
Glob®V¬ŸbË
 * 
GVCtÜ
 = 
M
.
	`g‘NamedGlob®
 ("llvm.global_ctors");

157 ià(
GVCtÜ
) {

158 ià(
CÚ¡ªt
 * 
C
 = 
GVCtÜ
->
	`g‘In™Ÿliz”
()) {

159 
šdex
 = 0; index < 
C
->
	`g‘NumO³¿nds
(); ++index) {

160 
Cu¼’tCtÜs
.
	`push_back
 (
ÿ¡
<
CÚ¡ªt
>(
C
->
	`g‘O³¿nd
 (
šdex
)));

168 
GVCtÜ
->
	`£tName
 ("removed");

176 ià(
M
.
	`g‘T¬g‘TrË
().
	`fšd
 ("lšux"è=ğ
¡d
::
¡ršg
::
Åos
)

177 
Cu¼’tCtÜs
.
	`š£¹
 (Cu¼’tCtÜs.
	`begš
(), 
RuÁimeCtÜIn™
);

179 
Cu¼’tCtÜs
.
	`push_back
 (
RuÁimeCtÜIn™
);

184 
A¼ayTy³
 * 
AT
 = A¼ayTy³::
	`g‘
 (
RuÁimeCtÜIn™
-> 
	`g‘Ty³
(),

185 
Cu¼’tCtÜs
.
	`size
());

186 
CÚ¡ªt
 * 
NewIn™
=
CÚ¡ªtA¼ay
::
	`g‘
 (
AT
, 
Cu¼’tCtÜs
);

192 
Ãw
 
	`Glob®V¬ŸbË
 (
M
,

193 
NewIn™
->
	`g‘Ty³
(),

194 
çl£
,

195 
Glob®V®ue
::
Aµ’dšgLškage
,

196 
NewIn™
,

199  
In™Func
;

200 
	}
}

202 
	gPoŞAÎoÿ‹
::
	$g‘AÇlysisU§ge
(
AÇlysisU§ge
 &
AU
) const {

205 
AU
.
addRequœed
<
Heuri¡ic
>();

206 
AU
.
addP»£rved
<
Heuri¡ic
>();

208 ià(
d§_·ss_to_u£
 =ğ
PASS_EQTD
) {

209 
AU
.
addRequœedT¿ns™ive
<
EQTDD©aSŒuùu»s
>();

210 if(
l›_´e£rve_·s£s
 !ğ
LIE_NONE
)

211 
AU
.
addP»£rved
<
EQTDD©aSŒuùu»s
>();

213 
AU
.
addRequœedT¿ns™ive
<
EquivBUD©aSŒuùu»s
>();

214 if(
l›_´e£rve_·s£s
 !ğ
LIE_NONE
)

215 
AU
.
addP»£rved
<
EquivBUD©aSŒuùu»s
>();

219 ià(
l›_´e£rve_·s£s
 =ğ
LIE_PRESERVE_ALL
)

220 
AU
.
	`£tP»£rvesAÎ
();

222 
AU
.
addRequœed
<
T¬g‘D©a
>();

223 
	}
}

225 
boŞ
 
	gPoŞAÎoÿ‹
::
	$runOnModuË
(
ModuË
 &
M
) {

226 ià(
M
.
	`begš
(è=ğM.
	`’d
()è 
çl£
;

227 
CurModuË
 = &
M
;

232 
VoidTy³
 = 
Ty³
::
	`g‘VoidTy
(
M
.
	`g‘CÚ‹xt
());

233 
IÁ8Ty³
 = 
IÁeg”Ty³
::
	`g‘IÁ8Ty
(
M
.
	`g‘CÚ‹xt
());

234 
IÁ32Ty³
 = 
IÁeg”Ty³
::
	`g‘IÁ32Ty
(
M
.
	`g‘CÚ‹xt
());

243 ià(
d§_·ss_to_u£
 =ğ
PASS_EQTD
)

244 
G¿phs
 = &
g‘AÇlysis
<
EQTDD©aSŒuùu»s
>();

246 
G¿phs
 = &
g‘AÇlysis
<
EquivBUD©aSŒuùu»s
>();

251 
CurHeuri¡ic
 = &
g‘AÇlysis
<
Heuri¡ic
>();

252 
CurHeuri¡ic
->
	`In™Ÿlize
 (*
this
);

255 
	`AddPoŞPrÙÙy³s
(&
M
);

258 
Glob®PoŞCtÜ
 = 
	`ü—‹Glob®PoŞCtÜ
 (
M
);

261 ià(
	`S‘upGlob®PoŞs
(
M
))

262  
Œue
;

268 
	`FšdPoŞArgs
 (
M
);

271 
¡d
::
m­
<
FunùiÚ
*, FunùiÚ*> 
FuncM­
;

283 
¡d
::
veùÜ
<
FunùiÚ
 *> 
FunùiÚsToClÚe
;

284 
ModuË
::
™”©Ü
 
I
 = 
M
.
	`begš
(), 
E
 = M.
	`’d
(); I != E; ++I) {

285 ià(!
I
->
	`isDeş¬©iÚ
(è&& 
G¿phs
->
	`hasDSG¿ph
(*I)) {

286 
FunùiÚsToClÚe
.
	`push_back
 (
I
);

298 
¡d
::
£t
<
FunùiÚ
*> 
ClÚedFunùiÚs
;

299 
FunùiÚ
 *
MašFunc
 = 
M
.
	`g‘FunùiÚ
("main");

300 
FunùiÚsToClÚe
.
	`size
()) {

304 
FunùiÚ
 * 
Origš®
 = 
FunùiÚsToClÚe
.
	`back
();

305 
FunùiÚsToClÚe
.
	`pİ_back
 ();

308 ià(
Origš®
 =ğ
MašFunc
) {

316 ià(
FunùiÚ
 *
ClÚe
 = 
	`MakeFunùiÚClÚe
(*
Origš®
)) {

317 
FuncM­
[
Origš®
] = 
ClÚe
;

318 
ClÚedFunùiÚs
.
	`š£¹
(
ClÚe
);

328 
ModuË
::
™”©Ü
 
I
 = 
M
.
	`begš
(), 
E
 = M.
	`’d
(); I != E; ++I) {

329 ià(!
I
->
	`isDeş¬©iÚ
(è&& !
ClÚedFunùiÚs
.
	`couÁ
(I) &&

330 
G¿phs
->
	`hasDSG¿ph
(*
I
)) {

331 
¡d
::
m­
<
FunùiÚ
*, FunùiÚ*>::
™”©Ü
 
FI
 = 
FuncM­
.
	`fšd
(
I
);

332 
	`ProûssFunùiÚBody
(*
I
, 
FI
 !ğ
FuncM­
.
	`’d
(è? *FI->
£cÚd
 : *I);

340 
¡d
::
m­
<
FunùiÚ
 *, FunùiÚ *>::
™”©Ü
 
I
 = 
FuncM­
.
	`begš
(),

341 
E
 = 
FuncM­
.
	`’d
();

342 
I
 !ğ
E
; ++I) {

343 
FunùiÚ
 *
F
 = 
I
->
fœ¡
;

352 
¡d
::
veùÜ
<
U£r
 *> 
toR•Ïû
;

353 
FunùiÚ
::
u£_™”©Ü
 
U£r
 = 
F
->
	`u£_begš
();

354 
U£r
 !ğ
F
->
	`u£_’d
();

355 ++
U£r
) {

356 ià(
C®lIn¡
 * 
CI
 = 
dyn_ÿ¡
<C®lIn¡>(*
U£r
)) {

357 ià(
CI
->
	`g‘C®ËdFunùiÚ
(è=ğ
F
)

358 ià((
FuncM­
.
	`fšd
(
CI
->
	`g‘P¬’t
()->g‘P¬’t())è!ğFuncM­.
	`’d
())

362 ià(
InvokeIn¡
 * 
CI
 = 
dyn_ÿ¡
<InvokeIn¡>(*
U£r
)) {

363 ià(
CI
->
	`g‘C®ËdFunùiÚ
(è=ğ
F
)

364 ià((
FuncM­
.
	`fšd
(
CI
->
	`g‘P¬’t
()->g‘P¬’t())è!ğFuncM­.
	`’d
())

371 
toR•Ïû
.
	`push_back
 (*
U£r
);

377 
toR•Ïû
.
	`size
()) {

378 
Îvm
::
U£r
 * 
u£r
 = 
toR•Ïû
.
	`back
();

379 
toR•Ïû
.
	`pİ_back
();

381 
CÚ¡ªt
* 
CEÃw
 = 
CÚ¡ªtEx´
::
	`g‘Poš‹rCa¡
(
I
->
£cÚd
, 
F
->
	`g‘Ty³
());

387 ià(
CÚ¡ªt
 *
C
 = 
dyn_ÿ¡
<CÚ¡ªt>(
u£r
)) {

388 ià(!
i§
<
Glob®V®ue
>(
C
)) {

394 
¡d
::
veùÜ
<
U£
 *> 
R•ÏûWÜkli¡
;

395 
U£r
::
İ_™”©Ü
 
u£
 = 
u£r
->
	`İ_begš
();

396 
u£
 !ğ
u£r
->
	`İ_’d
();

397 ++
u£
) {

398 ià(
u£
->
	`g‘
(è=ğ
F
) {

399 
R•ÏûWÜkli¡
.
	`push_back
 (
u£
);

406 
šdex
 = 0; index < 
R•ÏûWÜkli¡
.
	`size
(); ++index)

407 
C
->
	`»¶aûU£sOfW™hOnCÚ¡ªt
(
F
, 
CEÃw
, 
R•ÏûWÜkli¡
[
šdex
]);

411 
u£r
->
	`»¶aûU£sOfW™h
 (
F
, 
CEÃw
);

419 
	`ü—‹PoŞAÎocIn™
 (
M
);

429 ià(
CurHeuri¡ic
->
	`IsR—lHeuri¡ic
())

430 
	`MiüoO±imizePoŞC®ls
();

433  
Œue
;

434 
	}
}

441 
	gPoŞAÎoÿ‹
::
	$AddPoŞPrÙÙy³s
(
ModuË
* 
M
) {

442 ià(
VoidPŒTy
 == 0) {

444 
VoidPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
IÁ8Ty³
);

445 
PoŞDescTy³
 = 
	`g‘PoŞTy³
(&
M
->
	`g‘CÚ‹xt
());

446 
PoŞDescPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
PoŞDescTy³
);

454 
PoŞIn™
 = 
M
->
	`g‘OrIn£¹FunùiÚ
("poŞš™", 
VoidTy³
,

455 
PoŞDescPŒTy
, 
IÁ32Ty³
,

456 
IÁ32Ty³
, 
NULL
);

459 
PoŞDe¡roy
 = 
M
->
	`g‘OrIn£¹FunùiÚ
("poŞde¡roy", 
VoidTy³
,

460 
PoŞDescPŒTy
, 
NULL
);

463 
PoŞAÎoc
 = 
M
->
	`g‘OrIn£¹FunùiÚ
("poolalloc",

464 
VoidPŒTy
, 
PoŞDescPŒTy
,

465 
IÁ32Ty³
, 
NULL
);

468 
PoŞR—Îoc
 = 
M
->
	`g‘OrIn£¹FunùiÚ
("poolrealloc",

469 
VoidPŒTy
, 
PoŞDescPŒTy
,

470 
VoidPŒTy
, 
IÁ32Ty³
, 
NULL
);

473 
PoŞC®loc
 = 
M
->
	`g‘OrIn£¹FunùiÚ
("poolcalloc",

474 
VoidPŒTy
, 
PoŞDescPŒTy
,

475 
IÁ32Ty³
, IÁ32Ty³, 
NULL
);

478 
PoŞMemAlign
 = 
M
->
	`g‘OrIn£¹FunùiÚ
("poolmemalign",

479 
VoidPŒTy
, 
PoŞDescPŒTy
,

480 
IÁ32Ty³
, Int32Type,

481 
NULL
);

484 
PoŞSŒdup
 = 
M
->
	`g‘OrIn£¹FunùiÚ
("poolstrdup",

485 
VoidPŒTy
, 
PoŞDescPŒTy
,

486 
VoidPŒTy
, 
NULL
);

489 
PoŞF»e
 = 
M
->
	`g‘OrIn£¹FunùiÚ
("poŞä“", 
VoidTy³
,

490 
PoŞDescPŒTy
, 
VoidPŒTy
, 
NULL
);

492 
PoŞRegi¡”
 = 
M
->
	`g‘OrIn£¹FunùiÚ
("poŞ»gi¡”", 
VoidTy³
,

493 
PoŞDescPŒTy
, 
VoidPŒTy
, 
IÁ32Ty³
, 
NULL
);

495 
FunùiÚ
* 
±h»ad_ü—‹_func
 = 
M
->
	`g‘FunùiÚ
("pthread_create");

496 if(
±h»ad_ü—‹_func
)

498 
FunùiÚ
::
¬g_™”©Ü
 
i
 = 
±h»ad_ü—‹_func
->
	`¬g_begš
();

499 
¡d
::
veùÜ
<
Ty³
*> 
nÚ_v¬¬g_·¿ms
;

500 
nÚ_v¬¬g_·¿ms
.
	`push_back
(
i
++->
	`g‘Ty³
());

501 
nÚ_v¬¬g_·¿ms
.
	`push_back
(
i
++->
	`g‘Ty³
());

502 
nÚ_v¬¬g_·¿ms
.
	`push_back
(
i
++->
	`g‘Ty³
());

503 
nÚ_v¬¬g_·¿ms
.
	`push_back
(
IÁ32Ty³
);

504 
PoŞTh»adW¿µ”
 = 
M
->
	`g‘OrIn£¹FunùiÚ
("poŞ®loc_±h»ad_ü—‹",
FunùiÚTy³
::
	`g‘
(
IÁ32Ty³
,
nÚ_v¬¬g_·¿ms
,
Œue
));

506 
	}
}

508 
g‘C®lsOf
(
CÚ¡ªt
 *
C
, 
¡d
::
veùÜ
<
C®lIn¡
*> &
C®ls
) {

510 
FunùiÚ
 * 
F
;

511 
CÚ¡ªtEx´
 * 
	gCE
;

512 ià(!(
	gF
=
dyn_ÿ¡
<
FunùiÚ
>(
C
))) {

513 ià((
CE
 = 
dyn_ÿ¡
<
CÚ¡ªtEx´
>(
C
)è&& (CE->
isCa¡
()))

514 
F
 = 
dyn_ÿ¡
<
FunùiÚ
>(
CE
->
g‘O³¿nd
(0));

516 
as£¹
 (0 && "Constant is‚ot‡ Function of ConstantExpr!");

518 
	gC®ls
.
ş—r
();

519 
	gV®ue
::
u£_™”©Ü
 
UI
 = 
F
->
u£_begš
(), 
	gE
 = F->
u£_’d
(); 
	gUI
 !ğ
E
; ++UI)

520 
	gC®ls
.
push_back
(
ÿ¡
<
C®lIn¡
>(*
UI
));

532 
	$O±imizePoš‹rNÙNuÎ
(
V®ue
 *
V
, 
LLVMCÚ‹xt
 * 
CÚ‹xt
) {

533 
V®ue
::
u£_™”©Ü
 
I
 = 
V
->
	`u£_begš
(), 
E
 = V->
	`u£_’d
(); I != E; ++I) {

534 
In¡ruùiÚ
 *
U£r
 = 
ÿ¡
<In¡ruùiÚ>(*
I
);

535 ià(
i§
<
ICmpIn¡
>(
U£r
è&& 
ÿ¡
<ICmpIn¡>(U£r)->
	`isEqu®™y
()) {

536 
ICmpIn¡
 * 
ICI
 = 
ÿ¡
<ICmpIn¡>(
U£r
);

537 ià(
i§
<
CÚ¡ªt
>(
U£r
->
	`g‘O³¿nd
(1)) &&

538 
ÿ¡
<
CÚ¡ªt
>(
U£r
->
	`g‘O³¿nd
(1))->
	`isNuÎV®ue
()) {

539 
boŞ
 
CÚdIsTrue
 = 
ICI
->
	`g‘P»diÿ‹
(è=ğ
ICmpIn¡
::
ICMP_NE
;

540 
Ty³
 * 
IÁ1Ty³
 = 
IÁeg”Ty³
::
	`g‘IÁ1Ty
(*
CÚ‹xt
);

541 
U£r
->
	`»¶aûAÎU£sW™h
(
CÚ¡ªtIÁ
::
	`g‘
(
IÁ1Ty³
, 
CÚdIsTrue
));

543 } ià((
U£r
->
	`g‘Opcode
(è=ğ
In¡ruùiÚ
::
Trunc
) ||

544 (
U£r
->
	`g‘Opcode
(è=ğ
In¡ruùiÚ
::
ZExt
) ||

545 (
U£r
->
	`g‘Opcode
(è=ğ
In¡ruùiÚ
::
SExt
) ||

546 (
U£r
->
	`g‘Opcode
(è=ğ
In¡ruùiÚ
::
FPToUI
) ||

547 (
U£r
->
	`g‘Opcode
(è=ğ
In¡ruùiÚ
::
FPToSI
) ||

548 (
U£r
->
	`g‘Opcode
(è=ğ
In¡ruùiÚ
::
UIToFP
) ||

549 (
U£r
->
	`g‘Opcode
(è=ğ
In¡ruùiÚ
::
SIToFP
) ||

550 (
U£r
->
	`g‘Opcode
(è=ğ
In¡ruùiÚ
::
FPTrunc
) ||

551 (
U£r
->
	`g‘Opcode
(è=ğ
In¡ruùiÚ
::
FPExt
) ||

552 (
U£r
->
	`g‘Opcode
(è=ğ
In¡ruùiÚ
::
PŒToIÁ
) ||

553 (
U£r
->
	`g‘Opcode
(è=ğ
In¡ruùiÚ
::
IÁToPŒ
) ||

554 (
U£r
->
	`g‘Opcode
(è=ğ
In¡ruùiÚ
::
B™Ca¡
)) {

556 ià(
i§
<
Poš‹rTy³
>(
U£r
->
	`g‘Ty³
()))

557 
	`O±imizePoš‹rNÙNuÎ
(
U£r
, 
CÚ‹xt
);

558 } ià(
U£r
->
	`g‘Opcode
(è=ğ
In¡ruùiÚ
::
G‘EËm’tPŒ
) {

560 
	`O±imizePoš‹rNÙNuÎ
(
U£r
, 
CÚ‹xt
);

563 
	}
}

570 
	gPoŞAÎoÿ‹
::
	$MiüoO±imizePoŞC®ls
() {

572 
¡d
::
veùÜ
<
C®lIn¡
*> 
C®ls
;

573 
	`g‘C®lsOf
(
PoŞAÎoc
, 
C®ls
);

574 
i
 = 0, 
e
 = 
C®ls
.
	`size
(); i !=ƒ; ++i) {

575 
C®lIn¡
 *
CI
 = 
C®ls
[
i
];

578 
	`O±imizePoš‹rNÙNuÎ
(
CI
, &CI->
	`g‘CÚ‹xt
());

583 
	}
}

603 
šlše
 

604 
G‘NodesR—chabËFromGlob®s
 (
DSG¿ph
* 
G
,

605 
D’£S‘
<cÚ¡ 
DSNode
*> &
NodesFromGlob®s
) {

610 
DSG¿ph
 * 
	gGlob®sG¿ph
 = 
G
->
g‘Glob®sG¿ph
();

611 ià(!
	gGlob®sG¿ph
)

612 
	gGlob®sG¿ph
 = 
G
;

617 
	gDSG¿ph
::
node_™”©Ü
 
NI
 = 
Glob®sG¿ph
->
node_begš
();

618 
	gNI
 !ğ
Glob®sG¿ph
->
node_’d
();

619 ++
	gNI
) {

620 
	gNI
->
m¬kR—chabËNodes
(
NodesFromGlob®s
);

628 ià(
	gG
->
g‘Glob®sG¿ph
()) {

633 
	gDSG¿ph
::
NodeM­Ty
 
NodeM­
;

634 
	gG
->
compu‹GToGGM­pšg
 (
NodeM­
);

645 
	gDSG¿ph
::
node_™”©Ü
 
ni
 = 
G
->
node_begš
();

646 ; 
	gni
 !ğ
G
->
node_’d
(); ++ni) {

647 
DSNode
 * 
	gN
 = 
ni
;

648 ià(
	gNodesFromGlob®s
.
couÁ
 (
NodeM­
[
N
].
g‘Node
()))

649 
	gNodesFromGlob®s
.
š£¹
 (
N
);

662 
	gPoŞAÎoÿ‹
::
	$FšdPoŞArgs
 (
ModuË
 & 
M
) {

670 cÚ¡ 
DSC®lG¿ph
 & 
ÿÎg¿ph
 = 
G¿phs
->
	`g‘C®lG¿ph
();

671 
DSG¿ph
* 
G
 = 
G¿phs
->
	`g‘Glob®sG¿ph
();

672 
DSG¿ph
::
SÿÏrM­Ty
& 
SM
 = 
G
->
	`g‘SÿÏrM­
();

673 
DSC®lG¿ph
::
ÿÎ“_key_™”©Ü
 
ii
 = 
ÿÎg¿ph
.
	`key_begš
(),

674 
“
 = 
ÿÎg¿ph
.
	`key_’d
(); 
ii
 !=ƒe; ++ii) {

675 
boŞ
 
isIndœeù
 = ((*
ii
).
	`g‘C®ËdFunùiÚ
(è=ğ
NULL
);

676 
boŞ
 
ex‹ºFunùiÚFound
 = 
çl£
;

678 ià(
isIndœeù
) {

679 
¡d
::
veùÜ
<cÚ¡ 
FunùiÚ
 *> 
FunùiÚs
;

680 
DSC®lG¿ph
::
ÿÎ“_™”©Ü
 
csi
 = 
ÿÎg¿ph
.
	`ÿÎ“_begš
(*
ii
),

681 
c£
 = 
ÿÎg¿ph
.
	`ÿÎ“_’d
(*
ii
);

682 
csi
 !ğ
c£
) {

683 cÚ¡ 
FunùiÚ
 *
F
 = *
csi
;

684 
DSC®lG¿ph
::
scc_™”©Ü
 
sccii
 = 
ÿÎg¿ph
.
	`scc_begš
(
F
),

685 
scûe
 = 
ÿÎg¿ph
.
	`scc_’d
(
F
);

686 ;
sccii
 !ğ
scûe
; ++sccii) {

687 
DSG¿ph
::
SÿÏrM­Ty
::
cÚ¡_™”©Ü
 
I
 = 
SM
.
	`fšd
(SM.
	`g‘L—d”FÜGlob®
(*
sccii
));

688 ià(
I
 !ğ
SM
.
	`’d
()) {

689 ià((*
sccii
)->
	`isDeş¬©iÚ
()) {

690 
ex‹ºFunùiÚFound
 = 
Œue
;

693 
FunùiÚs
.
	`push_back
 (*
sccii
);

696 ++
csi
;

698 cÚ¡ 
FunùiÚ
 *
F1
 = (*
ii
).
	`g‘In¡ruùiÚ
()->
	`g‘P¬’t
()->getParent();

699 
F1
 = 
ÿÎg¿ph
.
	`sccL—d”
(&*F1);

701 
DSC®lG¿ph
::
scc_™”©Ü
 
sccii
 = 
ÿÎg¿ph
.
	`scc_begš
(
F1
),

702 
scûe
 = 
ÿÎg¿ph
.
	`scc_’d
(
F1
);

703 ;
sccii
 !ğ
scûe
; ++sccii) {

704 
DSG¿ph
::
SÿÏrM­Ty
::
cÚ¡_™”©Ü
 
I
 = 
SM
.
	`fšd
(SM.
	`g‘L—d”FÜGlob®
(*
sccii
));

705 ià(
I
 !ğ
SM
.
	`’d
()) {

706 ià((*
sccii
)->
	`isDeş¬©iÚ
()) {

707 
ex‹ºFunùiÚFound
 = 
Œue
;

710 
FunùiÚs
.
	`push_back
 (*
sccii
);

713 
boŞ
 
doNÙPassPoŞs
 = 
ex‹ºFunùiÚFound
;

717 if(!
doNÙPassPoŞs
){

718 
šdex
 = 0; index < 
FunùiÚs
.
	`size
(); ++index) {

719 cÚ¡ 
FunùiÚ
 * 
F
 = 
FunùiÚs
[
šdex
];

720 ià(
ÿÎg¿ph
.
	`ÿÎed_äom_šcom¶‘e_s™e
(
F
)){

721 
doNÙPassPoŞs
 = 
Œue
;

727 if(
doNÙPassPoŞs
) {

733 
šdex
 = 0; index < 
FunùiÚs
.
	`size
(); ++index) {

734 
FunùiÚ
 * 
F
 = 
cÚ¡_ÿ¡
<FunùiÚ*>(
FunùiÚs
[
šdex
]);

735 ià(
FunùiÚInfo
.
	`fšd
 (
F
è!ğFunùiÚInfo.
	`’d
()) {

736 #iâdeà
NDEBUG


737 
FuncInfo
 & 
FI
 = 
FunùiÚInfo
.
	`fšd
(
F
)->
£cÚd
;

738 
	`as£¹
(
FI
.
ArgNodes
.
	`size
() == 0);

746 
FunùiÚInfo
.
	`š£¹
(
¡d
::
	`make_·œ
(
F
, 
	`FuncInfo
(*F)));

749 
	`FšdFunùiÚPoŞArgs
 (
FunùiÚs
);

757 
ModuË
::
™”©Ü
 
I
 = 
M
.
	`begš
(), 
E
 = M.
	`’d
(); I != E; ++I) {

758 ià(!
I
->
	`isDeş¬©iÚ
(è&& 
G¿phs
->
	`hasDSG¿ph
(*I)) {

759 ià(
FunùiÚInfo
.
	`fšd
 (
I
è=ğFunùiÚInfo.
	`’d
()) {

760 
¡d
::
veùÜ
<cÚ¡ 
FunùiÚ
 *> 
FunùiÚs
;

761 
FunùiÚs
.
	`push_back
(
I
);

762 
	`FšdFunùiÚPoŞArgs
 (
FunùiÚs
);

768 
	}
}

774 
	gPoŞAÎoÿ‹
::
FšdFunùiÚPoŞArgs
 (cÚ¡ 
¡d
::
veùÜ
<cÚ¡ 
FunùiÚ
 *> & 
FunùiÚs
) {

778 ià(
FunùiÚs
.
size
() == 0)

785 
	g¡d
::
veùÜ
<
DSNodeHªdË
> 
RoÙNodes
;

786 
	gšdex
 = 0; index < 
	gFunùiÚs
.
size
(); ++index) {

790 cÚ¡ 
FunùiÚ
 * 
	gF
 = 
FunùiÚs
[
šdex
];

791 
DSG¿ph
* 
	gG
 = 
G¿phs
->
g‘DSG¿ph
 (*
F
);

797 
	gG
->
g‘FunùiÚArgum’tsFÜC®l
 (
F
, 
RoÙNodes
);

804 ià(
	gRoÙNodes
.
size
() == 0)

810 
	gD’£S‘
<cÚ¡ 
	gDSNode
*> 
	gM¬kedNodes
;

811 
	gšdex
 = 0; index < 
	gRoÙNodes
.
size
(); ++index) {

812 ià(
DSNode
 * 
	gN
 = 
RoÙNodes
[
šdex
].
g‘Node
()) {

813 
N
->
m¬kR—chabËNodes
(
M¬kedNodes
);

822 ià(!
	gPassAÎArgum’ts
) {

823 
	g¡d
::
m­
<cÚ¡ 
DSNode
*, 
	gV®ue
*>::
™”©Ü
 
gni
;

824 
	ggni
 = 
Glob®Nodes
.
begš
(); gn˜!ğGlob®Nodes.
’d
(); ++gni) {

825 
	gM¬kedNodes
.
”a£
(
gni
->
fœ¡
);

830 
	gD’£S‘
<cÚ¡ 
	gDSNode
*> 
	gNodesFromGlob®s
;

831 
	gšdex
 = 0; index < 
	gFunùiÚs
.
size
(); ++index) {

835 cÚ¡ 
FunùiÚ
 * 
	gF
 = 
FunùiÚs
[
šdex
];

836 
DSG¿ph
* 
	gG
 = 
G¿phs
->
g‘DSG¿ph
(*
F
);

837 
G‘NodesR—chabËFromGlob®s
 (
G
, 
NodesFromGlob®s
);

852 
	gD’£S‘
<cÚ¡ 
	gDSNode
*>::
™”©Ü
 
I
 = 
M¬kedNodes
.
begš
(),

853 
	gE
 = 
M¬kedNodes
.
’d
(); 
	gI
 !ğ
E
; ) {

854 cÚ¡ 
DSNode
 *
	gN
 = *
I
; ++
	gI
;

855 ià((!(1 || 
	gN
->
isH—pNode
()è&& !
	gPassAÎArgum’ts
) ||

856 
	gNodesFromGlob®s
.
couÁ
(
N
))

857 
	gM¬kedNodes
.
”a£
(
N
);

865 
	gšdex
 = 0; index < 
	gFunùiÚs
.
size
(); ++index) {

866 
FunùiÚ
 * 
	gF
 = 
cÚ¡_ÿ¡
<FunùiÚ*>(
FunùiÚs
[
šdex
]);

867 ià(
	gFunùiÚInfo
.
fšd
 (
F
è!ğ
FunùiÚInfo
.
’d
()) {

868 #iâdeà
NDEBUG


869 
FuncInfo
 & 
FI
 = 
FunùiÚInfo
.
fšd
(
F
)->
£cÚd
;

870 
as£¹
(
FI
.
ArgNodes
.
size
(è=ğ
M¬kedNodes
.size());

875 
	gFuncInfo
 & 
	gFI
 =

876 
FunùiÚInfo
.
š£¹
(
¡d
::
make_·œ
(
F
, 
FuncInfo
(*F))).
	gfœ¡
->
	g£cÚd
;

882 
	gD’£S‘
<cÚ¡ 
	gDSNode
*>::
™”©Ü
 
ii
 = 
M¬kedNodes
.
begš
(),

883 
	g“
 = 
M¬kedNodes
.
’d
(); 
	gii
 !ğ
“
; ++ii) {

884 
	gFI
.
	gM¬kedNodes
.
š£¹
(*
ii
);

885 
	gFI
.
	gArgNodes
.
š£¹
(
FI
.
ArgNodes
.
’d
(), *
ii
);

902 
FunùiÚ
 *

903 
	gPoŞAÎoÿ‹
::
	$MakeFunùiÚClÚe
 (
FunùiÚ
 & 
F
) {

908 
DSG¿ph
* 
G
 = 
G¿phs
->
	`g‘DSG¿ph
(
F
);

909 ià(
G
->
	`node_begš
(è=ğG->
	`node_’d
())  0;

914 
FuncInfo
 &
FI
 = *
	`g‘FuncInfo
(
F
);

915 ià(
FI
.
ArgNodes
.
	`em±y
())

919 
NumArgsAdded
 +ğ
FI
.
ArgNodes
.
	`size
();

920 ià(
MaxArgsAdded
 < 
FI
.
ArgNodes
.
	`size
())

921 
MaxArgsAdded
 = 
FI
.
ArgNodes
.
	`size
();

922 ++
NumClÚed
;

929 
¡d
::
veùÜ
<
Ty³
*> 
	`ArgTys
(
FI
.
ArgNodes
.
	`size
(), 
PoŞDescPŒTy
);

930 
FunùiÚTy³
 *
OldFuncTy
 = 
F
.
	`g‘FunùiÚTy³
();

931 
ArgTys
.
	`»£rve
(
OldFuncTy
->
	`g‘NumP¬ams
(è+ 
FI
.
ArgNodes
.
	`size
());

932 
ArgTys
.
	`š£¹
(ArgTys.
	`’d
(), 
OldFuncTy
->
	`·¿m_begš
(), OldFuncTy->
	`·¿m_’d
());

935 
FunùiÚTy³
 *
FuncTy
 = FunùiÚTy³::
	`g‘
(
OldFuncTy
->
	`g‘R‘uºTy³
(), 
ArgTys
,

936 
OldFuncTy
->
	`isV¬Arg
());

943 
FunùiÚ
 *
New
 = FunùiÚ::
	`C»©e
(
FuncTy
, FunùiÚ::
IÁ”ÇlLškage
, 
F
.
	`g‘Name
().
	`¡r
() + "_clone");

944 
F
.
	`g‘P¬’t
()->
	`g‘FunùiÚLi¡
().
	`š£¹
(&F, 
New
);

945 
ClÚeToOrigM­
[
New
] = &
F
;

949 
¡d
::
m­
<cÚ¡ 
DSNode
*, 
V®ue
*> &
PoŞDesütÜs
 = 
FI
.PoolDescriptors;

950 
FunùiÚ
::
¬g_™”©Ü
 
NI
 = 
New
->
	`¬g_begš
();

951 
i
 = 0, 
e
 = 
FI
.
ArgNodes
.
	`size
(); i !ğe; ++i, ++
NI
) {

952 
NI
->
	`£tName
("PDa");

953 
PoŞDesütÜs
[
FI
.
ArgNodes
[
i
]] = 
NI
;

961 
V®ueToV®ueM­Ty
 
V®ueM­
;

965 ià(
SAFECodeEÇbËd
)

966 
¡d
::
m­
<cÚ¡ 
V®ue
*, V®ue*>::
™”©Ü
 
I
 = 
FI
.
V®ueM­
.
	`begš
(),

967 
E
 = 
FI
.
V®ueM­
.
	`’d
(); 
I
 != E; ++I)

968 
V®ueM­
.
	`š£¹
(
¡d
::
	`make_·œ
(
I
->
fœ¡
, I->
£cÚd
));

970 
FunùiÚ
::
¬g_™”©Ü
 
I
 = 
F
.
	`¬g_begš
();

971 
NI
 !ğ
New
->
	`¬g_’d
(); ++
I
, ++NI) {

972 
V®ueM­
[
I
] = 
NI
;

973 
NI
->
	`£tName
(
I
->
	`g‘Name
());

977 
Sm®lVeùÜ
<
R‘uºIn¡
*,100> 
R‘uºs
;

979 
	`ClÚeFunùiÚIÁo
(
New
, &
F
, 
V®ueM­
, 
Œue
, 
R‘uºs
);

984 
¡d
::
m­
<
V®ue
*, cÚ¡ V®ue*> &
NewToOldV®ueM­
 = 
FI
.NewToOldValueMap;

985 
V®ueToV®ueM­Ty
::
™”©Ü
 
I
 = 
V®ueM­
.
	`begš
(),

986 
E
 = 
V®ueM­
.
	`’d
(); 
I
 != E; ++I)

987 
NewToOldV®ueM­
.
	`š£¹
(
¡d
::
	`make_·œ
(
I
->
£cÚd
, I->
fœ¡
));

997 
FunùiÚ
::
Argum’tLi¡Ty³
 & 
ArgLi¡
 = 
New
->
	`g‘Argum’tLi¡
 ();

998 
FunùiÚ
::
Argum’tLi¡Ty³
::
™”©Ü
 
¬g
 = 
ArgLi¡
.
	`begš
();

999 ; 
¬g
 !ğ
ArgLi¡
.
	`’d
(); ++arg) {

1000 
¬g
->
	`»moveA‰r
 (
A‰ribu‹
::
SŒuùR‘
);

1010 
New
->
	`£tC®lšgCÚv
 (
F
.
	`g‘C®lšgCÚv
());

1012  
FI
.
ClÚe
 = 
New
;

1013 
	}
}

1029 
boŞ
 
	gPoŞAÎoÿ‹
::
	$S‘upGlob®PoŞs
(
ModuË
 &
M
) {

1034 
¡d
::
veùÜ
<cÚ¡ 
DSNode
*> 
NodesToPA
;

1035 
CurHeuri¡ic
->
	`g‘Glob®PoŞNodes
 (
NodesToPA
);

1037 
	`”rs
(è<< "PoŞ‡Îoÿtšg " << 
NodesToPA
.
	`size
() << " global‚odes!\n";

1039 
DSG¿ph
* 
GG
 = 
G¿phs
->
	`g‘Glob®sG¿ph
();

1040 
¡d
::
veùÜ
<
Heuri¡ic
::
OÃPoŞ
> 
ResuÉPoŞs
;

1041 
CurHeuri¡ic
->
	`AssignToPoŞs
(
NodesToPA
, 0, 
GG
, 
ResuÉPoŞs
);

1043 
BasicBlock
::
™”©Ü
 
In£¹Pt
 = 
Glob®PoŞCtÜ
->
	`g‘EÁryBlock
().
	`begš
();

1050 
¡d
::
£t
<cÚ¡ 
DSNode
 *> 
	`Glob®H—pNodes
 (
NodesToPA
.
	`begš
(), NodesToPA.
	`’d
());

1053 
i
 = 0, 
e
 = 
ResuÉPoŞs
.
	`size
(); i !=ƒ; ++i) {

1054 
Heuri¡ic
::
OÃPoŞ
 &
PoŞ
 = 
ResuÉPoŞs
[
i
];

1055 
V®ue
 *
PoŞDesc
 = 
PoŞ
.PoolDesc;

1056 ià(
PoŞDesc
 == 0) {

1057 
PoŞDesc
 = 
	`C»©eGlob®PoŞ
(
PoŞ
.
PoŞSize
, PoŞ.
PoŞAlignm’t
, "Glob®PoŞ", 
In£¹Pt
);

1059 ià(
PoŞ
.
NodesInPoŞ
.
	`size
() == 1 &&

1060 !
PoŞ
.
NodesInPoŞ
[0]->
	`isNodeCom¶‘–yFŞded
())

1061 ++
NumTSPoŞs
;

1063 
N
 = 0, 
e
 = 
PoŞ
.
NodesInPoŞ
.
	`size
(); N !=ƒ; ++N) {

1064 
Glob®Nodes
[
PoŞ
.
NodesInPoŞ
[
N
]] = 
PoŞDesc
;

1065 
Glob®H—pNodes
.
	`”a£
(
PoŞ
.
NodesInPoŞ
[
N
]);

1070 
¡d
::
£t
<cÚ¡ 
DSNode
*>::
™”©Ü
 
I
 = 
Glob®H—pNodes
.
	`begš
(),

1071 
E
 = 
Glob®H—pNodes
.
	`’d
(); 
I
 != E; ++I) {

1072 
Glob®Nodes
[*
I
] = 
CÚ¡ªtPoš‹rNuÎ
::
	`g‘
(
Poš‹rTy³
::
	`g‘Unqu®
(
PoŞDescTy³
));

1073 ++
NumNÚ´of™
;

1076  
çl£
;

1077 
	}
}

1082 
Glob®V¬ŸbË
 *
	gPoŞAÎoÿ‹
::
C»©eGlob®PoŞ
(
RecSize
, 
Align
,

1083 
¡d
::
¡ršg
 
Çme
, 
In¡ruùiÚ
 *
IPHšt
) {

1084 
Glob®V¬ŸbË
 *
	gGV
 =

1085 
Ãw
 
Glob®V¬ŸbË
(*
CurModuË
,

1086 
PoŞDescTy³
, 
çl£
, 
Glob®V®ue
::
IÁ”ÇlLškage
,

1087 
CÚ¡ªtAgg»g©eZ”o
::
g‘
(
PoŞDescTy³
), 
Çme
);

1090 
DSNode
 *
	gGNode
 = 
G¿phs
->
g‘Glob®sG¿ph
()->
addObjeùToG¿ph
(
GV
);

1091 
	gGNode
->
£tModif›dM¬k”
()->
£tR—dM¬k”
();

1093 
	gBasicBlock
::
™”©Ü
 
In£¹Pt
;

1094 ià(
	gIPHšt
)

1095 
	gIn£¹Pt
 = 
IPHšt
;

1097 
	gIn£¹Pt
 = 
Glob®PoŞCtÜ
->
g‘EÁryBlock
().
begš
();

1098 
	gi§
<
	gAÎoÿIn¡
>(
	gIn£¹Pt
)) ++InsertPt;

1101 
V®ue
 *
	gElSize
 = 
CÚ¡ªtIÁ
::
g‘
(
IÁ32Ty³
, 
RecSize
);

1102 
V®ue
 *
	gAlignV
 = 
CÚ¡ªtIÁ
::
g‘
(
IÁ32Ty³
, 
Align
);

1103 
V®ue
* 
	gO±s
[3] = {
GV
, 
ElSize
, 
AlignV
};

1104 
	gC®lIn¡
::
C»©e
(
PoŞIn™
, 
O±s
, "", 
In£¹Pt
);

1105 ++
	gNumPoŞs
;

1106  
	gGV
;

1118 
	gPoŞAÎoÿ‹
::
C»©ePoŞs
 (
FunùiÚ
 &
F
, 
DSG¿ph
* 
DSG
,

1119 cÚ¡ 
¡d
::
veùÜ
<cÚ¡ 
DSNode
*> &
NodesToPA
,

1120 
¡d
::
m­
<cÚ¡ 
DSNode
*, 
V®ue
*> &
PoŞDesütÜs
) {

1124 ià(
	gNodesToPA
.
em±y
()) ;

1126 
	g¡d
::
veùÜ
<
Heuri¡ic
::
OÃPoŞ
> 
ResuÉPoŞs
;

1127 
	gCurHeuri¡ic
->
AssignToPoŞs
(
NodesToPA
, &
F
, NodesToPA[0]->
g‘P¬’tG¿ph
(),

1128 
ResuÉPoŞs
);

1130 
	g¡d
::
£t
<cÚ¡ 
DSNode
*> 
UÇÎoÿ‹dNodes
(
NodesToPA
.
begš
(), NodesToPA.
’d
());

1132 
	gBasicBlock
::
™”©Ü
 
In£¹Pošt
 = 
F
.
äÚt
().
begš
();

1136 
boŞ
 
	gIsMaš
 = 
F
.
g‘Name
().
¡r
(è=ğ"maš" && F.
hasEx‹º®Lškage
();

1142 
	gi
 = 0, 
	ge
 = 
ResuÉPoŞs
.
size
(); i !ğ
e
; ++i) {

1143 
	gHeuri¡ic
::
OÃPoŞ
 &
PoŞ
 = 
ResuÉPoŞs
[
i
];

1144 
V®ue
 *
	gPoŞDesc
 = 
PoŞ
.
PoŞDesc
;

1145 ià(
	gPoŞDesc
 == 0) {

1150 ià(!
IsMaš
) {

1151 
PoŞDesc
 = 
Ãw
 
AÎoÿIn¡
(
PoŞDescTy³
, 0, "PD", 
In£¹Pošt
);

1162 
DSNode
 *
	gNewNode
 = 
DSG
->
addObjeùToG¿ph
(
PoŞDesc
);

1163 
	gNewNode
->
£tModif›dM¬k”
()->
£tR—dM¬k”
();

1166 
	gPoŞDesc
 = 
C»©eGlob®PoŞ
(
PoŞ
.
PoŞSize
, PoŞ.
PoŞAlignm’t
,

1167 "PoŞFÜMaš", 
In£¹Pošt
);

1170 
DSNode
 *
	gNewNode
 = 
DSG
->
addObjeùToG¿ph
(
PoŞDesc
);

1171 
	gNewNode
->
£tModif›dM¬k”
()->
£tR—dM¬k”
();

1173 ià(
	gPoŞ
.
	gNodesInPoŞ
.
size
() == 1 &&

1174 !
PoŞ
.
NodesInPoŞ
[0]->
isNodeCom¶‘–yFŞded
())

1175 ++
NumTSPoŞs
;

1185 
	gN
 = 0, 
	ge
 = 
PoŞ
.
NodesInPoŞ
.
size
(); N !ğ
e
; ++N) {

1186 
	gPoŞDesütÜs
[
PoŞ
.
NodesInPoŞ
[
N
]] = 
PoŞDesc
;

1187 
	gUÇÎoÿ‹dNodes
.
”a£
(
PoŞ
.
NodesInPoŞ
[
N
]);

1194 
	g¡d
::
£t
<cÚ¡ 
DSNode
*>::
™”©Ü
 
I
 = 
UÇÎoÿ‹dNodes
.
begš
(),

1195 
	gE
 = 
UÇÎoÿ‹dNodes
.
’d
(); 
	gI
 !ğ
E
; ++I) {

1196 
	gPoŞDesütÜs
[*
I
] = 
CÚ¡ªtPoš‹rNuÎ
::
g‘
(
Poš‹rTy³
::
g‘Unqu®
(
PoŞDescTy³
));

1197 ++
	gNumNÚ´of™
;

1209 
	gPoŞAÎoÿ‹
::
	$ProûssFunùiÚBody
(
FunùiÚ
 &
F
, FunùiÚ &
NewF
) {

1214 
DSG¿ph
* 
G
 = 
G¿phs
->
	`g‘DSG¿ph
(
F
);

1215 
FuncInfo
 & 
FI
 = *
	`g‘FuncInfo
(
F
);

1220 
DSG¿ph
::
NodeM­Ty
 
Glob®sG¿phNodeM­pšg
;

1221 
G
->
	`compu‹GToGGM­pšg
(
Glob®sG¿phNodeM­pšg
);

1227 
DSG¿ph
::
node_™”©Ü
 
I
 = 
G
->
	`node_begš
(), 
E
 = G->
	`node_’d
();

1228 
I
 !ğ
E
;

1229 ++
I
){

1231 
DSNode
 * 
N
 = 
I
;

1235 ià(
Glob®Nodes
[
N
]) {

1236 
FI
.
PoŞDesütÜs
[
N
] = 
Glob®Nodes
[N];

1241 
DSNode
 * 
GGN
 = 
Glob®sG¿phNodeM­pšg
[
N
].
	`g‘Node
();

1242 ià(
GGN
 && 
Glob®Nodes
[GGN]) {

1243 
FI
.
PoŞDesütÜs
[
N
] = 
Glob®Nodes
[
GGN
];

1250 
¡d
::
veùÜ
<cÚ¡ 
DSNode
 *> 
LoÿlNodes
;

1251 
CurHeuri¡ic
->
	`g‘LoÿlPoŞNodes
 (
F
, 
LoÿlNodes
);

1257 
šdex
 = 0; index < 
LoÿlNodes
.
	`size
(); ++index) {

1258 ià(
FI
.
M¬kedNodes
.
	`couÁ
 (
LoÿlNodes
[
šdex
]) == 0) {

1259 
FI
.
NodesToPA
.
	`push_back
 (
LoÿlNodes
[
šdex
]);

1266 ià(!
FI
.
NodesToPA
.
	`em±y
()) {

1267 
	`”rs
(è<< "[" << 
F
.
	`g‘Name
().
	`¡r
(è<< "] " << 
FI
.
NodesToPA
.
	`size
()

1269 
	`C»©ePoŞs
(
NewF
, 
G
, 
FI
.
NodesToPA
, FI.
PoŞDesütÜs
);

1271 
	`DEBUG
(
	`”rs
(è<< "[" << 
F
.
	`g‘Name
().
	`¡r
() << "]ransforming body.\n");

1276 
¡d
::
muÉim­
<
AÎoÿIn¡
*, 
In¡ruùiÚ
*> 
PoŞU£s
;

1277 
¡d
::
muÉim­
<
AÎoÿIn¡
*, 
C®lIn¡
*> 
PoŞF»es
;

1278 
	`T¿nsfÜmBody
(
G
, 
FI
, 
PoŞU£s
, 
PoŞF»es
, 
NewF
);

1281 ià(!
FI
.
NodesToPA
.
	`em±y
())

1282 
	`In™ŸlizeAndDe¡royPoŞs
(
NewF
, 
FI
.
NodesToPA
, FI.
PoŞDesütÜs
,

1283 
PoŞU£s
, 
PoŞF»es
);

1289 
CurHeuri¡ic
->
	`HackFunùiÚBody
(
NewF
, 
FI
.
PoŞDesütÜs
);

1290 
	}
}

1292 
	g‹m¶©e
<
şass
 
	gI‹¿tÜTy
>

1293 
AÎOrNÚeInS‘
(
I‹¿tÜTy
 
S
, I‹¿tÜTy 
E
,

1294 
¡d
::
£t
<
BasicBlock
*> &
Blocks
, 
boŞ
 &
AÎIn
,

1295 
boŞ
 &
NÚeIn
) {

1296 
	gAÎIn
 = 
Œue
;

1297 
	gNÚeIn
 = 
Œue
;

1298 ; 
	gS
 !ğ
E
; ++S)

1299 ià(
	gBlocks
.
couÁ
(*
S
))

1300 
	gNÚeIn
 = 
çl£
;

1302 
	gAÎIn
 = 
çl£
;

1305 
D–‘eIfIsPoŞF»e
(
In¡ruùiÚ
 *
I
, 
AÎoÿIn¡
 *
PD
,

1306 
¡d
::
muÉim­
<
AÎoÿIn¡
*, 
C®lIn¡
*> &
PoŞF»es
) {

1307 
	g¡d
::
muÉim­
<
AÎoÿIn¡
*, 
	gC®lIn¡
*>::
™”©Ü
 
PFI
, 
	gPFE
;

1308 ià(
	gdyn_ÿ¡
<
	gC®lIn¡
>(
	gI
))

1309 
t›
(
PFI
,
PFE
èğ
PoŞF»es
.
equ®_¿nge
(
PD
); 
	gPFI
 != PFE; ++PFI)

1310 ià(
	gPFI
->
	g£cÚd
 =ğ
I
) {

1311 
PoŞF»es
.
”a£
(
PFI
);

1312 
	gI
->
”a£FromP¬’t
();

1313 ++
	gNumPoŞF»e
;

1318 
	gPoŞAÎoÿ‹
::
C®cuÏ‹LivePoŞF»eBlocks
(
¡d
::
£t
<
BasicBlock
*>&
LiveBlocks
,

1319 
V®ue
 *
PD
) {

1320 
	gV®ue
::
u£_™”©Ü
 
I
 = 
PD
->
u£_begš
(), 
	gE
 = PD->
u£_’d
(); 
	gI
 !ğ
E
; ++I){

1327 ià(
In¡ruùiÚ
 * 
	gIn¡
 = 
dyn_ÿ¡
<In¡ruùiÚ>(*
I
)) {

1328 ià(!
i§
<
C®lIn¡
>(*
I
)) {

1331 
idf_ext_™”©Ü
<
BasicBlock
*, 
¡d
::
£t
<BasicBlock*> >

1332 
DI
 = 
idf_ext_begš
(
In¡
->
g‘P¬’t
(), 
LiveBlocks
),

1333 
	gDE
 = 
idf_ext_’d
(
In¡
->
g‘P¬’t
(), 
LiveBlocks
);

1334 
	gDI
 !ğ
DE
; ++DI)

1340 
C®lS™e
 
	gU
 = C®lS™e(
I
->
¡rPoš‹rCa¡s
());

1341 ià(
	gU
.
g‘C®ËdV®ue
(è!ğ
PoŞF»e
 && 
U
.g‘C®ËdV®ue(è!ğ
PoŞDe¡roy
) {

1344 
idf_ext_™”©Ü
<
BasicBlock
*, 
¡d
::
£t
<BasicBlock*> >

1345 
DI
 = 
idf_ext_begš
(
U
.
g‘In¡ruùiÚ
()->
g‘P¬’t
(), 
LiveBlocks
),

1346 
	gDE
 = 
idf_ext_’d
(
U
.
g‘In¡ruùiÚ
()->
g‘P¬’t
(), 
LiveBlocks
);

1347 
	gDI
 !ğ
DE
; ++DI)

1356 
	gPoŞAÎoÿ‹
::
In™ŸlizeAndDe¡royPoŞ
(
FunùiÚ
 &
F
, cÚ¡ 
DSNode
 *
Node
,

1357 
¡d
::
m­
<cÚ¡ 
DSNode
*, 
V®ue
*> &
PoŞDesütÜs
,

1358 
¡d
::
muÉim­
<
AÎoÿIn¡
*, 
In¡ruùiÚ
*> &
PoŞU£s
,

1359 
¡d
::
muÉim­
<
AÎoÿIn¡
*, 
C®lIn¡
*> &
PoŞF»es
) {

1360 
AÎoÿIn¡
 *
	gPD
 = 
ÿ¡
<AÎoÿIn¡>(
PoŞDesütÜs
[
Node
]);

1364 
	g¡d
::
£t
<
BasicBlock
*> 
UsšgBlocks
;

1366 
	g¡d
::
muÉim­
<
AÎoÿIn¡
*, 
	gIn¡ruùiÚ
*>::
™”©Ü
 
PUI
, 
	gPUE
;

1367 
t›
(
PUI
, 
PUE
èğ
PoŞU£s
.
equ®_¿nge
(
PD
);

1368 ; 
	gPUI
 !ğ
PUE
; ++PUI)

1369 
	gUsšgBlocks
.
š£¹
(
PUI
->
£cÚd
->
g‘P¬’t
());

1374 
	g¡d
::
£t
<
BasicBlock
*> 
In™ŸlizedBefÜe
;

1375 
	g¡d
::
£t
<
BasicBlock
*> 
De¡royedAá”
;

1376 
	g¡d
::
£t
<
BasicBlock
*>::
™”©Ü
 
I
 = 
UsšgBlocks
.
begš
(),

1377 
	gE
 = 
UsšgBlocks
.
’d
(); 
	gI
 !ğ
E
; ++I) {

1378 
	gdf_ext_™”©Ü
<
	gBasicBlock
*, 
	g¡d
::
£t
<
BasicBlock
*> >

1379 
DI
 = 
df_ext_begš
(*
I
, 
In™ŸlizedBefÜe
),

1380 
	gDE
 = 
df_ext_’d
(*
I
, 
In™ŸlizedBefÜe
); 
	gDI
 !ğ
DE
; ++DI)

1383 
	gidf_ext_™”©Ü
<
	gBasicBlock
*, 
	g¡d
::
£t
<
BasicBlock
*> >

1384 
DI
 = 
idf_ext_begš
(*
I
, 
De¡royedAá”
),

1385 
	gDE
 = 
idf_ext_’d
(*
I
, 
De¡royedAá”
); 
	gDI
 !ğ
DE
; ++DI)

1389 
	g¡d
::
£t
<
BasicBlock
*> 
LiveBlocks
;

1390 
	g¡d
::
£t_š‹r£ùiÚ
(
In™ŸlizedBefÜe
.
begš
(),In™ŸlizedBefÜe.
’d
(),

1391 
De¡royedAá”
.
begš
(), De¡royedAá”.
’d
(),

1392 
¡d
::
š£¹”
(
LiveBlocks
, LiveBlocks.
’d
()));

1393 
	gIn™ŸlizedBefÜe
.
ş—r
();

1394 
	gDe¡royedAá”
.
ş—r
();

1396 
DEBUG
(
”rs
(è<< "POOL: " << 
PD
->
g‘Name
().
¡r
() << " information:\n");

1397 
DEBUG
(
”rs
() << " Live in blocks: ");

1398 
DEBUG
(
¡d
::
£t
<
BasicBlock
*>::
™”©Ü
 
I
 = 
LiveBlocks
.
begš
(),

1399 
E
 = 
LiveBlocks
.
’d
(); 
I
 != E; ++I)

1400 
”rs
(è<< (*
I
)->
g‘Name
().
¡r
() << " ");

1401 
DEBUG
(
”rs
() << "\n");

1404 
	g¡d
::
veùÜ
<
In¡ruùiÚ
*> 
PoŞIn™Pošts
;

1405 
	g¡d
::
veùÜ
<
In¡ruùiÚ
*> 
PoŞDe¡royPošts
;

1407 ià(
	gDi§bËIn™De¡royO±
) {

1409 
In¡ruùiÚ
 *
	gIn£¹Pošt
;

1410 
	gBasicBlock
::
™”©Ü
 
I
 = 
F
.
äÚt
().
begš
();

1411 
	gi§
<
	gAÎoÿIn¡
>(
	gIn£¹Pošt
 = 
I
); ++
	gI
)

1413 
	gPoŞIn™Pošts
.
push_back
(
In£¹Pošt
);

1415 ià(
	gF
.
g‘Name
().
¡r
() != "main")

1416 
FunùiÚ
::
™”©Ü
 
BB
 = 
F
.
begš
(), 
	gE
 = F.
’d
(); 
	gBB
 !ğ
E
; ++BB)

1417 ià(
	gi§
<
	gR‘uºIn¡
>(
	gBB
->
g‘T”mš©Ü
()) ||

1418 
	gi§
<
	gUnwšdIn¡
>(
	gBB
->
g‘T”mš©Ü
()))

1419 
	gPoŞDe¡royPošts
.
push_back
(
BB
->
g‘T”mš©Ü
());

1422 
	g¡d
::
£t
<
BasicBlock
*> 
PoŞIn™In£¹edBlocks
, 
	gPoŞDe¡royIn£¹edBlocks
;

1424 
	g¡d
::
£t
<
BasicBlock
*>::
™”©Ü
 
I
 = 
LiveBlocks
.
begš
(),

1425 
	gE
 = 
LiveBlocks
.
’d
(); 
	gI
 !ğ
E
; ++I) {

1426 
BasicBlock
 *
	gBB
 = *
I
;

1427 
T”mš©ÜIn¡
 *
	gT”m
 = 
BB
->
g‘T”mš©Ü
();

1431 
boŞ
 
	gAÎIn
, 
	gNÚeIn
;

1432 
AÎOrNÚeInS‘
(
´ed_begš
(
BB
), 
´ed_’d
(BB), 
LiveBlocks
, 
AÎIn
,

1433 
NÚeIn
);

1435 ià(
	gNÚeIn
) {

1436 ià(!
	gPoŞIn™In£¹edBlocks
.
couÁ
(
BB
)) {

1437 
	gBasicBlock
::
™”©Ü
 
It
 = 
BB
->
begš
();

1438 
	gi§
<
	gAÎoÿIn¡
>(
	gIt
è|| i§<
	gPHINode
>(It)) ++It;

1441 !
	gPoŞU£s
.
couÁ
(
¡d
::
make_·œ
(
PD
, 
It
)))

1444 
D–‘eIfIsPoŞF»e
(
It
++, 
PD
, 
PoŞF»es
);

1446 
	gPoŞIn™Pošts
.
push_back
(
It
);

1447 
	gPoŞIn™In£¹edBlocks
.
š£¹
(
BB
);

1449 } ià(!
	gAÎIn
) {

1450 
	gTryAgašP»d
:

1451 
´ed_™”©Ü
 
PI
 = 
´ed_begš
(
BB
), 
	gE
 = 
´ed_’d
(BB); 
	gPI
 !ğ
E
;

1452 ++
	gPI
)

1453 ià(!
	gLiveBlocks
.
couÁ
(*
PI
è&& !
	gPoŞIn™In£¹edBlocks
.count(*PI)){

1454 ià(
S¶™Cr™iÿlEdge
(
BB
, 
PI
))

1456 
	gTryAgašP»d
;

1459 
	gPoŞIn™Pošts
.
push_back
((*
PI
)->
g‘T”mš©Ü
());

1460 
	gPoŞIn™In£¹edBlocks
.
š£¹
(*
PI
);

1466 
AÎOrNÚeInS‘
(
succ_begš
(
BB
), 
succ_’d
(BB), 
LiveBlocks
,

1467 
AÎIn
, 
NÚeIn
);

1469 ià(
	gNÚeIn
) {

1471 ià(!
	gPoŞDe¡royIn£¹edBlocks
.
couÁ
(
BB
)) {

1472 
	gBasicBlock
::
™”©Ü
 
It
 = 
T”m
;

1476 !
	gPoŞU£s
.
couÁ
(
¡d
::
make_·œ
(
PD
, 
It
)))

1477 
D–‘eIfIsPoŞF»e
(
It
--, 
PD
, 
PoŞF»es
);

1478 ++
	gIt
;

1482 
	gPoŞDe¡royPošts
.
push_back
(
It
);

1483 
	gPoŞDe¡royIn£¹edBlocks
.
š£¹
(
BB
);

1485 } ià(!
	gAÎIn
) {

1486 
succ_™”©Ü
 
	gSI
 = 
succ_begš
(
BB
), 
	gE
 = 
succ_’d
(BB);

1487 
	gSI
 !ğ
E
; ++SI)

1488 ià(!
	gLiveBlocks
.
couÁ
(*
SI
) &&

1489 !
	gPoŞDe¡royIn£¹edBlocks
.
couÁ
(*
SI
)) {

1491 
S¶™Cr™iÿlEdge
(
BB
, 
SI
);

1494 
	gBasicBlock
::
™”©Ü
 
It
 = (*
SI
)->
begš
();

1495 
	gi§
<
	gPHINode
>(
	gIt
)) ++It;

1496 
	gPoŞDe¡royPošts
.
push_back
(
It
);

1497 
	gPoŞDe¡royIn£¹edBlocks
.
š£¹
(*
SI
);

1503 
DEBUG
(
”rs
() << " Init in blocks: ");

1506 
	gElSizeV
 = 
Heuri¡ic
::
g‘Recomm’dedSize
(
Node
);

1507 
V®ue
 *
	gElSize
 = 
CÚ¡ªtIÁ
::
g‘
(
IÁ32Ty³
, 
ElSizeV
);

1508 
	gAlignV
 = 
Heuri¡ic
::
g‘Recomm’dedAlignm’t
(
Node
);

1509 
V®ue
 *
	gAlign
 = 
CÚ¡ªtIÁ
::
g‘
(
IÁ32Ty³
, 
AlignV
);

1511 
	gi
 = 0, 
	ge
 = 
PoŞIn™Pošts
.
size
(); i !ğ
e
; ++i) {

1512 
V®ue
* 
	gO±s
[3] = {
PD
, 
ElSize
, 
Align
};

1513 
	gC®lIn¡
::
C»©e
(
PoŞIn™
, 
O±s
, "", 
PoŞIn™Pošts
[
i
]);

1514 
DEBUG
(
”rs
(è<< 
PoŞIn™Pošts
[
i
]->
g‘P¬’t
()->
g‘Name
().
¡r
() << " ");

1517 
DEBUG
(
”rs
() << "\n Destroy in blocks: ");

1520 
	gi
 = 0, 
	ge
 = 
PoŞDe¡royPošts
.
size
(); i !ğ
e
; ++i) {

1522 
	gC®lIn¡
::
C»©e
(
PoŞDe¡roy
, 
PD
, "", 
PoŞDe¡royPošts
[
i
]);

1523 
DEBUG
(
”rs
(è<< 
PoŞDe¡royPošts
[
i
]->
g‘P¬’t
()->
g‘Name
().
¡r
()<<" ");

1525 
DEBUG
(
”rs
() << "\n\n");

1530 
	g¡d
::
£t
<
BasicBlock
*> 
PoŞF»eLiveBlocks
;

1531 ià(!
	gDi§bËPoŞF»eO±
)

1532 
C®cuÏ‹LivePoŞF»eBlocks
(
PoŞF»eLiveBlocks
, 
PD
);

1534 
	gPoŞF»eLiveBlocks
 = 
LiveBlocks
;

1537 
	g¡d
::
muÉim­
<
AÎoÿIn¡
*, 
	gC®lIn¡
*>::
™”©Ü
 
PFI
, 
	gPFE
;

1538 
t›
(
PFI
,
PFE
èğ
PoŞF»es
.
equ®_¿nge
(
PD
); 
	gPFI
 != PFE; ) {

1539 
C®lIn¡
 *
	gPoŞF»e
 = (
PFI
++)->
£cÚd
;

1540 ià(!
	gLiveBlocks
.
couÁ
(
PoŞF»e
->
g‘P¬’t
()) ||

1541 !
	gPoŞF»eLiveBlocks
.
couÁ
(
PoŞF»e
->
g‘P¬’t
()))

1542 
D–‘eIfIsPoŞF»e
(
PoŞF»e
, 
PD
, 
PoŞF»es
);

1550 
	gPoŞAÎoÿ‹
::
In™ŸlizeAndDe¡royPoŞs
(
FunùiÚ
 &
F
,

1551 cÚ¡ 
¡d
::
veùÜ
<cÚ¡ 
DSNode
*> &
NodesToPA
,

1552 
¡d
::
m­
<cÚ¡ 
DSNode
*, 
V®ue
*> &
PoŞDesütÜs
,

1553 
¡d
::
muÉim­
<
AÎoÿIn¡
*, 
In¡ruùiÚ
*> &
PoŞU£s
,

1554 
¡d
::
muÉim­
<
AÎoÿIn¡
*, 
C®lIn¡
*> &
PoŞF»es
) {

1555 
	g¡d
::
£t
<
AÎoÿIn¡
*> 
AÎoÿsHªdËd
;

1558 
	gi
 = 0, 
	ge
 = 
NodesToPA
.
size
(); i !ğ
e
; ++i) {

1559 cÚ¡ 
DSNode
 *
	gNode
 = 
NodesToPA
[
i
];

1561 ià(
	gi§
<
	gGlob®V¬ŸbË
>(
	gPoŞDesütÜs
[
Node
]) ||

1562 
	gi§
<
	gCÚ¡ªtPoš‹rNuÎ
>(
	gPoŞDesütÜs
[
Node
]))

1565 
as£¹
(
i§
<
AÎoÿIn¡
>(
PoŞDesütÜs
[
Node
]) && "Why…ool‡llocatehis?");

1566 
AÎoÿIn¡
 *
	gPD
 = 
ÿ¡
<AÎoÿIn¡>(
PoŞDesütÜs
[
Node
]);

1573 ià(!
	gPoŞU£s
.
couÁ
(
PD
è&& !
	gPoŞF»es
.count(PD)) ;

1574 ià(!
	gAÎoÿsHªdËd
.
š£¹
(
PD
).
	g£cÚd
) ;

1576 ++
	gNumPoŞs
;

1577 ià(!
	gNode
->
isNodeCom¶‘–yFŞded
())

1578 ++
	gNumTSPoŞs
;

1580 
In™ŸlizeAndDe¡royPoŞ
(
F
, 
Node
, 
PoŞDesütÜs
, 
PoŞU£s
, 
PoŞF»es
);

1599 
	gPoŞAÎoÿ‹
::
	$g‘NumIn™ŸlPoŞArgum’ts
(
SŒšgRef
 
FuncName
) {

1600 cÚ¡ 
EÁryCouÁ
 =

1601 (
RuÁimeCheckEÁr›s
) / (RuntimeCheckEntries[0]);

1603 
Index
 = 0; Index < 
EÁryCouÁ
; ++Index) {

1605 ià(
RuÁimeCheckEÁr›s
[
Index
].
FunùiÚ
 =ğ
FuncName
)

1606  
RuÁimeCheckEÁr›s
[
Index
].
PoŞArgc
;

1608 ià(
RuÁimeCheckEÁr›s
[
Index
].
CheckKšd
 =ğ
CStdLibCheck
) {

1610 
¡d
::
¡ršg
 
DebugName
 =

1611 
RuÁimeCheckEÁr›s
[
Index
].
FunùiÚ
 + 
¡d
::
	`¡ršg
("_debug");

1613 ià(
DebugName
 =ğ
FuncName
)

1614  
RuÁimeCheckEÁr›s
[
Index
].
PoŞArgc
;

1619 
	}
}

	@PoolOptimize.cpp

14 
	~"Îvm/CÚ¡ªts.h
"

15 
	~"Îvm/D”ivedTy³s.h
"

16 
	~"Îvm/In¡ruùiÚs.h
"

17 
	~"Îvm/Pass.h
"

18 
	~"Îvm/ModuË.h
"

19 
	~"Îvm/ADT/Sti¡ic.h
"

20 
	~"Îvm/SuµÜt/Debug.h
"

21 
	~<£t
>

22 
usšg
 
Çme¥aû
 
	gÎvm
;

24 
Ty³
 * 
	gVoidTy³
 = 0;

25 
Ty³
 * 
	gIÁ8Ty³
 = 0;

26 
Ty³
 * 
	gIÁ32Ty³
 = 0;

28 
	gÇme¥aû
 {

29 
STATISTIC
 (
NumBumpPŒ
, "Number of bump…ointer…ools");

31 
	gPoŞO±imize
 : 
public
 
ModuËPass
 {

32 
ID
;

33 
boŞ
 
	gSAFECodeEÇbËd
;

35 
PoŞO±imize
(
boŞ
 
SAFECode
 = 
Œue
è: 
ModuËPass
(
ID
) {

36 
SAFECodeEÇbËd
 = 
SAFECode
;

38 
boŞ
 
runOnModuË
(
ModuË
 &
M
);

41 
	gPoŞO±imize
::
ID
 = 0;

42 
	gRegi¡”Pass
<
	gPoŞO±imize
>

43 
X
("pooloptimize", "Optimize‡…ool‡llocated…rogram");

46 
g‘C®lsOf
(
CÚ¡ªt
 *
C
, 
¡d
::
veùÜ
<
C®lIn¡
*> &
C®ls
) {

48 
FunùiÚ
 * 
F
;

49 
CÚ¡ªtEx´
 * 
	gCE
;

50 ià(!(
	gF
=
dyn_ÿ¡
<
FunùiÚ
>(
C
))) {

51 ià((
CE
 = 
dyn_ÿ¡
<
CÚ¡ªtEx´
>(
C
)è&& (CE->
isCa¡
()))

52 
F
 = 
dyn_ÿ¡
<
FunùiÚ
>(
CE
->
g‘O³¿nd
(0));

54 
as£¹
 (0 && "Constant is‚ot‡ Function of ConstantExpr!");

56 
	gC®ls
.
ş—r
();

57 
	gV®ue
::
u£_™”©Ü
 
UI
 = 
F
->
u£_begš
(), 
	gE
 = F->
u£_’d
(); 
	gUI
 !ğ
E
; ++UI)

58 
	gC®ls
.
push_back
(
ÿ¡
<
C®lIn¡
>(*
UI
));

61 
boŞ
 
	gPoŞO±imize
::
	$runOnModuË
(
ModuË
 &
M
) {

65 
VoidTy³
 = 
Ty³
::
	`g‘VoidTy
(
M
.
	`g‘CÚ‹xt
());

66 
IÁ8Ty³
 = 
IÁeg”Ty³
::
	`g‘IÁ8Ty
(
M
.
	`g‘CÚ‹xt
());

67 
IÁ32Ty³
 = 
IÁeg”Ty³
::
	`g‘IÁ32Ty
(
M
.
	`g‘CÚ‹xt
());

72 
Ty³
 *
VoidPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
IÁ8Ty³
);

73 
Ty³
 *
PoŞDescPŒTy
;

74 ià(
SAFECodeEÇbËd
)

75 
PoŞDescPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
A¼ayTy³
::
	`g‘
(
VoidPŒTy
, 92));

77 
PoŞDescPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
A¼ayTy³
::
	`g‘
(
VoidPŒTy
, 16));

80 
CÚ¡ªt
 *
PoŞIn™
 = 
M
.
	`g‘OrIn£¹FunùiÚ
("poŞš™", 
VoidTy³
,

81 
PoŞDescPŒTy
, 
IÁ32Ty³
,

82 
IÁ32Ty³
, 
NULL
);

85 
CÚ¡ªt
 *
PoŞDe¡roy
 = 
M
.
	`g‘OrIn£¹FunùiÚ
("poŞde¡roy", 
VoidTy³
,

86 
PoŞDescPŒTy
, 
NULL
);

89 
CÚ¡ªt
 *
PoŞAÎoc
 = 
M
.
	`g‘OrIn£¹FunùiÚ
("poolalloc",

90 
VoidPŒTy
, 
PoŞDescPŒTy
,

91 
IÁ32Ty³
, 
NULL
);

94 
CÚ¡ªt
 *
PoŞR—Îoc
 = 
M
.
	`g‘OrIn£¹FunùiÚ
("poolrealloc",

95 
VoidPŒTy
, 
PoŞDescPŒTy
,

96 
VoidPŒTy
, 
IÁ32Ty³
, 
NULL
);

98 
CÚ¡ªt
 *
PoŞMemAlign
 = 
M
.
	`g‘OrIn£¹FunùiÚ
("poolmemalign",

99 
VoidPŒTy
, 
PoŞDescPŒTy
,

100 
IÁ32Ty³
, Int32Type,

101 
NULL
);

104 
CÚ¡ªt
 *
PoŞF»e
 = 
M
.
	`g‘OrIn£¹FunùiÚ
("poŞä“", 
VoidTy³
,

105 
PoŞDescPŒTy
, 
VoidPŒTy
, 
NULL
);

109 
CÚ¡ªt
 *
PoŞIn™BP
 = 
M
.
	`g‘OrIn£¹FunùiÚ
("poŞš™_bp", 
VoidTy³
,

110 
PoŞDescPŒTy
, 
IÁ32Ty³
,

111 
NULL
);

114 
CÚ¡ªt
 *
PoŞDe¡royBP
 = 
M
.
	`g‘OrIn£¹FunùiÚ
("poŞde¡roy_bp",
VoidTy³
,

115 
PoŞDescPŒTy
, 
NULL
);

118 
CÚ¡ªt
 *
PoŞAÎocBP
 = 
M
.
	`g‘OrIn£¹FunùiÚ
("poolalloc_bp",

119 
VoidPŒTy
, 
PoŞDescPŒTy
,

120 
IÁ32Ty³
, 
NULL
);

122 
CÚ¡ªt
 *
R—Îoc
 = 
M
.
	`g‘OrIn£¹FunùiÚ
("realloc",

123 
VoidPŒTy
, VoidPŒTy, 
IÁ32Ty³
,

124 
NULL
);

125 
CÚ¡ªt
 *
MemAlign
 = 
M
.
	`g‘OrIn£¹FunùiÚ
("memalign",

126 
VoidPŒTy
, 
IÁ32Ty³
,

127 
IÁ32Ty³
, 
NULL
);

131 
¡d
::
veùÜ
<
C®lIn¡
*> 
C®ls
;

132 
	`g‘C®lsOf
(
PoŞR—Îoc
, 
C®ls
);

133 
i
 = 0, 
e
 = 
C®ls
.
	`size
(); i !=ƒ; ++i) {

134 
C®lIn¡
 *
CI
 = 
C®ls
[
i
];

136 ià(
i§
<
CÚ¡ªtPoš‹rNuÎ
>(
CI
->
	`g‘O³¿nd
(2))) {

137 
V®ue
* 
O±s
[2] = {
CI
->
	`g‘O³¿nd
(1), CI->getOperand(3)};

138 
V®ue
 *
New
 = 
C®lIn¡
::
	`C»©e
(
PoŞAÎoc
, 
O±s
,

139 
CI
->
	`g‘Name
(), CI);

140 
CI
->
	`»¶aûAÎU£sW™h
(
New
);

141 
CI
->
	`”a£FromP¬’t
();

142 } ià(
i§
<
CÚ¡ªt
>(
CI
->
	`g‘O³¿nd
(3)) &&

143 
ÿ¡
<
CÚ¡ªt
>(
CI
->
	`g‘O³¿nd
(3))->
	`isNuÎV®ue
()) {

145 
V®ue
* 
O±s
[2] = {
CI
->
	`g‘O³¿nd
(1), CI->getOperand(2)};

146 
C®lIn¡
::
	`C»©e
(
PoŞF»e
, 
O±s
, "", 
CI
);

147 
Poš‹rTy³
 * 
PT
 = 
dyn_ÿ¡
<Poš‹rTy³>(
CI
->
	`g‘Ty³
());

148 
	`as£¹
 (
PT
 && "poolrealloc call does‚ot„eturn‡…ointer!\n");

149 
CI
->
	`»¶aûAÎU£sW™h
(
CÚ¡ªtPoš‹rNuÎ
::
	`g‘
(
PT
));

150 
CI
->
	`”a£FromP¬’t
();

151 } ià(
i§
<
CÚ¡ªtPoš‹rNuÎ
>(
CI
->
	`g‘O³¿nd
(1))) {

153 
V®ue
* 
O±s
[2] = {
CI
->
	`g‘O³¿nd
(2), CI->getOperand(3)};

154 
V®ue
 *
New
 = 
C®lIn¡
::
	`C»©e
(
R—Îoc
, 
O±s
,

155 
CI
->
	`g‘Name
(), CI);

156 
CI
->
	`»¶aûAÎU£sW™h
(
New
);

157 
CI
->
	`”a£FromP¬’t
();

162 
	`g‘C®lsOf
(
PoŞAÎoc
, 
C®ls
);

163 
i
 = 0, 
e
 = 
C®ls
.
	`size
(); i !=ƒ; ++i) {

164 
C®lIn¡
 *
CI
 = 
C®ls
[
i
];

166 ià(
i§
<
CÚ¡ªt
>(
CI
->
	`g‘O³¿nd
(1)) &&

167 
ÿ¡
<
CÚ¡ªt
>(
CI
->
	`g‘O³¿nd
(1))->
	`isNuÎV®ue
()) {

170 
V®ue
 *
New
 = 
Ãw
 
	`M®locIn¡
(
IÁ8Ty³
, 
CI
->
	`g‘O³¿nd
(2),

171 
CI
->
	`g‘Name
(), CI);

172 
CI
->
	`»¶aûAÎU£sW™h
(
New
);

173 
CI
->
	`”a£FromP¬’t
();

179 
	`g‘C®lsOf
(
PoŞMemAlign
, 
C®ls
);

180 
i
 = 0, 
e
 = 
C®ls
.
	`size
(); i !=ƒ; ++i) {

181 
C®lIn¡
 *
CI
 = 
C®ls
[
i
];

183 ià(
i§
<
CÚ¡ªtPoš‹rNuÎ
>(
CI
->
	`g‘O³¿nd
(1))) {

184 
V®ue
* 
O±s
[2] = {
CI
->
	`g‘O³¿nd
(2), CI->getOperand(3)};

185 
V®ue
 *
New
 = 
C®lIn¡
::
	`C»©e
(
MemAlign
, 
O±s
, 
CI
->
	`g‘Name
(), CI);

186 
CI
->
	`»¶aûAÎU£sW™h
(
New
);

187 
CI
->
	`”a£FromP¬’t
();

192 
	`g‘C®lsOf
(
PoŞF»e
, 
C®ls
);

193 
i
 = 0, 
e
 = 
C®ls
.
	`size
(); i !=ƒ; ++i) {

194 
C®lIn¡
 *
CI
 = 
C®ls
[
i
];

196 ià(
i§
<
CÚ¡ªtPoš‹rNuÎ
>(
CI
->
	`g‘O³¿nd
(2)))

197 
CI
->
	`”a£FromP¬’t
();

198 ià(
i§
<
CÚ¡ªtPoš‹rNuÎ
>(
CI
->
	`g‘O³¿nd
(1))) {

209 
	`g‘C®lsOf
(
PoŞIn™
, 
C®ls
);

210 
¡d
::
£t
<
V®ue
*> 
PoŞs
;

211 
i
 = 0, 
e
 = 
C®ls
.
	`size
(); i !=ƒ; ++i)

212 
PoŞs
.
	`š£¹
(
C®ls
[
i
]->
	`g‘O³¿nd
(1));

215 
¡d
::
£t
<
V®ue
*>::
™”©Ü
 
PI
 = 
PoŞs
.
	`begš
(), 
E
 = PoŞs.
	`’d
();

216 
PI
 !ğ
E
; ++PI) {

217 
boŞ
 
HasPoŞAÎoc
 = 
çl£
, 
HasOth”U£
 = false;

218 
V®ue
 *
PoŞDesc
 = *
PI
;

219 
V®ue
::
u£_™”©Ü
 
UI
 = 
PoŞDesc
->
	`u£_begš
(),

220 
E
 = 
PoŞDesc
->
	`u£_’d
(); 
UI
 != E; ++UI) {

221 ià(
C®lIn¡
 *
CI
 = 
dyn_ÿ¡
<C®lIn¡>(*
UI
)) {

222 ià(
CI
->
	`g‘C®ËdFunùiÚ
(è=ğ
PoŞIn™
 ||

223 
CI
->
	`g‘C®ËdFunùiÚ
(è=ğ
PoŞDe¡roy
) {

225 } ià(
CI
->
	`g‘C®ËdFunùiÚ
(è=ğ
PoŞAÎoc
) {

226 
HasPoŞAÎoc
 = 
Œue
;

228 
HasOth”U£
 = 
Œue
;

232 
HasOth”U£
 = 
Œue
;

238 ià(!
HasOth”U£
) {

240 ià(!
HasPoŞAÎoc
) {

241 !
PoŞDesc
->
	`u£_em±y
())

242 
ÿ¡
<
In¡ruùiÚ
>(
PoŞDesc
->
	`u£_back
())->
	`”a£FromP¬’t
();

243 ià(
AÎoÿIn¡
 *
AI
 = 
dyn_ÿ¡
<AÎoÿIn¡>(
PoŞDesc
))

244 
AI
->
	`”a£FromP¬’t
();

246 
ÿ¡
<
Glob®V¬ŸbË
>(
PoŞDesc
)->
	`”a£FromP¬’t
();

249 
¡d
::
veùÜ
<
U£r
*> 
	`PDU£rs
(
PoŞDesc
->
	`u£_begš
(), PoŞDesc->
	`u£_’d
());

251 !
PDU£rs
.
	`em±y
()) {

252 
C®lIn¡
 *
CI
 = 
ÿ¡
<C®lIn¡>(
PDU£rs
.
	`back
());

253 
PDU£rs
.
	`pİ_back
();

254 
¡d
::
veùÜ
<
V®ue
*> 
Args
;

255 ià(
CI
->
	`g‘C®ËdFunùiÚ
(è=ğ
PoŞAÎoc
) {

256 
Args
.
	`assign
(
CI
->
	`İ_begš
()+1, CI->
	`İ_’d
());

257 
V®ue
 *
New
 = 
C®lIn¡
::
	`C»©e
(
PoŞAÎocBP
, 
Args
, 
CI
->
	`g‘Name
(), CI);

258 
CI
->
	`»¶aûAÎU£sW™h
(
New
);

259 
CI
->
	`”a£FromP¬’t
();

260 } ià(
CI
->
	`g‘C®ËdFunùiÚ
(è=ğ
PoŞIn™
) {

261 
Args
.
	`assign
(
CI
->
	`İ_begš
()+1, CI->
	`İ_’d
());

262 
Args
.
	`”a£
(Args.
	`begš
()+1);

263 
C®lIn¡
::
	`C»©e
(
PoŞIn™BP
, 
Args
, "", 
CI
);

264 
CI
->
	`”a£FromP¬’t
();

266 
	`as£¹
(
CI
->
	`g‘C®ËdFunùiÚ
(è=ğ
PoŞDe¡roy
);

267 
Args
.
	`assign
(
CI
->
	`İ_begš
()+1, CI->
	`İ_’d
());

268 
C®lIn¡
::
	`C»©e
(
PoŞDe¡royBP
, 
Args
, "", 
CI
);

269 
CI
->
	`”a£FromP¬’t
();

272 ++
NumBumpPŒ
;

276  
Œue
;

277 
	}
}

	@RunTimeAssociate.cpp

16 
	#DEBUG_TYPE
 "·_assoc"

	)

18 
	~"d§/D©aSŒuùu».h
"

19 
	~"d§/DSG¿ph.h
"

20 
	~"poŞ®loc/RunTimeAssocŸ‹.h
"

21 
	~"Îvm/CÚ¡ªts.h
"

22 
	~"Îvm/D”ivedTy³s.h
"

23 
	~"Îvm/In¡ruùiÚs.h
"

24 
	~"Îvm/ModuË.h
"

25 
	~"Îvm/CÚ¡ªts.h
"

26 
	~"Îvm/A‰ribu‹s.h
"

27 
	~"Îvm/SuµÜt/CFG.h
"

28 
	~"Îvm/T¿nsfÜms/Uts/BasicBlockUts.h
"

29 
	~"Îvm/T¿nsfÜms/Uts/ClÚšg.h
"

30 
	~"Îvm/ADT/D•thFœ¡I‹¿tÜ.h
"

31 
	~"Îvm/ADT/Sti¡ic.h
"

32 
	~"Îvm/ADT/STLExŒas.h
"

33 
	~"Îvm/SuµÜt/CommªdLše.h
"

34 
	~"Îvm/SuµÜt/Debug.h
"

35 
	~"Îvm/SuµÜt/FÜm©‹dSŒ—m.h
"

37 
	~"d§/EÁryPoštAÇlysis.h
"

39 
usšg
 
Çme¥aû
 
	gÎvm
;

40 
usšg
 
Çme¥aû
 
	grPA
;

42 
	gRTAssocŸ‹
::
ID
 = 0;

44 
	gÇme¥aû
 {

45 
	gRegi¡”Pass
<
	gRTAssocŸ‹
>

46 
X
("rtassoc", "Memory handle‡ssociation");

48 
STATISTIC
(
NumArgsAdded
, "Number of function‡rguments‡dded");

49 
STATISTIC
(
MaxArgsAdded
, "Maximum function‡rguments‡ddedo one function");

50 
STATISTIC
(
NumClÚed
, "Number of functions cloned");

51 
STATISTIC
(
NumPoŞs
, "Number of…ools‡llocated");

58 
G‘NodesR—chabËFromGlob®s
(
DSG¿ph
* 
G
,

59 
D’£S‘
<cÚ¡ 
DSNode
*> &
NodesFromGlob®s
) {

60 
	gDSSÿÏrM­
::
glob®_™”©Ü
 
I
 = 
G
->
g‘SÿÏrM­
().
glob®_begš
(),

61 
	gE
 = 
G
->
g‘SÿÏrM­
().
glob®_’d
(); 
	gI
 !ğ
E
; ++I)

62 
	gG
->
g‘NodeFÜV®ue
(*
I
).
g‘Node
()->
m¬kR—chabËNodes
(
NodesFromGlob®s
);

65 
M¬kNodesWhichMu¡BePas£dIn
(
D’£S‘
<cÚ¡ 
DSNode
*> &
M¬kedNodes
,

66 
FunùiÚ
 &
F
, 
DSG¿ph
* 
G
,

67 
EÁryPoštAÇlysis
* 
EPA
) {

70 ià(!
	gEPA
->
isEÁryPošt
(&
F
)) {

71 
	gFunùiÚ
::
¬g_™”©Ü
 
I
 = 
F
.
¬g_begš
(), 
	gE
 = F.
¬g_’d
();

72 
	gI
 !ğ
E
; ++I) {

73 
	gDSG¿ph
::
SÿÏrM­Ty
::
™”©Ü
 
AI
 = 
G
->
g‘SÿÏrM­
().
fšd
(
I
);

74 ià(
	gAI
 !ğ
G
->
g‘SÿÏrM­
().
’d
())

75 ià(
DSNode
 * 
N
 = 
AI
->
£cÚd
.
g‘Node
())

76 
N
->
m¬kR—chabËNodes
(
M¬kedNodes
);

81 ià(
DSNode
 * 
	gR‘Node
 = 
G
->
g‘R‘uºNodeFÜ
(
F
).
g‘Node
())

82 
R‘Node
->
m¬kR—chabËNodes
(
M¬kedNodes
);

87 
	gD’£S‘
<cÚ¡ 
	gDSNode
*> 
	gNodesFromGlob®s
;

88 
G‘NodesR—chabËFromGlob®s
(
G
, 
NodesFromGlob®s
);

93 
	gD’£S‘
<cÚ¡ 
	gDSNode
*>::
™”©Ü
 
I
 = 
NodesFromGlob®s
.
begš
(),

94 
	gE
 = 
NodesFromGlob®s
.
’d
(); 
	gI
 !ğ
E
; ++I)

95 
	gM¬kedNodes
.
”a£
(*
I
);

102 
	$FšdFunùiÚPoŞArgs
(
FunùiÚ
 &
F
, 
FuncInfo
& 
FI
,

103 
EÁryPoštAÇlysis
* 
EPA
) {

104 
D’£S‘
<cÚ¡ 
DSNode
*> 
M¬kedNodes
;

106 ià(
FI
.
G
->
	`node_begš
(è=ğFI.G->
	`node_’d
())

112 
	`M¬kNodesWhichMu¡BePas£dIn
(
M¬kedNodes
, 
F
, 
FI
.
G
,
EPA
);

116 
D’£S‘
<cÚ¡ 
DSNode
*>::
™”©Ü
 
ii
 = 
M¬kedNodes
.
	`begš
(),

117 
“
 = 
M¬kedNodes
.
	`’d
(); 
ii
 !=ƒe; ++ii)

118 
FI
.
ArgNodes
.
	`š£¹
(FI.ArgNodes.
	`’d
(), *
ii
);

119 
	}
}

131 
FunùiÚ
* 
	gRTAssocŸ‹
::
	$MakeFunùiÚClÚe
(
FunùiÚ
 &
F
, 
FuncInfo
& 
FI
, 
DSG¿ph
* 
G
) {

132 ià(
G
->
	`node_begš
(è=ğG->
	`node_’d
())  0;

134 ià(
FI
.
ArgNodes
.
	`em±y
())

138 
NumArgsAdded
 +ğ
FI
.
ArgNodes
.
	`size
();

139 ià(
MaxArgsAdded
 < 
FI
.
ArgNodes
.
	`size
()) MaxArgsAdded = FI.ArgNodes.size();

140 ++
NumClÚed
;

144 
FunùiÚTy³
 *
OldFuncTy
 = 
F
.
	`g‘FunùiÚTy³
();

145 
¡d
::
veùÜ
<
Ty³
*> 
	`ArgTys
(
FI
.
ArgNodes
.
	`size
(), 
PoŞDescPŒTy
);

146 
ArgTys
.
	`»£rve
(
OldFuncTy
->
	`g‘NumP¬ams
(è+ 
FI
.
ArgNodes
.
	`size
());

148 
ArgTys
.
	`š£¹
(ArgTys.
	`’d
(), 
OldFuncTy
->
	`·¿m_begš
(), OldFuncTy->
	`·¿m_’d
());

151 
FunùiÚTy³
 *
FuncTy
 = FunùiÚTy³::
	`g‘
(
OldFuncTy
->
	`g‘R‘uºTy³
(), 
ArgTys
,

152 
OldFuncTy
->
	`isV¬Arg
());

154 
FunùiÚ
 *
New
 = FunùiÚ::
	`C»©e
(
FuncTy
, FunùiÚ::
IÁ”ÇlLškage
, 
F
.
	`g‘Name
());

155 
New
->
	`cİyA‰ribu‹sFrom
(&
F
);

156 
F
.
	`g‘P¬’t
()->
	`g‘FunùiÚLi¡
().
	`š£¹
(&F, 
New
);

160 
FunùiÚ
::
¬g_™”©Ü
 
NI
 = 
New
->
	`¬g_begš
();

161 
i
 = 0, 
e
 = 
FI
.
ArgNodes
.
	`size
(); i !ğe; ++i, ++
NI
) {

162 
FI
.
PoŞDesütÜs
[FI.
ArgNodes
[
i
]] = 
	`C»©eArgPoŞ
(FI.ArgNodes[i], 
NI
);

163 
NI
->
	`£tName
("PDa");

168 
V®ueToV®ueM­Ty
 
V®ueM­
;

169 
FunùiÚ
::
¬g_™”©Ü
 
I
 = 
F
.
	`¬g_begš
();

170 
NI
 !ğ
New
->
	`¬g_’d
(); ++
I
, ++NI) {

171 
V®ueM­
[
I
] = 
NI
;

172 
NI
->
	`£tName
(
I
->
	`g‘Name
());

176 
Sm®lVeùÜ
<
R‘uºIn¡
*,100> 
R‘uºs
;

178 
	`ClÚeFunùiÚIÁo
(
New
, &
F
, 
V®ueM­
, 
Œue
, 
R‘uºs
);

185 cÚ¡ 
A‰rLi¡PŒ
 
OldA‰rs
 = 
New
->
	`g‘A‰ribu‹s
();

186 ià(!
OldA‰rs
.
	`isEm±y
()) {

187 
A‰rLi¡PŒ
 
NewA‰rsVeùÜ
;

188 
šdex
 = 0; index < 
OldA‰rs
.
	`g‘NumSlÙs
(); ++index) {

189 cÚ¡ 
A‰ribu‹W™hIndex
 & 
PAWI
 = 
OldA‰rs
.
	`g‘SlÙ
(
šdex
);

190 
¬gIndex
 = 
PAWI
.
Index
;

194 ià(
¬gIndex
) ++argIndex;

197 
NewA‰rsVeùÜ
.
	`addA‰r
(
¬gIndex
, 
PAWI
.
A‰rs
);

201 
New
->
	`£tA‰ribu‹s
(
NewA‰rsVeùÜ
);

204 
V®ueToV®ueM­Ty
::
™”©Ü
 
I
 = 
V®ueM­
.
	`begš
(),

205 
E
 = 
V®ueM­
.
	`’d
(); 
I
 != E; ++I)

206 
FI
.
NewToOldV®ueM­
.
	`š£¹
(
¡d
::
	`make_·œ
(
I
->
£cÚd
, 
cÚ¡_ÿ¡
<
V®ue
*>(I->
fœ¡
)));

208  
FI
.
ClÚe
 = 
New
;

209 
	}
}

211 
	gRTAssocŸ‹
::
	$RTAssocŸ‹
()

212 : 
	$ModuËPass
(
ID
è{ 
	}
}

214 
RTAssocŸ‹
::
	$g‘AÇlysisU§ge
(
AÇlysisU§ge
 &
AU
) const {

215 
AU
.
addRequœedT¿ns™ive
<
Com¶‘eBUD©aSŒuùu»s
 > ();

216 
AU
.
addRequœed
<
EÁryPoštAÇlysis
> ();

217 
	}
}

219 
boŞ
 
	gRTAssocŸ‹
::
	$runOnModuË
(
ModuË
 &
M
) {

220 ià(
M
.
	`begš
(è=ğM.
	`’d
()è 
çl£
;

227 
D©aSŒuùu»s
* 
G¿phs
 = &
g‘AÇlysis
<
Com¶‘eBUD©aSŒuùu»s
 > ();

228 
EÁryPoštAÇlysis
* 
EPA
 = &
g‘AÇlysis
<EntryPointAnalysis > ();

231 
PoŞDescTy³
 = 
Ty³
::
	`g‘IÁ32Ty
(
M
.
	`g‘CÚ‹xt
());

232 
PoŞDescPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
PoŞDescTy³
);

237 
	`S‘upGlob®PoŞs
(&
M
, 
G¿phs
-> 
	`g‘Glob®sG¿ph
());

241 
ModuË
::
™”©Ü
 
I
 = 
M
.
	`begš
(), 
E
 = M.
	`’d
(); I != E; ++I)

242 ià(!
I
->
	`isDeş¬©iÚ
(è&& 
G¿phs
->
	`hasDSG¿ph
(*I)) {

243 
FuncInfo
 & 
FI
 = 
	`makeFuncInfo
(
I
, 
G¿phs
->
	`g‘DSG¿ph
(*I));

244 
	`FšdFunùiÚPoŞArgs
(*
I
, 
FI
, 
EPA
);

248 
¡d
::
m­
<
FunùiÚ
*, FunùiÚ*> 
FuncToClÚeM­
;

254 
¡d
::
£t
<
FunùiÚ
*> 
ClÚedFunùiÚs
;

255 
ModuË
::
™”©Ü
 
I
 = 
M
.
	`begš
(), 
E
 = M.
	`’d
(); I != E; ++I)

256 ià(!
I
->
	`isDeş¬©iÚ
(è&& !
ClÚedFunùiÚs
.
	`couÁ
(I) &&

257 
G¿phs
->
	`hasDSG¿ph
(*
I
)) {

258 
FuncInfo
 & 
FI
 = 
FunùiÚInfo
.
	`fšd
(
I
)->
£cÚd
;

259 ià(
FunùiÚ
* 
ClÚe
 = 
	`MakeFunùiÚClÚe
(*
I
, 
FI
, 
G¿phs
->
	`g‘DSG¿ph
(*I))) {

260 
	`as£¹
(!
EPA
->
	`isEÁryPošt
(
I
) && "Entry Point Cloned");

261 
FuncToClÚeM­
[
I
] = 
ClÚe
;

262 
ClÚedFunùiÚs
.
	`š£¹
(
ClÚe
);

268 
ModuË
::
™”©Ü
 
I
 = 
M
.
	`begš
(), 
E
 = M.
	`’d
(); I != E; ++I)

269 ià(!
I
->
	`isDeş¬©iÚ
(è&& !
ClÚedFunùiÚs
.
	`couÁ
(I) &&

270 
G¿phs
->
	`hasDSG¿ph
(*
I
)) {

271 ià(
FuncToClÚeM­
.
	`fšd
(
I
è=ğFuncToClÚeM­.
	`’d
()) {

273 
	`ProûssFunùiÚBody
(*
I
, *I, 
G¿phs
->
	`g‘DSG¿ph
(*I),Graphs);

276 
	`ProûssFunùiÚBody
(*
I
, *
FuncToClÚeM­
[I], 
G¿phs
->
	`g‘DSG¿ph
(*I),

277 
G¿phs
);

281  
Œue
;

282 
	}
}

288 
	gRTAssocŸ‹
::
	$S‘upGlob®PoŞs
(
ModuË
* 
M
, 
DSG¿ph
* 
GG
) {

293 
D’£S‘
<cÚ¡ 
DSNode
*> 
Glob®H—pNodes
;

294 
	`G‘NodesR—chabËFromGlob®s
(
GG
, 
Glob®H—pNodes
);

296 
	`”rs
(è<< "PoŞ‡Îoÿtšg " << 
Glob®H—pNodes
.
	`size
()

299 
FuncInfo
& 
FI
 = 
	`makeFuncInfo
(0, 
GG
);

301 
Glob®H—pNodes
.
	`size
()) {

302 cÚ¡ 
DSNode
* 
D
 = *
Glob®H—pNodes
.
	`begš
();

303 
Glob®H—pNodes
.
	`”a£
(
D
);

304 
FI
.
PoŞDesütÜs
[
D
] = 
	`C»©eGlob®PoŞ
(D, 
M
);

306 
	}
}

310 
Glob®V¬ŸbË
* 
	gRTAssocŸ‹
::
	$C»©eGlob®PoŞ
(cÚ¡ 
DSNode
* 
D
, 
ModuË
* 
M
) {

312 
Glob®V¬ŸbË
 *
GV
 = 
Ãw
 
	`Glob®V¬ŸbË
(*
M
, 
PoŞDescTy³
, 
çl£
,

313 
Glob®V®ue
::
Ex‹º®Lškage
, 0,

315 ++
NumPoŞs
;

316 
S³cŸlV®ues
.
	`š£¹
(
GV
);

317  
GV
;

318 
	}
}

323 
AÎoÿIn¡
* 
	gRTAssocŸ‹
::
	$C»©eLoÿlPoŞ
(cÚ¡ 
DSNode
* 
D
, 
FunùiÚ
 &
F
) {

324 
AÎoÿIn¡
* 
AI
 = 
Ãw
 
	`AÎoÿIn¡
(
PoŞDescTy³
, 0, "LocalPool",

325 
F
.
	`g‘EÁryBlock
().
	`begš
());

326 ++
NumPoŞs
;

327 
S³cŸlV®ues
.
	`š£¹
(
AI
);

328  
AI
;

329 
	}
}

331 
Argum’t
* 
	gRTAssocŸ‹
::
	$C»©eArgPoŞ
(cÚ¡ 
DSNode
*
D
, 
Argum’t
* 
Arg
) {

332 
S³cŸlV®ues
.
	`š£¹
(
Arg
);

333  
Arg
;

334 
	}
}

339 
	gRTAssocŸ‹
::
	$£tupPoŞFÜNode
(cÚ¡ 
DSNode
* 
D
, 
V®ue
* 
V
) {

340 
S³cŸlV®ues
.
	`š£¹
(
V
);

341 
PoŞInfo
*& 
PI
 = 
NodePoŞM­
[
D
];

342 
	`as£¹
(!
PI
 && "Pool‡lreadyƒxists");

343 
PI
 = 
Ãw
 
	`PoŞInfo
();

344 
PI
->
	`addPrim¬yDesütÜ
(
V
);

345 
PI
->
	`m”geNodeInfo
(
D
);

346 
NodePoŞM­
[
D
] = 
PI
;

347 
	}
}

353 
	gRTAssocŸ‹
::
	$ProûssFunùiÚBody
(
FunùiÚ
 &
F
, FunùiÚ &
NewF
, 
DSG¿ph
* 
G
,

354 
D©aSŒuùu»s
* 
DS
) {

355 ià(
G
->
	`node_begš
(è=ğG->
	`node_’d
()) ;

357 
FuncInfo
 &
FI
 = *
	`g‘FuncInfo
(&
F
);

363 
G
->
	`g‘Glob®sG¿ph
();

367 
DSG¿ph
::
NodeM­Ty
 
Glob®sG¿phNodeM­pšg
;

368 
G
->
	`compu‹GToGGM­pšg
(
Glob®sG¿phNodeM­pšg
);

372 
DSG¿ph
::
node_™”©Ü
 
I
 = 
G
->
	`node_begš
(), 
E
 = G->
	`node_’d
(); I != E; ++I) {

373 
DSNode
 *
N
 = 
I
;

374 ià(
Glob®sG¿phNodeM­pšg
.
	`couÁ
(
N
)) {

376 
DSNode
 *
GGN
 = 
Glob®sG¿phNodeM­pšg
[
N
].
	`g‘Node
();

377 
	`as£¹
(
	`g‘FuncInfo
(0)->
PoŞDesütÜs
[
GGN
] && "Should be in global mapping!");

378 
FI
.
PoŞDesütÜs
[
N
] = 
	`g‘FuncInfo
(0)->PoŞDesütÜs[
GGN
];

379 } ià(!
FI
.
PoŞDesütÜs
[
N
]) {

382 
	`as£¹
(!
N
->
	`isGlob®Node
() && "Should be in global mapping!");

383 
FI
.
PoŞDesütÜs
[
N
] = 
	`C»©eLoÿlPoŞ
(N, 
NewF
);

386 
	`T¿nsfÜmBody
(
NewF
, 
FI
, 
DS
);

387 
	}
}

389 
FuncInfo
* 
	gRTAssocŸ‹
::
	$g‘FuncInfo
(cÚ¡ 
FunùiÚ
* 
F
) {

390 
¡d
::
m­
<cÚ¡ 
FunùiÚ
*, 
FuncInfo
>::
™”©Ü
 
I
 = 
FunùiÚInfo
.
	`fšd
(
F
);

391  
I
 !ğ
FunùiÚInfo
.
	`’d
(è? &I->
£cÚd
 : 0;

392 
	}
}

394 
	gFuncInfo
& 
	gRTAssocŸ‹
::
	$makeFuncInfo
(cÚ¡ 
FunùiÚ
* 
F
, 
DSG¿ph
* 
G
) {

395  
FunùiÚInfo
.
	`š£¹
(
¡d
::
	`make_·œ
(
F
, 
	`FuncInfo
(F, 
G
))).
fœ¡
->
£cÚd
;

396 
	}
}

398 
	gRTAssocŸ‹
::
	$T¿nsfÜmBody
(
FunùiÚ
& 
F
, 
FuncInfo
& 
FI
,

399 
D©aSŒuùu»s
* 
DS
) {

400 
FunùiÚ
::
™”©Ü
 
ii
 = 
F
.
	`begš
(), 
“
 = F.
	`’d
(); ii !=ƒe; ++ii)

401 
BasicBlock
::
™”©Ü
 
bi
 = 
ii
->
	`begš
(); b˜!ğii->
	`’d
();)

402 ià(
C®lIn¡
* 
CI
 = 
dyn_ÿ¡
<C®lIn¡>(
bi
)) {

403 ++
bi
;

404 
	`»¶aûC®l
(
	`C®lS™e
(
CI
), 
FI
, 
DS
);

406 ++
bi
;

407 
	}
}

409 
	gRTAssocŸ‹
::
	$»¶aûC®l
(
C®lS™e
 
CS
, 
FuncInfo
& 
FI
, 
D©aSŒuùu»s
* 
DS
) {

410 cÚ¡ 
FunùiÚ
 *
CF
 = 
CS
.
	`g‘C®ËdFunùiÚ
();

411 
In¡ruùiÚ
 *
TheC®l
 = 
CS
.
	`g‘In¡ruùiÚ
();

415 ià(
CÚ¡ªtEx´
 *
CE
 = 
dyn_ÿ¡
<CÚ¡ªtEx´>(
CS
.
	`g‘C®ËdV®ue
()))

416 ià(
CE
->
	`g‘Opcode
(è=ğ
In¡ruùiÚ
::
B™Ca¡
 &&

417 
i§
<
FunùiÚ
>(
CE
->
	`g‘O³¿nd
(0)))

418 
CF
 = 
ÿ¡
<
FunùiÚ
>(
CE
->
	`g‘O³¿nd
(0));

420 ià(
i§
<
IÆšeAsm
>(
TheC®l
->
	`g‘O³¿nd
(0))) {

421 
	`”rs
() << "INLINE ASM: ignoring. Hopinghat's safe.\n";

426 ià(
i§
<
CÚ¡ªtPoš‹rNuÎ
>(
CS
.
	`g‘C®ËdV®ue
())) {

427 
	`”rs
() << "WARNING: Ignoring call using NULL function…ointer.\n";

436 
DSG¿ph
::
NodeM­Ty
 
NodeM­pšg
;

437 
In¡ruùiÚ
 *
NewC®l
;

438 
V®ue
 *
NewC®Ëe
;

439 
¡d
::
veùÜ
<cÚ¡ 
DSNode
*> 
ArgNodes
;

440 
DSG¿ph
 *
C®ËeG¿ph
;

444 ià(
CF
) {

445 
	`DEBUG
(
	`”rs
(è<< " Hªdlšg dœeù c®l: " << *
TheC®l
);

446 
FuncInfo
 *
CFI
 = 
	`g‘FuncInfo
(
CF
);

447 ià(
CFI
 =ğ0 || CFI->
ClÚe
 == 0)

450 
NewC®Ëe
 = 
CFI
->
ClÚe
;

451 
ArgNodes
 = 
CFI
->ArgNodes;

453 
	`as£¹
 ((
DS
->
	`hasDSG¿ph
 (*
CF
)) && "Function has‚o ECGraph!\n");

454 
C®ËeG¿ph
 = 
DS
->
	`g‘DSG¿ph
(*
CF
);

456 
	`DEBUG
(
	`”rs
(è<< " Hªdlšg indœeù c®l: " << *
TheC®l
);

463 
In¡ruùiÚ
 *
OrigIn¡
 =

464 
ÿ¡
<
In¡ruùiÚ
>(
FI
.
	`g‘OldV®ueIfAvaabË
(
CS
.
	`g‘In¡ruùiÚ
()));

466 
DSC®lG¿ph
::
ÿÎ“_™”©Ü
 
I
 = 
DS
->
	`g‘C®lG¿ph
().
	`ÿÎ“_begš
(
CS
);

467 ià(
I
 !ğ
DS
->
	`g‘C®lG¿ph
().
	`ÿÎ“_’d
(
CS
))

468 
CF
 = *
I
;

474 ià(!
CF
) {

475 
DSG¿ph
* 
dg
 = 
DS
->
	`g‘DSG¿ph
(*
OrigIn¡
->
	`g‘P¬’t
()->getParent());

476 
DSNode
* 
d
 = 
dg
->
	`g‘NodeFÜV®ue
(
OrigIn¡
->
	`g‘O³¿nd
(0)).
	`g‘Node
();

477 
	`as£¹
 (
d
 && "No DSNode!\n");

478 
¡d
::
veùÜ
<cÚ¡ 
FunùiÚ
*> 
g
;

479 
d
->
	`addFuÎFunùiÚLi¡
(
g
);

480 ià(
g
.
	`size
()) {

481 
Equiv®’ûCÏs£s
< cÚ¡ 
Glob®V®ue
 *> & 
EC
 = 
dg
->
	`g‘Glob®ECs
();

482 
¡d
::
veùÜ
<cÚ¡ 
FunùiÚ
*>::
cÚ¡_™”©Ü
 
ii
 = 
g
.
	`begš
(), 
“
 = g.
	`’d
();

483 !
CF
 && 
ii
 !ğ
“
; ++ii) {

484 
Equiv®’ûCÏs£s
<cÚ¡ 
Glob®V®ue
 *>::
memb”_™”©Ü
 
MI
 = 
EC
.
	`fšdL—d”
(*
ii
);

485 
MI
 !ğ
EC
.
	`memb”_’d
(); ++MI)

486 ià((
CF
 = 
dyn_ÿ¡
<
FunùiÚ
>(*
MI
))) {

497 ià(!
CF
)

498 
	`”rs
() << "No Graph for CallSite in "

499 << 
TheC®l
->
	`g‘P¬’t
()->g‘P¬’t()->
	`g‘Name
().
	`¡r
()

501 << 
OrigIn¡
->
	`g‘P¬’t
()->g‘P¬’t()->
	`g‘Name
().
	`¡r
()

504 
	`as£¹
 (
CF
 && "No call graph info");

508 
	`as£¹
 ((
DS
->
	`hasDSG¿ph
(*
CF
)) && "Function has‚o DSGraph!\n");

509 
C®ËeG¿ph
 = 
DS
->
	`g‘DSG¿ph
(*
CF
);

511 #iâdeà
NDEBUG


513 
DSC®lG¿ph
::
ÿÎ“_™”©Ü
 
E
 = 
DS
->
	`g‘C®lG¿ph
().
	`ÿÎ“_’d
(
CS
);

514 ; 
I
 !ğ
E
; ++I)

515 ià(!(*
I
)->
	`isDeş¬©iÚ
())

516 
	`as£¹
(
C®ËeG¿ph
 =ğ
DS
->
	`g‘DSG¿ph
(**
I
) &&

521 
FuncInfo
 *
CFI
 = 
	`g‘FuncInfo
(
CF
);

522 
	`as£¹
(
CFI
 && "No function info for callee‡t indirect call?");

523 
ArgNodes
 = 
CFI
->ArgNodes;

525 ià(
ArgNodes
.
	`em±y
())

529 
¡d
::
veùÜ
<
Ty³
*> 
	`ArgTys
(
ArgNodes
.
	`size
(), 
PoŞDescPŒTy
);

530 
C®lS™e
::
¬g_™”©Ü
 
I
 = 
CS
.
	`¬g_begš
(), 
E
 = CS.
	`¬g_’d
();

531 
I
 !ğ
E
; ++I)

532 
ArgTys
.
	`push_back
((*
I
)->
	`g‘Ty³
());

534 
FunùiÚTy³
 *
FTy
 = FunùiÚTy³::
	`g‘
(
TheC®l
->
	`g‘Ty³
(), 
ArgTys
, 
çl£
);

535 
Poš‹rTy³
 *
PFTy
 = Poš‹rTy³::
	`g‘Unqu®
(
FTy
);

538 
NewC®Ëe
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(
CS
.
	`g‘C®ËdV®ue
(), 
PFTy
, "tmp", 
TheC®l
);

541 
FunùiÚ
::
cÚ¡_¬g_™”©Ü
 
FAI
 = 
CF
->
	`¬g_begš
(), 
E
 = CF->
	`¬g_’d
();

542 
C®lS™e
::
¬g_™”©Ü
 
AI
 = 
CS
.
	`¬g_begš
(), 
AE
 = CS.
	`¬g_’d
();

543  ; 
FAI
 !ğ
E
 && 
AI
 !ğ
AE
; ++FAI, ++AI)

544 ià(!
i§
<
CÚ¡ªt
>(*
AI
))

545 
DSG¿ph
::
	`compu‹NodeM­pšg
(
C®ËeG¿ph
->
	`g‘NodeFÜV®ue
(
FAI
),

546 
FI
.
	`g‘DSNodeHFÜ
(*
AI
), 
NodeM­pšg
, 
çl£
);

548 
	`as£¹
(
AI
 =ğ
AE
 && "Varargs calls‚ot handled yet!");

551 ià(
i§
<
Poš‹rTy³
>(
TheC®l
->
	`g‘Ty³
()))

552 
DSG¿ph
::
	`compu‹NodeM­pšg
(
C®ËeG¿ph
->
	`g‘R‘uºNodeFÜ
(*
CF
),

553 
FI
.
	`g‘DSNodeHFÜ
(
TheC®l
), 
NodeM­pšg
, 
çl£
);

557 
¡d
::
veùÜ
<
V®ue
*> 
Args
;

558 
i
 = 0, 
e
 = 
ArgNodes
.
	`size
(); i !=ƒ; ++i) {

559 
V®ue
 *
ArgV®
 = 
CÚ¡ªt
::
	`g‘NuÎV®ue
(
PoŞDescPŒTy
);

560 ià(
NodeM­pšg
.
	`couÁ
(
ArgNodes
[
i
]))

561 ià(
DSNode
 *
LoÿlNode
 = 
NodeM­pšg
[
ArgNodes
[
i
]].
	`g‘Node
())

562 ià(
FI
.
PoŞDesütÜs
.
	`couÁ
(
LoÿlNode
))

563 
ArgV®
 = 
FI
.
PoŞDesütÜs
.
	`fšd
(
LoÿlNode
)->
£cÚd
;

564 ià(
i§
<
CÚ¡ªt
 > (
ArgV®
è&& 
ÿ¡
<CÚ¡ªˆ> (ArgV®)->
	`isNuÎV®ue
())

565 
	`”rs
() << "WARNING: NULL POOL ARGUMENTS ARE PASSED IN!\n";

566 
Args
.
	`push_back
(
ArgV®
);

570 
Args
.
	`š£¹
(Args.
	`’d
(), 
CS
.
	`¬g_begš
(), CS.
	`¬g_’d
());

577 ià(
FunùiÚ
 * 
NewFunùiÚ
 = 
dyn_ÿ¡
<FunùiÚ>(
NewC®Ëe
)) {

578 
FunùiÚTy³
 * 
NewC®ËeTy³
 = 
NewFunùiÚ
->
	`g‘FunùiÚTy³
();

579 ià(
NewC®ËeTy³
->
	`g‘NumP¬ams
(è!ğ
Args
.
	`size
()) {

580 
¡d
::
veùÜ
<
Ty³
 *> 
Ty³s
;

581 
Ty³
 * 
FuncTy
 = 
FunùiÚTy³
::
	`g‘
 (
NewC®ËeTy³
->
	`g‘R‘uºTy³
(),

582 
Ty³s
,

583 
Œue
);

584 
FuncTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
 (FuncTy);

585 
NewC®Ëe
 = 
Ãw
 
	`B™Ca¡In¡
 (NewC®Ëe, 
FuncTy
, "", 
TheC®l
);

589 
¡d
::
¡ršg
 
Name
 = 
TheC®l
->
	`g‘Name
(); TheC®l->
	`£tName
("");

591 ià(
InvokeIn¡
 *
II
 = 
dyn_ÿ¡
<InvokeIn¡>(
TheC®l
)) {

592 
NewC®l
 = 
InvokeIn¡
::
	`C»©e
 (
NewC®Ëe
, 
II
->
	`g‘NÜm®De¡
(),

593 
II
->
	`g‘UnwšdDe¡
(),

594 
Args
, 
Name
, 
TheC®l
);

596 
NewC®l
 = 
C®lIn¡
::
	`C»©e
 (
NewC®Ëe
, 
Args
, 
Name
,

597 
TheC®l
);

600 
TheC®l
->
	`»¶aûAÎU£sW™h
(
NewC®l
);

601 
	`DEBUG
(
	`”rs
(è<< " ResuÉ C®l: " << *
NewC®l
);

603 ià(
TheC®l
->
	`g‘Ty³
()->
	`g‘Ty³ID
(è!ğ
Ty³
::
VoidTyID
) {

605 
DSG¿ph
::
SÿÏrM­Ty
 &
SM
 = 
FI
.
G
->
	`g‘SÿÏrM­
();

606 
DSG¿ph
::
SÿÏrM­Ty
::
™”©Ü
 
CII
 = 
SM
.
	`fšd
(
TheC®l
);

607 ià(
CII
 !ğ
SM
.
	`’d
()) {

608 
SM
[
NewC®l
] = 
CII
->
£cÚd
;

609 
SM
.
	`”a£
(
CII
);

610 } ià(!
FI
.
NewToOldV®ueM­
.
	`em±y
()) {

613 
FI
.
	`Upd©eNewToOldV®ueM­
(
TheC®l
, 
NewC®l
);

615 } ià(!
FI
.
NewToOldV®ueM­
.
	`em±y
()) {

616 
FI
.
	`Upd©eNewToOldV®ueM­
(
TheC®l
, 
NewC®l
);

620 
	`C®lS™e
(
NewC®l
).
	`£tC®lšgCÚv
(C®lS™e(
TheC®l
).
	`g‘C®lšgCÚv
());

622 
TheC®l
->
	`”a£FromP¬’t
();

623 
	}
}

	@TransformFunctionBody.cpp

14 
	#DEBUG_TYPE
 "PoŞAÎoÿtÜ"

	)

16 
	~"d§/D©aSŒuùu».h
"

17 
	~"d§/DSG¿ph.h
"

18 
	~"d§/C®lT¬g‘s.h
"

19 
	~"poŞ®loc/PoŞAÎoÿ‹.h
"

20 
	~"poŞ®loc/RuÁimeChecks.h
"

21 
	~"Îvm/ModuË.h
"

22 
	~"Îvm/D”ivedTy³s.h
"

23 
	~"Îvm/CÚ¡ªts.h
"

24 
	~"Îvm/In¡ruùiÚs.h
"

25 
	~"Îvm/T¬g‘/T¬g‘D©a.h
"

26 
	~"Îvm/SuµÜt/In¡Vis™Ü.h
"

27 
	~"Îvm/SuµÜt/FÜm©‹dSŒ—m.h
"

28 
	~"Îvm/SuµÜt/Debug.h
"

29 
	~"Îvm/ADT/SŒšgM­.h
"

30 
	~"Îvm/ADT/VeùÜExŒas.h
"

32 
	~<io¡»am
>

33 
usšg
 
Çme¥aû
 
	gÎvm
;

34 
usšg
 
Çme¥aû
 
	gPA
;

36 
	gÇme¥aû
 {

39 
	gFuncT¿nsfÜm
 : 
public
 
In¡Vis™Ü
<
FuncT¿nsfÜm
> {

40 
PoŞAÎoÿ‹
 &
PAInfo
;

41 
DSG¿ph
* 
	gG
;

42 
	gFuncInfo
 &
	gFI
;

49 
	g¡d
::
muÉim­
<
AÎoÿIn¡
*, 
	gIn¡ruùiÚ
*> &
	gPoŞU£s
;

53 
	g¡d
::
muÉim­
<
AÎoÿIn¡
*, 
	gC®lIn¡
*> &
	gPoŞF»es
;

55 
FuncT¿nsfÜm
(
PoŞAÎoÿ‹
 &
P
, 
DSG¿ph
* 
g
, 
FuncInfo
 &
fi
,

56 
¡d
::
muÉim­
<
AÎoÿIn¡
*, 
In¡ruùiÚ
*> &
poŞU£s
,

57 
¡d
::
muÉim­
<
AÎoÿIn¡
*, 
C®lIn¡
*> &
poŞF»es
)

58 : 
PAInfo
(
P
), 
G
(
g
), 
FI
(
fi
),

59 
PoŞU£s
(
poŞU£s
), 
PoŞF»es
(
poŞF»es
) {

62 
	g‹m¶©e
 <
ty³Çme
 
	gIn¡Ty³
,y³Çm
	gS‘Ty³
>

63 
AddPoŞU£
(
In¡Ty³
 &
I
, 
V®ue
 *
PoŞHªdË
, 
S‘Ty³
 &
S‘
) {

64 ià(
AÎoÿIn¡
 *
	gAI
 = 
dyn_ÿ¡
<AÎoÿIn¡>(
PoŞHªdË
->
¡rPoš‹rCa¡s
()))

65 
S‘
.
š£¹
(
¡d
::
make_·œ
(
AI
, &
I
));

69 
vis™In¡ruùiÚ
(
In¡ruùiÚ
 &
I
);

70 
vis™AÎoÿIn¡
(
AÎoÿIn¡
 &
MI
);

71 
vis™M®locC®l
(
C®lS™e
 & 
CS
);

72 
vis™C®locC®l
(
C®lS™e
 
CS
);

73 
vis™R—ÎocC®l
(
C®lS™e
 
CS
);

74 
vis™MemAlignC®l
(
C®lS™e
 
CS
);

75 
vis™SŒdupC®l
(
C®lS™e
 
CS
);

76 
vis™RuÁimeCheck
(
C®lS™e
 
CS
, cÚ¡ 
PoŞArgc
);

77 
vis™F»eC®l
(
C®lS™e
 &
CS
);

78 
vis™C®lS™e
(
C®lS™e
 &
CS
);

79 
vis™C®lIn¡
(
C®lIn¡
 &
CI
) {

80 
C®lS™e
 
CS
(&
CI
);

81 
vis™C®lS™e
(
CS
);

83 
vis™InvokeIn¡
(
InvokeIn¡
 &
II
) {

84 
C®lS™e
 
CS
(&
II
);

85 
vis™C®lS™e
(
CS
);

87 
vis™LßdIn¡
(
LßdIn¡
 &
I
);

88 
vis™StÜeIn¡
 (
StÜeIn¡
 &
I
);

90 
	g´iv©e
:

91 
In¡ruùiÚ
 *
T¿nsfÜmAÎoÿtiÚIn¡r
(In¡ruùiÚ *
I
, 
V®ue
 *
Size
);

92 
In¡ruùiÚ
 *
In£¹PoŞF»eIn¡r
(
V®ue
 *
V
, In¡ruùiÚ *
Wh”e
);

102 
Upd©eNewToOldV®ueM­
(
V®ue
 *
OldV®
, V®u*
NewV1
, V®u*
NewV2
 = 0) {

103 
¡d
::
m­
<
V®ue
*, cÚ¡ V®ue*>::
™”©Ü
 
I
 =

104 
FI
.
NewToOldV®ueM­
.
fšd
(
OldV®
);

105 
as£¹
(
I
 !ğ
FI
.
NewToOldV®ueM­
.
’d
() && "OldVal‚ot found in clone?");

106 
	gFI
.
	gNewToOldV®ueM­
.
š£¹
(
¡d
::
make_·œ
(
NewV1
, 
I
->
£cÚd
));

107 ià(
	gNewV2
)

108 
	gFI
.
	gNewToOldV®ueM­
.
š£¹
(
¡d
::
make_·œ
(
NewV2
, 
I
->
£cÚd
));

109 
	gFI
.
	gNewToOldV®ueM­
.
”a£
(
I
);

112 
V®ue
* 
g‘OldV®ueIfAvaabË
(V®ue* 
V
) {

113 ià(!
	gFI
.
	gNewToOldV®ueM­
.
em±y
()) {

115 
	g¡d
::
m­
<
V®ue
*,cÚ¡ 
	gV®ue
*>::
™”©Ü
 
I
 = 
FI
.
NewToOldV®ueM­
.
fšd
(
V
);

116 ià(
	gI
 !ğ
FI
.
NewToOldV®ueM­
.
’d
())

117 
V
 = 
cÚ¡_ÿ¡
<
V®ue
*>(
I
->
£cÚd
);

119  
	gV
;

122 
	gDSNodeHªdË
& 
g‘DSNodeHFÜ
(
V®ue
 *
V
) {

123  
	gG
->
g‘SÿÏrM­
()[
g‘OldV®ueIfAvaabË
(
V
)];

127 
V®ue
 *
g‘PoŞHªdË
(V®u*
V
) {

128 
DSNode
 *
	gNode
 = 
g‘DSNodeHFÜ
(
V
).
g‘Node
();

130 
	g¡d
::
m­
<cÚ¡ 
DSNode
*, 
	gV®ue
*>::
™”©Ü
 
I
 =

131 
FI
.
PoŞDesütÜs
.
fšd
(
Node
);

132  
	gI
 !ğ
FI
.
PoŞDesütÜs
.
’d
(è? 
I
->
£cÚd
 : 0;

135 
FunùiÚ
* 
»tClÚeIfFunc
(
V®ue
 *
V
);

137 
v”ifyC®Ëes
 (cÚ¡ 
¡d
::
veùÜ
<cÚ¡ 
FunùiÚ
 *> & 
FunùiÚs
);

141 
šlše
 
V®ue
 *

142 
ÿ¡To
 (
V®ue
 * 
V
, 
Ty³
 * 
Ty
, 
¡d
::
¡ršg
 
Name
, 
In¡ruùiÚ
 * 
In£¹Pt
) {

146 ià(
	gV
->
g‘Ty³
(è=ğ
Ty
)

147  
V
;

152 ià(
CÚ¡ªt
 * 
	gC
 = 
dyn_ÿ¡
<CÚ¡ªt>(
V
)) {

153 
CÚ¡ªt
 * 
CE
 = 
CÚ¡ªtEx´
::
g‘ZExtOrB™Ca¡
 (
C
, 
Ty
);

154  
	gCE
;

160  
	gCa¡In¡
::
C»©eZExtOrB™Ca¡
 (
V
, 
Ty
, 
Name
, 
In£¹Pt
);

164 
	gPoŞAÎoÿ‹
::
T¿nsfÜmBody
 (
DSG¿ph
* 
g
, 
PA
::
FuncInfo
 &
fi
,

165 
¡d
::
muÉim­
<
AÎoÿIn¡
*,
In¡ruùiÚ
*> &
poŞU£s
,

166 
¡d
::
muÉim­
<
AÎoÿIn¡
*, 
C®lIn¡
*> &
poŞF»es
,

167 
FunùiÚ
 &
F
) {

168 
FuncT¿nsfÜm
(*
this
, 
g
, 
fi
, 
poŞU£s
, 
poŞF»es
).
vis™
(
F
);

179 
	gFuncT¿nsfÜm
::
v”ifyC®Ëes
 (cÚ¡ 
¡d
::
veùÜ
<cÚ¡ 
FunùiÚ
 *> & 
FunùiÚs
) {

180 #iâdeà
NDEBUG


184 ià(
FunùiÚs
.
size
() == 0)

190 
	gnumPoŞArgs
 = 
PAInfo
.
g‘FuncInfo
(*
FunùiÚs
[0])->
ArgNodes
.
size
();

195 
	gD©aSŒuùu»s
& 
	gG¿phs
 = 
PAInfo
.
g‘G¿phs
();

196 
DSG¿ph
 * 
	gfœ¡G¿ph
 = 
G¿phs
.
g‘DSG¿ph
 (*
FunùiÚs
[0]);

203 
	gšdex
 = 1; index < 
	gFunùiÚs
.
size
(); ++index) {

207 cÚ¡ 
FunùiÚ
 * 
	gF
 = 
FunùiÚs
[
šdex
];

208 
FuncInfo
 *
	gFI
 = 
PAInfo
.
g‘FuncInfo
(*
F
);

213 
DSG¿ph
 * 
	gG
 = 
G¿phs
.
g‘DSG¿ph
 (*
FunùiÚs
[
šdex
]);

218 
as£¹
 (
G
 =ğ
fœ¡G¿ph
);

219 
as£¹
 (
FI
->
ArgNodes
.
size
(è=ğ
numPoŞArgs
);

231 
FunùiÚ
* 
	gFuncT¿nsfÜm
::
	$»tClÚeIfFunc
(
V®ue
 *
V
) {

232 ià(
FunùiÚ
 *
F
 = 
dyn_ÿ¡
<FunùiÚ>(
V
))

233 ià(
FuncInfo
 *
FI
 = 
PAInfo
.
	`g‘FuncInfo
(*
F
))

234  
FI
->
ClÚe
;

237 
	}
}

239 
	gFuncT¿nsfÜm
::
	$vis™LßdIn¡
(
LßdIn¡
 &
LI
) {

243 ià(
V®ue
 *
PH
 = 
	`g‘PoŞHªdË
(
LI
.
	`g‘O³¿nd
(0)))

244 
	`AddPoŞU£
(
LI
, 
PH
, 
PoŞU£s
);

250 ià(
LI
.
	`isVŞ©e
()) {

251 ià(
V®ue
 *
PH
 = 
	`g‘PoŞHªdË
(&
LI
))

252 
	`AddPoŞU£
 (
LI
, 
PH
, 
PoŞU£s
);

255 
	`vis™In¡ruùiÚ
(
LI
);

256 
	}
}

258 
	gFuncT¿nsfÜm
::
	$vis™StÜeIn¡
(
StÜeIn¡
 &
SI
) {

259 ià(
V®ue
 *
PH
 = 
	`g‘PoŞHªdË
(
SI
.
	`g‘O³¿nd
(1)))

260 
	`AddPoŞU£
(
SI
, 
PH
, 
PoŞU£s
);

261 
	`vis™In¡ruùiÚ
(
SI
);

262 
	}
}

264 
In¡ruùiÚ
 *
	gFuncT¿nsfÜm
::
	$T¿nsfÜmAÎoÿtiÚIn¡r
(
In¡ruùiÚ
 *
I
,

265 
V®ue
 *
Size
) {

268 
¡d
::
¡ršg
 
Name
 = 
I
->
	`g‘Name
(); I->
	`£tName
("");

275 ià(!
Size
->
	`g‘Ty³
()->
	`isIÁeg”Ty
(32))

276 
Size
 = 
Ca¡In¡
::
	`C»©eIÁeg”Ca¡
(Size, 
Ty³
::
	`g‘IÁ32Ty
(Size->
	`g‘Ty³
()->
	`g‘CÚ‹xt
()), 
çl£
, Size->
	`g‘Name
(), 
I
);

282 
V®ue
 *
PH
 = 
	`g‘PoŞHªdË
(
I
);

283 ià(
PH
 =ğ0 || 
i§
<
CÚ¡ªtPoš‹rNuÎ
>(PH)è 
I
;

286 
V®ue
* 
O±s
[2] = {
PH
, 
Size
};

287 
In¡ruùiÚ
 *
V
 = 
C®lIn¡
::
	`C»©e
(
PAInfo
.
PoŞAÎoc
, 
O±s
, 
Name
, 
I
);

288 
	`AddPoŞU£
(*
V
, 
PH
, 
PoŞU£s
);

292 
In¡ruùiÚ
 *
Ca¡ed
 = 
V
;

293 ià(
V
->
	`g‘Ty³
(è!ğ
I
->getType())

294 
Ca¡ed
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(
V
, 
I
->
	`g‘Ty³
(), V->
	`g‘Name
(), I);

297 
I
->
	`»¶aûAÎU£sW™h
(
Ca¡ed
);

300 ià(!
FI
.
ClÚe
) {

302 
G
->
	`g‘SÿÏrM­
().
	`»¶aûSÿÏr
(
I
, 
V
);

303 ià(
V
 !ğ
Ca¡ed
)

304 
G
->
	`g‘SÿÏrM­
()[
Ca¡ed
] = G->g‘SÿÏrM­()[
V
];

306 
	`Upd©eNewToOldV®ueM­
(
I
, 
V
, V !ğ
Ca¡ed
 ? Casted : 0);

310 ià(
InvokeIn¡
 *
II
 = 
dyn_ÿ¡
<InvokeIn¡>(
I
)) {

312 
B¿nchIn¡
::
	`C»©e
 (
II
->
	`g‘NÜm®De¡
(), 
I
);

313 
II
->
	`g‘UnwšdDe¡
()->
	`»moveP»deûssÜ
(II->
	`g‘P¬’t
(), 
Œue
);

317 
I
->
	`”a£FromP¬’t
();

318  
Ca¡ed
;

319 
	}
}

321 
	gFuncT¿nsfÜm
::
	$vis™AÎoÿIn¡
(
AÎoÿIn¡
 &
MI
) {

323 ià(
MI
.
	`g‘Ty³
(è!ğ
PoŞAÎoÿ‹
::
PoŞDescPŒTy
) {

324 
V®ue
 *
PH
 = 
	`g‘PoŞHªdË
(&
MI
);

325 
	`as£¹
 (
PH
 && "Alloca has‚o…ool handle!\n");

338 
	}
}

358 
In¡ruùiÚ
 *

359 
	gFuncT¿nsfÜm
::
	$In£¹PoŞF»eIn¡r
 (
V®ue
 *
Arg
, 
In¡ruùiÚ
 *
Wh”e
){

364 
V®ue
 *
PH
 = 
	`g‘PoŞHªdË
(
Arg
);

365 ià(
PH
 =ğ0 || 
i§
<
CÚ¡ªtPoš‹rNuÎ
>(PH))  0;

371 
V®ue
 *
Ca¡ed
 = 
Arg
;

372 ià(
Arg
->
	`g‘Ty³
(è!ğ
Poš‹rTy³
::
	`g‘Unqu®
(
Ty³
::
	`g‘IÁ8Ty
(Arg->
	`g‘CÚ‹xt
()))) {

373 
Ca¡ed
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(
Arg
, 
Poš‹rTy³
::
	`g‘Unqu®
(
Ty³
::
	`g‘IÁ8Ty
(Arg->
	`g‘CÚ‹xt
())),

374 
Arg
->
	`g‘Name
()+".ÿ¡ed", 
Wh”e
);

375 
G
->
	`g‘SÿÏrM­
()[
Ca¡ed
] = G->g‘SÿÏrM­()[
Arg
];

381 
V®ue
* 
O±s
[2] = {
PH
, 
Ca¡ed
};

382 
C®lIn¡
 *
F»eI
 = C®lIn¡::
	`C»©e
(
PAInfo
.
PoŞF»e
, 
O±s
, "", 
Wh”e
);

383 
	`AddPoŞU£
(*
F»eI
, 
PH
, 
PoŞF»es
);

384  
F»eI
;

385 
	}
}

388 
	gFuncT¿nsfÜm
::
	$vis™F»eIn¡
(
F»eIn¡
 &
FrI
) {

389 ià(
In¡ruùiÚ
 *
I
 = 
	`In£¹PoŞF»eIn¡r
(
FrI
.
	`g‘O³¿nd
(0), &FrI)) {

391 
FrI
.
	`g‘P¬’t
()->
	`g‘In¡Li¡
().
	`”a£
(&FrI);

394 ià(!
FI
.
NewToOldV®ueM­
.
	`em±y
()) {

395 
¡d
::
m­
<
V®ue
*,cÚ¡ V®ue*>::
™”©Ü
 
II
 =

396 
FI
.
NewToOldV®ueM­
.
	`fšd
(&
FrI
);

397 
	`as£¹
(
II
 !ğ
FI
.
NewToOldV®ueM­
.
	`’d
() &&

399 
FI
.
NewToOldV®ueM­
.
	`š£¹
(
¡d
::
	`make_·œ
(
I
, 
II
->
£cÚd
));

400 
FI
.
NewToOldV®ueM­
.
	`”a£
(
II
);

403 
	}
}

407 
	gFuncT¿nsfÜm
::
	$vis™F»eC®l
 (
C®lS™e
 & 
CS
) {

411 
In¡ruùiÚ
 * 
In£¹Pt
 = 
CS
.
	`g‘In¡ruùiÚ
();

412 ià(
In¡ruùiÚ
 *
I
 = 
	`In£¹PoŞF»eIn¡r
 (
CS
.
	`g‘Argum’t
(0), 
In£¹Pt
)) {

415 
In£¹Pt
->
	`g‘P¬’t
()->
	`g‘In¡Li¡
().
	`”a£
(InsertPt);

419 ià(!
FI
.
NewToOldV®ueM­
.
	`em±y
()) {

420 
¡d
::
m­
<
V®ue
*,cÚ¡ V®ue*>::
™”©Ü
 
II
 =

421 
FI
.
NewToOldV®ueM­
.
	`fšd
(
In£¹Pt
);

422 
	`as£¹
(
II
 !ğ
FI
.
NewToOldV®ueM­
.
	`’d
() &&

424 
FI
.
NewToOldV®ueM­
.
	`š£¹
(
¡d
::
	`make_·œ
(
I
, 
II
->
£cÚd
));

425 
FI
.
NewToOldV®ueM­
.
	`”a£
(
II
);

428 
	}
}

431 
	gFuncT¿nsfÜm
::
	$vis™M®locC®l
(
C®lS™e
 &
CS
) {

435 
In¡ruùiÚ
 * 
MI
 = 
CS
.
	`g‘In¡ruùiÚ
();

441 
V®ue
 *
PH
 = 
	`g‘PoŞHªdË
(
MI
);

442 ià(
PH
 =ğ0 || 
i§
<
CÚ¡ªtPoš‹rNuÎ
>(PH)) ;

447 
V®ue
 *
AÎocSize
 = 
CS
.
	`g‘Argum’t
(0);

452 
	`T¿nsfÜmAÎoÿtiÚIn¡r
(
MI
, 
AÎocSize
);

453 
	}
}

464 
	gFuncT¿nsfÜm
::
	$vis™C®locC®l
 (
C®lS™e
 
CS
) {

468 
	`as£¹
(
CS
.
	`¬g_’d
()-CS.
	`¬g_begš
() == 2 && "callocakeswo‡rguments!");

474 
In¡ruùiÚ
 * 
I
 = 
CS
.
	`g‘In¡ruùiÚ
();

475 
¡d
::
¡ršg
 
Name
 = 
I
->
	`g‘Name
(); I->
	`£tName
("");

477 
Ty³
* 
IÁ32Ty³
 = Ty³::
	`g‘IÁ32Ty
(
CS
.
	`g‘In¡ruùiÚ
()->
	`g‘CÚ‹xt
());

483 
V®ue
 *
V1
 = 
CS
.
	`g‘Argum’t
(0);

484 
V®ue
 *
V2
 = 
CS
.
	`g‘Argum’t
(1);

485 
V1
 = 
Ca¡In¡
::
	`C»©eIÁeg”Ca¡
(V1, 
IÁ32Ty³
, 
çl£
, V1->
	`g‘Name
(), 
I
);

486 
V2
 = 
Ca¡In¡
::
	`C»©eIÁeg”Ca¡
(V2, 
IÁ32Ty³
, 
çl£
, V2->
	`g‘Name
(), 
I
);

491 
V®ue
 *
PH
 = 
	`g‘PoŞHªdË
(
CS
.
	`g‘In¡ruùiÚ
());

492 ià(
PH
 =ğ0 || 
i§
<
CÚ¡ªtPoš‹rNuÎ
>(PH))

498 
V®ue
* 
O±s
[3] = {
PH
, 
V1
, 
V2
};

499 
In¡ruùiÚ
 *
V
 = 
C®lIn¡
::
	`C»©e
(
PAInfo
.
PoŞC®loc
, 
O±s
, 
Name
, 
I
);

500 
	`AddPoŞU£
(*
V
, 
PH
, 
PoŞU£s
);

504 
In¡ruùiÚ
 *
Ca¡ed
 = 
V
;

505 ià(
V
->
	`g‘Ty³
(è!ğ
I
->getType())

506 
Ca¡ed
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(
V
, 
I
->
	`g‘Ty³
(), V->
	`g‘Name
(), I);

509 
I
->
	`»¶aûAÎU£sW™h
(
Ca¡ed
);

512 ià(!
FI
.
ClÚe
) {

514 
G
->
	`g‘SÿÏrM­
().
	`»¶aûSÿÏr
(
I
, 
V
);

515 ià(
V
 !ğ
Ca¡ed
)

516 
G
->
	`g‘SÿÏrM­
()[
Ca¡ed
] = G->g‘SÿÏrM­()[
V
];

518 
	`Upd©eNewToOldV®ueM­
(
I
, 
V
, V !ğ
Ca¡ed
 ? Casted : 0);

522 ià(
InvokeIn¡
 *
II
 = 
dyn_ÿ¡
<InvokeIn¡>(
I
)) {

524 
B¿nchIn¡
::
	`C»©e
 (
II
->
	`g‘NÜm®De¡
(), 
I
);

525 
II
->
	`g‘UnwšdDe¡
()->
	`»moveP»deûssÜ
(II->
	`g‘P¬’t
(), 
Œue
);

529 
I
->
	`”a£FromP¬’t
();

531 
	}
}

534 
	gFuncT¿nsfÜm
::
	$vis™R—ÎocC®l
(
C®lS™e
 
CS
) {

535 
	`as£¹
(
CS
.
	`¬g_’d
()-CS.
	`¬g_begš
() == 2 && "reallocakeswo‡rguments!");

536 
In¡ruùiÚ
 *
I
 = 
CS
.
	`g‘In¡ruùiÚ
();

537 
V®ue
 *
PH
 = 
	`g‘PoŞHªdË
(
I
);

538 
V®ue
 *
OldPŒ
 = 
CS
.
	`g‘Argum’t
(0);

539 
V®ue
 *
Size
 = 
CS
.
	`g‘Argum’t
(1);

542 ià(
PH
 =ğ0 || 
i§
<
CÚ¡ªtPoš‹rNuÎ
>(PH)) ;

544 ià(
Size
->
	`g‘Ty³
(è!ğ
Ty³
::
	`g‘IÁ32Ty
(
CS
.
	`g‘In¡ruùiÚ
()->
	`g‘CÚ‹xt
()))

545 
Size
 = 
Ca¡In¡
::
	`C»©eIÁeg”Ca¡
(Size, 
Ty³
::
	`g‘IÁ32Ty
(
CS
.
	`g‘In¡ruùiÚ
()->
	`g‘CÚ‹xt
()), 
çl£
, Size->
	`g‘Name
(), 
I
);

547 
Ty³
 *
VoidPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(Ty³::
	`g‘IÁ8Ty
(
CS
.
	`g‘In¡ruùiÚ
()->
	`g‘CÚ‹xt
()));

548 ià(
OldPŒ
->
	`g‘Ty³
(è!ğ
VoidPŒTy
)

549 
OldPŒ
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(OldPŒ, 
VoidPŒTy
, OldPŒ->
	`g‘Name
(), 
I
);

551 
¡d
::
¡ršg
 
Name
 = 
I
->
	`g‘Name
(); I->
	`£tName
("");

552 
V®ue
* 
O±s
[3] = {
PH
, 
OldPŒ
, 
Size
};

553 
In¡ruùiÚ
 *
V
 = 
C®lIn¡
::
	`C»©e
(
PAInfo
.
PoŞR—Îoc
, 
O±s
, 
Name
, 
I
);

554 
In¡ruùiÚ
 *
Ca¡ed
 = 
V
;

555 ià(
V
->
	`g‘Ty³
(è!ğ
I
->getType())

556 
Ca¡ed
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(
V
, 
I
->
	`g‘Ty³
(), V->
	`g‘Name
(), I);

559 
I
->
	`»¶aûAÎU£sW™h
(
Ca¡ed
);

562 ià(!
FI
.
ClÚe
) {

564 
G
->
	`g‘SÿÏrM­
().
	`»¶aûSÿÏr
(
I
, 
V
);

565 ià(
V
 !ğ
Ca¡ed
)

566 
G
->
	`g‘SÿÏrM­
()[
Ca¡ed
] = G->g‘SÿÏrM­()[
V
];

568 
	`Upd©eNewToOldV®ueM­
(
I
, 
V
, V !ğ
Ca¡ed
 ? Casted : 0);

572 ià(
InvokeIn¡
 *
II
 = 
dyn_ÿ¡
<InvokeIn¡>(
I
)) {

573 
B¿nchIn¡
::
	`C»©e
 (
II
->
	`g‘NÜm®De¡
(), 
I
);

574 
II
->
	`g‘UnwšdDe¡
()->
	`»moveP»deûssÜ
(II->
	`g‘P¬’t
(), 
Œue
);

578 
I
->
	`”a£FromP¬’t
();

579 
	}
}

584 
	gFuncT¿nsfÜm
::
	$vis™MemAlignC®l
(
C®lS™e
 
CS
) {

585 
In¡ruùiÚ
 *
I
 = 
CS
.
	`g‘In¡ruùiÚ
();

586 
V®ue
 *
ResuÉDe¡
 = 0;

587 
V®ue
 *
Align
 = 0;

588 
V®ue
 *
Size
 = 0;

589 
V®ue
 *
PH
;

591 
Ty³
* 
IÁ8Ty³
 = Ty³::
	`g‘IÁ8Ty
(
CS
.
	`g‘In¡ruùiÚ
()->
	`g‘CÚ‹xt
());

592 
Ty³
* 
IÁ32Ty³
 = Ty³::
	`g‘IÁ32Ty
(
CS
.
	`g‘In¡ruùiÚ
()->
	`g‘CÚ‹xt
());

595 ià(
CS
.
	`g‘C®ËdFunùiÚ
()->
	`g‘Name
() == "memalign") {

596 
Align
 = 
CS
.
	`g‘Argum’t
(0);

597 
Size
 = 
CS
.
	`g‘Argum’t
(1);

598 
PH
 = 
	`g‘PoŞHªdË
(
I
);

600 
	`as£¹
(
CS
.
	`g‘C®ËdFunùiÚ
()->
	`g‘Name
() == "posix_memalign");

601 
ResuÉDe¡
 = 
CS
.
	`g‘Argum’t
(0);

602 
Align
 = 
CS
.
	`g‘Argum’t
(1);

603 
Size
 = 
CS
.
	`g‘Argum’t
(2);

605 
	`as£¹
(0 && "posix_memalign‚ot implemented fully!");

607 
PH
 = 
	`g‘PoŞHªdË
(
I
);

610 
Poš‹rTy³
 * 
PT
 = 
dyn_ÿ¡
<Poš‹rTy³>(
I
->
	`g‘Ty³
());

611 
	`as£¹
 (
PT
 && "memalign() does‚ot„eturn…ointerype!\n");

612 
V®ue
 *
R‘V®
 = 
CÚ¡ªtPoš‹rNuÎ
::
	`g‘
(
PT
);

613 
I
->
	`»¶aûAÎU£sW™h
(
R‘V®
);

615 
Ty³
 *
PŒPŒ
=
Poš‹rTy³
::
	`g‘Unqu®
(Poš‹rTy³::g‘Unqu®(
IÁ8Ty³
));

616 ià(
ResuÉDe¡
->
	`g‘Ty³
(è!ğ
PŒPŒ
)

617 
ResuÉDe¡
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(ResuÉDe¡, 
PŒPŒ
, ResuÉDe¡->
	`g‘Name
(), 
I
);

620 ià(!
Align
->
	`g‘Ty³
()->
	`isIÁeg”Ty
(32))

621 
Align
 = 
Ca¡In¡
::
	`C»©eIÁeg”Ca¡
(Align, 
IÁ32Ty³
, 
çl£
, Align->
	`g‘Name
(), 
I
);

622 ià(!
Size
->
	`g‘Ty³
()->
	`isIÁeg”Ty
(32))

623 
Size
 = 
Ca¡In¡
::
	`C»©eIÁeg”Ca¡
(Size, 
IÁ32Ty³
, 
çl£
, Size->
	`g‘Name
(), 
I
);

625 
¡d
::
¡ršg
 
Name
 = 
I
->
	`g‘Name
(); I->
	`£tName
("");

626 
V®ue
* 
O±s
[3] = {
PH
, 
Align
, 
Size
};

627 
In¡ruùiÚ
 *
V
 = 
C®lIn¡
::
	`C»©e
(
PAInfo
.
PoŞMemAlign
, 
O±s
, 
Name
, 
I
);

629 
In¡ruùiÚ
 *
Ca¡ed
 = 
V
;

630 ià(
V
->
	`g‘Ty³
(è!ğ
I
->getType())

631 
Ca¡ed
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(
V
, 
I
->
	`g‘Ty³
(), V->
	`g‘Name
(), I);

633 ià(
ResuÉDe¡
)

634 
Ãw
 
	`StÜeIn¡
(
V
, 
ResuÉDe¡
, 
I
);

636 
I
->
	`»¶aûAÎU£sW™h
(
Ca¡ed
);

639 ià(!
FI
.
ClÚe
) {

641 
G
->
	`g‘SÿÏrM­
().
	`»¶aûSÿÏr
(
I
, 
V
);

642 ià(
V
 !ğ
Ca¡ed
)

643 
G
->
	`g‘SÿÏrM­
()[
Ca¡ed
] = G->g‘SÿÏrM­()[
V
];

645 
	`Upd©eNewToOldV®ueM­
(
I
, 
V
, V !ğ
Ca¡ed
 ? Casted : 0);

649 ià(
InvokeIn¡
 *
II
 = 
dyn_ÿ¡
<InvokeIn¡>(
I
)) {

650 
B¿nchIn¡
::
	`C»©e
 (
II
->
	`g‘NÜm®De¡
(), 
I
);

651 
II
->
	`g‘UnwšdDe¡
()->
	`»moveP»deûssÜ
(II->
	`g‘P¬’t
(), 
Œue
);

655 
I
->
	`”a£FromP¬’t
();

656 
	}
}

660 
	gFuncT¿nsfÜm
::
	$vis™SŒdupC®l
(
C®lS™e
 
CS
) {

661 
	`as£¹
(
CS
.
	`¬g_’d
()-CS.
	`¬g_begš
() == 1 && "strdupakes one‡rgument!");

662 
In¡ruùiÚ
 *
I
 = 
CS
.
	`g‘In¡ruùiÚ
();

663 
	`as£¹
 (
	`g‘DSNodeHFÜ
(
I
).
	`g‘Node
() && "strdup has NULL DSNode!\n");

664 
V®ue
 *
PH
 = 
	`g‘PoŞHªdË
(
I
);

666 
Ty³
* 
IÁ8Ty³
 = Ty³::
	`g‘IÁ8Ty
(
CS
.
	`g‘In¡ruùiÚ
()->
	`g‘CÚ‹xt
());

670 
	`as£¹
 (
PH
 && "PH for strdup is‚ull!\n");

672 ià(!
PH
) {

673 
	`”rs
() << "strdup: NoPH\n";

677 
V®ue
 *
OldPŒ
 = 
CS
.
	`g‘Argum’t
(0);

679 
Ty³
 *
VoidPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
IÁ8Ty³
);

680 ià(
OldPŒ
->
	`g‘Ty³
(è!ğ
VoidPŒTy
)

681 
OldPŒ
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(OldPŒ, 
VoidPŒTy
, OldPŒ->
	`g‘Name
(), 
I
);

683 
¡d
::
¡ršg
 
Name
 = 
I
->
	`g‘Name
(); I->
	`£tName
("");

684 
V®ue
* 
O±s
[3] = {
PH
, 
OldPŒ
, 0};

685 
In¡ruùiÚ
 *
V
 = 
C®lIn¡
::
	`C»©e
(
PAInfo
.
PoŞSŒdup
, 
O±s
, 
Name
, 
I
);

686 
In¡ruùiÚ
 *
Ca¡ed
 = 
V
;

687 ià(
V
->
	`g‘Ty³
(è!ğ
I
->getType())

688 
Ca¡ed
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(
V
, 
I
->
	`g‘Ty³
(), V->
	`g‘Name
(), I);

691 
I
->
	`»¶aûAÎU£sW™h
(
Ca¡ed
);

694 ià(!
FI
.
ClÚe
) {

696 
G
->
	`g‘SÿÏrM­
().
	`»¶aûSÿÏr
(
I
, 
V
);

697 ià(
V
 !ğ
Ca¡ed
)

698 
G
->
	`g‘SÿÏrM­
()[
Ca¡ed
] = G->g‘SÿÏrM­()[
V
];

700 
	`Upd©eNewToOldV®ueM­
(
I
, 
V
, V !ğ
Ca¡ed
 ? Casted : 0);

704 ià(
InvokeIn¡
 *
II
 = 
dyn_ÿ¡
<InvokeIn¡>(
I
)) {

705 
B¿nchIn¡
::
	`C»©e
 (
II
->
	`g‘NÜm®De¡
(), 
I
);

706 
II
->
	`g‘UnwšdDe¡
()->
	`»moveP»deûssÜ
(II->
	`g‘P¬’t
(), 
Œue
);

710 
I
->
	`”a£FromP¬’t
();

711 
	}
}

723 
	gFuncT¿nsfÜm
::
	$vis™RuÁimeCheck
 (
C®lS™e
 
CS
, cÚ¡ 
PoŞArgc
) {

726 
	`as£¹
 ((
CS
.
	`¬g_size
(è>ğ2 * 
PoŞArgc
) &&

729 
PoŞIndex
 = 0; PoŞIndex < 
PoŞArgc
; ++PoolIndex) {

733 
V®ue
 *
PH
 =

734 
	`g‘PoŞHªdË
(
CS
.
	`g‘Argum’t
(
PoŞArgc
 + 
PoŞIndex
)->
	`¡rPoš‹rCa¡s
());

739 ià(
PH
) {

740 
Ty³
 * 
IÁ8Ty³
 = Ty³::
	`g‘IÁ8Ty
(
CS
.
	`g‘In¡ruùiÚ
()->
	`g‘CÚ‹xt
());

741 
Ty³
 * 
VoidPŒTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
(
IÁ8Ty³
);

742 
PH
 = 
	`ÿ¡To
 (PH, 
VoidPŒTy
, PH->
	`g‘Name
(), 
CS
.
	`g‘In¡ruùiÚ
());

743 
CS
.
	`£tArgum’t
 (
PoŞIndex
, 
PH
);

748 
	`AddPoŞU£
 (*(
CS
.
	`g‘In¡ruùiÚ
()), 
PH
, 
PoŞU£s
);

751 
	}
}

763 
	gFuncT¿nsfÜm
::
	$vis™C®lS™e
(
C®lS™e
& 
CS
) {

764 cÚ¡ 
FunùiÚ
 *
CF
 = 
CS
.
	`g‘C®ËdFunùiÚ
();

765 
In¡ruùiÚ
 *
TheC®l
 = 
CS
.
	`g‘In¡ruùiÚ
();

766 
boŞ
 
th»ad_ü—tiÚ_pošt
 = 
çl£
;

773 
V®ue
 * 
C®ËdV®ue
 = 
CS
.
	`g‘C®ËdV®ue
()->
	`¡rPoš‹rCa¡s
();

781 ià(!
CF
èCF = 
dyn_ÿ¡
<
FunùiÚ
>(
C®ËdV®ue
);

786 ià(
i§
<
IÆšeAsm
>(
TheC®l
->
	`g‘O³¿nd
(0))) {

787 
	`”rs
() << "INLINE ASM: ignoring. Hopinghat's safe.\n";

794 ià((
i§
<
CÚ¡ªtPoš‹rNuÎ
>(
C®ËdV®ue
)) ||

795 (
i§
<
UndefV®ue
>(
C®ËdV®ue
))) {

796 
	`”rs
() << "WARNING: Ignoring call using NULL/Undef function…ointer.\n";

802 ià(
CF
 && CF->
	`isDeş¬©iÚ
()) {

803 
¡d
::
¡ršg
 
Name
 = 
CF
->
	`g‘Name
();

805 ià(
Name
 == "free" || Name == "cfree") {

806 
	`vis™F»eC®l
(
CS
);

808 } ià(
Name
 == "malloc") {

809 
	`vis™M®locC®l
(
CS
);

811 } ià(
Name
 == "calloc") {

812 
	`vis™C®locC®l
(
CS
);

814 } ià(
Name
 == "realloc") {

815 
	`vis™R—ÎocC®l
(
CS
);

817 } ià(
Name
 == "memalign" || Name == "posix_memalign") {

818 
	`vis™MemAlignC®l
(
CS
);

820 } ià(
Name
 == "strdup") {

821 
	`vis™SŒdupC®l
(
CS
);

823 } ià(
Name
 == "valloc") {

824 
	`”rs
() << "VALLOC USED BUT NOT HANDLED!\n";

825 
	`abÜt
();

826 } ià(
PoŞArgc
 = 
PAInfo
.
	`g‘NumIn™ŸlPoŞArgum’ts
(
Name
)) {

827 
	`vis™RuÁimeCheck
(
CS
, 
PoŞArgc
);

829 } ià(
Name
 == "pthread_create") {

830 
th»ad_ü—tiÚ_pošt
 = 
Œue
;

836 
DSNode
* 
th»ad_ÿÎ“_node
 = 
G
->
	`g‘NodeFÜV®ue
(
CS
.
	`g‘Argum’t
(2)).
	`g‘Node
();

837 ià(!
th»ad_ÿÎ“_node
) {

838 
	`as£¹
(0 && "apparently you‚eedhis code");

839 
FuncInfo
 *
CFI
 = 
PAInfo
.
	`g‘FuncInfo
(*
CF
);

840 
th»ad_ÿÎ“_node
 = 
G
->
	`g‘NodeFÜV®ue
(
CFI
->
	`M­V®ueToOrigš®
(
CS
.
	`g‘Argum’t
(2))).
	`g‘Node
();

844 
CF
 = 
cÚ¡_ÿ¡
<
FunùiÚ
*>(
dyn_ÿ¡
<FunùiÚ>(*
th»ad_ÿÎ“_node
->
	`glob®s_begš
()));

855 
D©aSŒuùu»s
& 
G¿phs
 = 
PAInfo
.
	`g‘G¿phs
();

856 
DSG¿ph
::
NodeM­Ty
 
NodeM­pšg
;

857 
In¡ruùiÚ
 *
NewC®l
;

858 
V®ue
 *
NewC®Ëe
;

859 
¡d
::
veùÜ
<cÚ¡ 
DSNode
*> 
ArgNodes
;

860 
DSG¿ph
 *
C®ËeG¿ph
;

864 ià(
CF
) {

865 
	`DEBUG
(
	`”rs
(è<< " Hªdlšg dœeù c®l: " << *
TheC®l
 << "\n");

875 
FuncInfo
 *
CFI
 = 
PAInfo
.
	`g‘FuncInfo
(*
CF
);

876 ià(
CFI
 =ğ0 || CFI->
ClÚe
 == 0) {

877 
	`vis™In¡ruùiÚ
(*
TheC®l
);

884 
NewC®Ëe
 = 
CFI
->
ClÚe
;

885 
ArgNodes
 = 
CFI
->ArgNodes;

887 
	`as£¹
 ((
G¿phs
.
	`hasDSG¿ph
 (*
CF
)) && "Function has‚o ECGraph!\n");

888 
C®ËeG¿ph
 = 
G¿phs
.
	`g‘DSG¿ph
(*
CF
);

890 
	`DEBUG
(
	`”rs
(è<< " Hªdlšg indœeù c®l: " << *
TheC®l
 << "\n");

891 
DSG¿ph
 *
G
 = 
G¿phs
.
	`g‘Glob®sG¿ph
();

892 
DSG¿ph
::
SÿÏrM­Ty
& 
SM
 = 
G
->
	`g‘SÿÏrM­
();

899 
In¡ruùiÚ
 *
OrigIn¡
 =

900 
ÿ¡
<
In¡ruùiÚ
>(
	`g‘OldV®ueIfAvaabË
(
CS
.
	`g‘In¡ruùiÚ
()));

913 cÚ¡ 
DSC®lG¿ph
 & 
ÿÎG¿ph
 = 
G¿phs
.
	`g‘C®lG¿ph
();

915 
DSC®lG¿ph
::
ÿÎ“_™”©Ü
 
I
 = 
ÿÎG¿ph
.
	`ÿÎ“_begš
(
OrigIn¡
);

916 ; 
I
 !ğ
ÿÎG¿ph
.
	`ÿÎ“_’d
(
OrigIn¡
); ++I) {

917 
DSC®lG¿ph
::
scc_™”©Ü
 
sccii
 = 
ÿÎG¿ph
.
	`scc_begš
(*
I
),

918 
scûe
 = 
ÿÎG¿ph
.
	`scc_’d
(*
I
); 
sccii
 != sccee; ++sccii){

919 if(
SM
.
	`fšd
(SM.
	`g‘L—d”FÜGlob®
(*
sccii
)è=ğSM.
	`’d
())

926 ià(!(
G¿phs
.
	`hasDSG¿ph
(**
sccii
))) ;

929 
PAInfo
.
	`g‘FuncInfo
(**
sccii
);

935 
CF
 = *
sccii
;

939 if(!
CF
){

940 cÚ¡ 
FunùiÚ
 *
F1
 = 
OrigIn¡
->
	`g‘P¬’t
()->getParent();

941 
F1
 = 
ÿÎG¿ph
.
	`sccL—d”
(&*F1);

943 
DSC®lG¿ph
::
scc_™”©Ü
 
sccii
 = 
ÿÎG¿ph
.
	`scc_begš
(
F1
),

944 
scûe
 = 
ÿÎG¿ph
.
	`scc_’d
(
F1
); 
sccii
 != sccee; ++sccii){

945 if(
SM
.
	`fšd
(SM.
	`g‘L—d”FÜGlob®
(*
sccii
)è=ğSM.
	`’d
())

952 ià(!(
G¿phs
.
	`hasDSG¿ph
(**
sccii
))) ;

954 
PAInfo
.
	`g‘FuncInfo
(**
sccii
);

960 
CF
 = *
sccii
;

982 ià(!
CF
) ;

988 ià(!(
G¿phs
.
	`hasDSG¿ph
(*
CF
))) ;

993 
	`as£¹
 ((
G¿phs
.
	`hasDSG¿ph
(*
CF
)) && "Function has‚o DSGraph!\n");

994 
C®ËeG¿ph
 = 
G¿phs
.
	`g‘DSG¿ph
(*
CF
);

996 #iâdeà
NDEBUG


998 
DSC®lG¿ph
::
ÿÎ“_™”©Ü
 
E
 = 
G¿phs
.
	`g‘C®lG¿ph
().
	`ÿÎ“_’d
(
OrigIn¡
);

999 ; 
I
 !ğ
E
; ++I) {

1000 cÚ¡ 
FunùiÚ
 * 
F
 = *
I
;

1001 
	`as£¹
 (
F
);

1002 ià(!(
F
)->
	`isDeş¬©iÚ
())

1003 
	`as£¹
(
C®ËeG¿ph
 =ğ
G¿phs
.
	`g‘DSG¿ph
(**
I
) &&

1009 
FuncInfo
 *
CFI
 = 
PAInfo
.
	`g‘FuncInfo
(*
CF
);

1010 
	`as£¹
(
CFI
 && "No function info for callee‡t indirect call?");

1011 
ArgNodes
 = 
CFI
->ArgNodes;

1013 ià(
ArgNodes
.
	`em±y
())

1017 
¡d
::
veùÜ
<
Ty³
*> 
	`ArgTys
(
ArgNodes
.
	`size
(),

1018 
PoŞAÎoÿ‹
::
PoŞDescPŒTy
);

1019 
C®lS™e
::
¬g_™”©Ü
 
I
 = 
CS
.
	`¬g_begš
(), 
E
 = CS.
	`¬g_’d
();

1020 
I
 !ğ
E
; ++I)

1021 
ArgTys
.
	`push_back
((*
I
)->
	`g‘Ty³
());

1023 
FunùiÚTy³
 *
FTy
 = FunùiÚTy³::
	`g‘
(
TheC®l
->
	`g‘Ty³
(), 
ArgTys
, 
çl£
);

1024 
Poš‹rTy³
 *
PFTy
 = Poš‹rTy³::
	`g‘Unqu®
(
FTy
);

1027 
NewC®Ëe
 = 
Ca¡In¡
::
	`C»©ePoš‹rCa¡
(
CS
.
	`g‘C®ËdV®ue
(), 
PFTy
, "tmp", 
TheC®l
);

1034 
FunùiÚ
::
cÚ¡_¬g_™”©Ü
 
FAI
 = 
CF
->
	`¬g_begš
(), 
E
 = CF->
	`¬g_’d
();

1035 
C®lS™e
::
¬g_™”©Ü
 
AI
 = 
CS
.
	`¬g_begš
(è+ (
th»ad_ü—tiÚ_pošt
 ? 3 : 0);

1036 
C®lS™e
::
¬g_™”©Ü
 
AE
 = 
CS
.
	`¬g_’d
();

1037  ; 
FAI
 !ğ
E
 && 
AI
 !ğ
AE
; ++FAI, ++AI)

1038 ià(!
i§
<
CÚ¡ªt
>(*
AI
)) {

1039 
DSG¿ph
::
	`compu‹NodeM­pšg
(
C®ËeG¿ph
->
	`g‘NodeFÜV®ue
(
FAI
),

1040 
	`g‘DSNodeHFÜ
(*
AI
), 
NodeM­pšg
, 
çl£
);

1046 ià(
i§
<
Poš‹rTy³
>(
TheC®l
->
	`g‘Ty³
()))

1047 
DSG¿ph
::
	`compu‹NodeM­pšg
(
C®ËeG¿ph
->
	`g‘R‘uºNodeFÜ
(*
CF
),

1048 
	`g‘DSNodeHFÜ
(
TheC®l
), 
NodeM­pšg
, 
çl£
);

1080 
¡d
::
veùÜ
<
V®ue
*> 
Args
;

1081 
i
 = 0, 
e
 = 
ArgNodes
.
	`size
(); i !=ƒ; ++i) {

1082 
V®ue
 *
ArgV®
 = 
CÚ¡ªt
::
	`g‘NuÎV®ue
(
PoŞAÎoÿ‹
::
PoŞDescPŒTy
);

1083 ià(
NodeM­pšg
.
	`couÁ
(
ArgNodes
[
i
])) {

1084 ià(
DSNode
 *
LoÿlNode
 = 
NodeM­pšg
[
ArgNodes
[
i
]].
	`g‘Node
())

1085 ià(
FI
.
PoŞDesütÜs
.
	`couÁ
(
LoÿlNode
))

1086 
ArgV®
 = 
FI
.
PoŞDesütÜs
.
	`fšd
(
LoÿlNode
)->
£cÚd
;

1088 
Args
.
	`push_back
(
ArgV®
);

1092 if(!
th»ad_ü—tiÚ_pošt
)

1093 
Args
.
	`š£¹
(Args.
	`’d
(), 
CS
.
	`¬g_begš
(), CS.
	`¬g_’d
());

1100 ià(
FunùiÚ
 * 
NewFunùiÚ
 = 
dyn_ÿ¡
<FunùiÚ>(
NewC®Ëe
)) {

1101 
FunùiÚTy³
 * 
NewC®ËeTy³
 = 
NewFunùiÚ
->
	`g‘FunùiÚTy³
();

1102 ià(
NewC®ËeTy³
->
	`g‘NumP¬ams
(è!ğ
Args
.
	`size
()) {

1103 
¡d
::
veùÜ
<
Ty³
 *> 
Ty³s
;

1104 
Ty³
 * 
FuncTy
 = 
FunùiÚTy³
::
	`g‘
 (
NewC®ËeTy³
->
	`g‘R‘uºTy³
(),

1105 
Ty³s
,

1106 
Œue
);

1107 
FuncTy
 = 
Poš‹rTy³
::
	`g‘Unqu®
 (FuncTy);

1108 
NewC®Ëe
 = 
Ãw
 
	`B™Ca¡In¡
 (NewC®Ëe, 
FuncTy
, "", 
TheC®l
);

1112 
¡d
::
¡ršg
 
Name
 = 
TheC®l
->
	`g‘Name
(); TheC®l->
	`£tName
("");

1114 if(
th»ad_ü—tiÚ_pošt
) {

1115 
ModuË
 *
M
 = 
CS
.
	`g‘In¡ruùiÚ
()->
	`g‘P¬’t
()->getParent()->getParent();

1116 
V®ue
* 
±h»ad_»¶aûm’t
 = 
M
->
	`g‘FunùiÚ
("poolalloc_pthread_create");

1117 
¡d
::
veùÜ
<
V®ue
*> 
th»ad_¬gs
;

1120 
th»ad_¬gs
.
	`push_back
(
CS
.
	`g‘Argum’t
(0));

1121 
th»ad_¬gs
.
	`push_back
(
CS
.
	`g‘Argum’t
(1));

1122 
th»ad_¬gs
.
	`push_back
(
CS
.
	`g‘Argum’t
(2));

1125 
th»ad_¬gs
.
	`push_back
(
CÚ¡ªt
::
	`g‘IÁeg”V®ue
(
Îvm
::
Ty³
::
	`g‘IÁ32Ty
(
M
->
	`g‘CÚ‹xt
()),
	`APIÁ
(32,
Args
.
	`size
())));

1126 
th»ad_¬gs
.
	`š£¹
Ñh»ad_¬gs.
	`’d
(),
Args
.
	`begš
(),Args.end());

1127 
th»ad_¬gs
.
	`push_back
(
CS
.
	`g‘Argum’t
(3));

1130 
NewC®l
 = 
C®lIn¡
::
	`C»©e
(
±h»ad_»¶aûm’t
,

1131 
th»ad_¬gs
,

1132 
Name
,
TheC®l
);

1134 ià(
InvokeIn¡
 *
II
 = 
dyn_ÿ¡
<InvokeIn¡>(
TheC®l
)) {

1135 
NewC®l
 = 
InvokeIn¡
::
	`C»©e
 (
NewC®Ëe
, 
II
->
	`g‘NÜm®De¡
(),

1136 
II
->
	`g‘UnwšdDe¡
(),

1137 
Args
, 
Name
, 
TheC®l
);

1139 
NewC®l
 = 
C®lIn¡
::
	`C»©e
 (
NewC®Ëe
, 
Args
, 
Name
,

1140 
TheC®l
);

1144 
i
 = 0, 
e
 = 
ArgNodes
.
	`size
(); i !=ƒ; ++i)

1145 
	`AddPoŞU£
(*
NewC®l
, 
Args
[
i
], 
PoŞU£s
);

1147 
TheC®l
->
	`»¶aûAÎU£sW™h
(
NewC®l
);

1148 
	`DEBUG
(
	`”rs
(è<< " ResuÉ C®l: " << *
NewC®l
 << "\n");

1150 ià(!
TheC®l
->
	`g‘Ty³
()->
	`isVoidTy
()) {

1152 
DSG¿ph
::
SÿÏrM­Ty
 &
SM
 = 
G
->
	`g‘SÿÏrM­
();

1153 
DSG¿ph
::
SÿÏrM­Ty
::
™”©Ü
 
CII
 = 
SM
.
	`fšd
(
TheC®l
);

1154 ià(
CII
 !ğ
SM
.
	`’d
()) {

1155 
SM
[
NewC®l
] = 
CII
->
£cÚd
;

1156 
SM
.
	`”a£
(
CII
);

1157 } ià(!
FI
.
NewToOldV®ueM­
.
	`em±y
()) {

1160 
	`Upd©eNewToOldV®ueM­
(
TheC®l
, 
NewC®l
);

1162 } ià(!
FI
.
NewToOldV®ueM­
.
	`em±y
()) {

1163 
	`Upd©eNewToOldV®ueM­
(
TheC®l
, 
NewC®l
);

1170 
	`C®lS™e
(
NewC®l
).
	`£tC®lšgCÚv
(C®lS™e(
TheC®l
).
	`g‘C®lšgCÚv
());

1172 
TheC®l
->
	`”a£FromP¬’t
();

1173 
	`vis™In¡ruùiÚ
(*
NewC®l
);

1174 
	}
}

1185 
	gFuncT¿nsfÜm
::
	$vis™In¡ruùiÚ
(
In¡ruùiÚ
 &
I
) {

1186 
i
 = 0, 
e
 = 
I
.
	`g‘NumO³¿nds
(); i !=ƒ; ++i)

1187 ià(
FunùiÚ
 *
şÚedFunc
 = 
	`»tClÚeIfFunc
(
I
.
	`g‘O³¿nd
(
i
))) {

1188 
CÚ¡ªt
 *
CF
 = 
şÚedFunc
;

1189 
I
.
	`£tO³¿nd
(
i
, 
CÚ¡ªtEx´
::
	`g‘Poš‹rCa¡
(
CF
, I.
	`g‘O³¿nd
(i)->
	`g‘Ty³
()));

1191 
	}
}

	@
1
.
1
/usr/include
11
217
AccessTrace.cpp
AllHeapNodesHeuristic.cpp
AllNodesHeuristic.cpp
Heuristic.cpp
PAMultipleGlobalPool.cpp
PASimple.cpp
PointerCompress.cpp
PoolAllocate.cpp
PoolOptimize.cpp
RunTimeAssociate.cpp
TransformFunctionBody.cpp
